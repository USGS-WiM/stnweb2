<h2 *ngIf="editOrCreate === 'Edit'" mat-dialog-title>
    HWM Edit
    <button class="close-button" mat-button [mat-dialog-close]="{returnFiles: returnFiles}" aria-label="Exit"><mat-icon>close</mat-icon></button>
</h2>
<h2 *ngIf="editOrCreate === 'Create'" mat-dialog-title>
    Create HWM
    <button class="close-button" mat-button [mat-dialog-close]="{returnFiles: returnFiles}" aria-label="Exit"><mat-icon>close</mat-icon></button>
</h2>

<form [formGroup]="form" (ngSubmit)="submit()">
    <mat-dialog-content>
        <mat-accordion multi="true">
            <mat-expansion-panel hideToggle [expanded]="infoExpanded" (opened)="infoExpanded = true" (closed)="infoExpanded = false">
            <mat-expansion-panel-header>
                <mat-panel-title *ngIf="!infoExpanded" style="color: grey; font-weight: 500">
                    HWM Information
                </mat-panel-title>
                <mat-panel-title *ngIf="infoExpanded" style="color: #FFF; font-weight: 550">
                    HWM Information
                </mat-panel-title>
            </mat-expansion-panel-header>
            <mat-form-field appearance="fill">
                <mat-label>Waterbody</mat-label>
                <input aria-label="Waterbody" matInput formControlName="waterbody" [value]="hwm.waterbody"/>
            </mat-form-field>
            <!-- Event is automtically populated when new HWM is being created -->
            <div *ngIf="editOrCreate === 'Create'">
                <label class="form-header">Event: </label> {{this.eventName}}
            </div>
            <!-- Users with role 1 can edit the event -->
            <div *ngIf="editOrCreate === 'Edit' && (role === 3 || role === 2)">
                <label class="form-header">Event: </label> {{this.hwm.eventName}}
            </div>
            <div *ngIf="editOrCreate === 'Edit' && role === 1">
                <mat-form-field appearance="fill">
                    <mat-label>Event</mat-label>
                    <mat-select aria-label="Event" required formControlName="event_id">
                        <mat-option *ngFor="let event of events" [value]="event.event_id">
                        {{event.event_name}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <mat-form-field appearance="fill">
                <mat-label>HWM Type</mat-label>
                <mat-select aria-label="HWM Type" required formControlName="hwm_type_id">
                    <mat-option *ngFor="let type of hwmTypes" [value]="type.hwm_type_id">
                    {{type.hwm_type}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Marker</mat-label>
                <mat-select aria-label="Marker" formControlName="marker_id">
                    <mat-option *ngFor="let marker of hwmMarkers" [value]="marker.marker_id">
                    {{marker.marker1}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Label</mat-label>
                <input aria-label="Label" matInput formControlName="hwm_label" required [value]="hwm.hwm_label"/>
                <mat-icon matSuffix class="info-icon" matTooltip="Label for distinguishing hwm from other hwms at this site-event. Limited to 12 characters.">info</mat-icon>
            </mat-form-field>
            <div>
                <label class="form-header">HWM Environment:</label>
                <mat-radio-group class="radio-btn-group" [(value)]="hwm_environment" (change)="changeHWMEnvironment($event.value)">
                    <mat-radio-button class="radio-button" value="Coastal">Coastal</mat-radio-button>
                    <mat-radio-button class="radio-button" value="Riverine">Riverine</mat-radio-button>
                </mat-radio-group>
            </div>
            <mat-form-field appearance="fill">
                <mat-label>HWM Uncertainty</mat-label>
                <input aria-label="HWM Uncertainty" type="number" matInput formControlName="hwm_uncertainty" (change)="chooseQuality()"  [value]="hwm.hwm_uncertainty"/>
                <mat-icon matSuffix class="info-icon" matTooltip="A numeric uncertainty entered here is the preferred method of recording uncertainty and represents the vertical range of peak surfaces that could be described by the HWM evidence (see TM3-A24, pg.27). Do not include any survey uncertainty, which is entered further below.">info</mat-icon>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>HWM Quality</mat-label>
                <mat-select aria-label="HWM Quality" required formControlName="hwm_quality_id" (selectionChange)="compareToUncertainty()" >
                    <mat-option *ngFor="let quality of hwmQualities" [value]="quality.hwm_quality_id">
                    {{quality.hwm_quality}}
                    </mat-option>
                </mat-select>
                <mat-icon matSuffix class="info-icon" matTooltip="For continuity with older data, a shorthand quality is auto-populated here based on a numeric uncertainty entered above. In addition, three qualities with undefined uncertainties are available.">info</mat-icon>
            </mat-form-field>
            <div>
                <label class="form-header">Bank:</label>
                <mat-radio-group class="radio-btn-group" [(value)]="hwmBank" (change)="changeBank($event.value)">
                    <mat-radio-button class="radio-button" value="Left">Left</mat-radio-button>
                    <mat-radio-button class="radio-button" value="Right">Right</mat-radio-button>
                    <mat-radio-button class="radio-button" value="N/A">N/A</mat-radio-button>
                </mat-radio-group>
            </div>
            <mat-form-field appearance="fill">
                <mat-label for="description">Location Description</mat-label>
                <textarea aria-label="description" matInput formControlName="hwm_locationdescription" id="location_description" [value]="hwm.hwm_locationdescription"></textarea>
                <mat-icon matSuffix class="info-icon" matTooltip="Please be specific so someone else can find this sensor later. This field is public." 
                    aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
            </mat-form-field>
            <div>
                <mat-label class="form-header">Lat/Lng Unit:</mat-label>
                <mat-radio-group class="radio-btn-group" [(ngModel)]="latLngUnit" [ngModelOptions]="{standalone: true}" (change)="changeLatLngUnit($event)">
                    <mat-radio-button class="radio-button" value="decdeg">Dec Deg</mat-radio-button>
                    <mat-radio-button class="radio-button" value="dms">DMS</mat-radio-button>
                </mat-radio-group>   
            </div>
            <div *ngIf="latLngUnit === 'decdeg'">            
                <mat-form-field appearance="fill">
                    <mat-label>Latitude</mat-label>
                    <input aria-label="Latitude" type="number" required matInput formControlName="latitude_dd" [value]="hwm.latitude_dd"/>
                </mat-form-field>
                <!-- LatDD Validator -->
                <div *ngIf="form.controls.latitude_dd.invalid && (form.controls.latitude_dd.dirty || form.controls.latitude_dd.touched)"
                    class="alert alert-danger">
                    <div *ngIf="form.controls.latitude_dd.errors?.['incorrectValue']">
                        The latitude must be between 0 and 73.0.
                    </div>
                </div>
                <mat-form-field appearance="fill">
                    <mat-label>Longitude</mat-label>
                    <input aria-label="longitude" type="number" required matInput formControlName="longitude_dd" [value]="hwm.longitude_dd"/>
                </mat-form-field>
                <!-- LonDD Validator -->
                <div *ngIf="form.controls.longitude_dd.invalid && (form.controls.longitude_dd.dirty || form.controls.longitude_dd.touched)"
                    class="alert alert-danger">
                    <div *ngIf="form.controls.longitude_dd.errors?.['incorrectValue']">
                        The longitude must be between -175.0 and -60.0.
                    </div>
                </div>
            </div>
            <div *ngIf="latLngUnit === 'dms'">
                <table>
                    <tr>
                        <td>
                            <label>Latitude</label>
                        </td>
                        <td>
                            <mat-form-field appearance="fill">
                                <mat-label>Degree</mat-label>
                                <input type="number" aria-label="Degree" required formControlName="latdeg" matInput [value]="dms.latdeg"/>
                            </mat-form-field>
                        </td>
                        <td>°</td>
                        <td>
                            <mat-form-field appearance="fill">
                                <mat-label>Minute</mat-label>
                                <input type="number" aria-label="Minute" required formControlName="latmin" matInput [value]="dms.latmin"/>
                            </mat-form-field>
                        </td>
                        <td>′</td>
                        <td>
                            <mat-form-field appearance="fill">
                                <mat-label>Second</mat-label>
                                <input type="number" aria-label="Second" required formControlName="latsec" matInput [value]="dms.latsec"/>
                            </mat-form-field>
                        </td>
                        <td>″</td>
                    </tr>
                </table>
                <!-- LatDD Validator -->
                <div *ngIf="form.controls.latdeg.invalid && (form.controls.latdeg.dirty || form.controls.latdeg.touched)"
                    class="alert alert-danger">
                    <div *ngIf="form.controls.latdeg.errors?.['incorrectValue']">
                        The latitude must be between -175.0 and -60.0.
                    </div>
                </div>
                <div *ngIf="form.controls.latmin.invalid && (form.controls.latmin.dirty || form.controls.latmin.touched)"
                    class="alert alert-danger">
                    <div *ngIf="form.controls.latmin.errors?.['incorrectValue']">
                        The latitude must be between 0 and 73.
                    </div>
                </div>
                <div *ngIf="form.controls.latsec.invalid && (form.controls.latsec.dirty || form.controls.latsec.touched)"
                    class="alert alert-danger">
                    <div *ngIf="form.controls.latsec.errors?.['incorrectValue']">
                        The latitude must be between 0 and 73.
                    </div>
                </div>
                <table>
                    <tr>
                        <td>
                            <label>Longitude</label>
                        </td>
                        <td>
                            <mat-form-field appearance="fill">
                                <mat-label>Degree</mat-label>
                                <input type="number" aria-label="Degree" required formControlName="londeg" matInput [value]="dms.londeg"/>
                            </mat-form-field>
                        </td>
                        <td>°</td>
                        <td>
                            <mat-form-field appearance="fill">
                                <mat-label>Minute</mat-label>
                                <input type="number" aria-label="Minute" required formControlName="lonmin" matInput [value]="dms.lonmin"/>
                            </mat-form-field>
                        </td>
                        <td>′</td>
                        <td>
                            <mat-form-field appearance="fill">
                                <mat-label>Second</mat-label>
                                <input type="number" aria-label="Second" required formControlName="lonsec" matInput [value]="dms.lonsec"/>
                            </mat-form-field>
                        </td>
                        <td>″</td>
                    </tr>
                </table>
                <!-- LonDD Validator -->
                <div *ngIf="form.controls.londeg.invalid && (form.controls.londeg.dirty || form.controls.londeg.touched)"
                    class="alert alert-danger">
                    <div *ngIf="form.controls.londeg.errors?.['incorrectValue']">
                        The longitude must be between -175.0 and -60.0.
                    </div>
                </div>
                <div *ngIf="form.controls.lonmin.invalid && (form.controls.lonmin.dirty || form.controls.lonmin.touched)"
                    class="alert alert-danger">
                    <div *ngIf="form.controls.lonmin.errors?.['incorrectValue']">
                        The longitude must be between -175.0 and -60.0.
                    </div>
                </div>
                <div *ngIf="form.controls.lonsec.invalid && (form.controls.lonsec.dirty || form.controls.lonsec.touched)"
                    class="alert alert-danger">
                    <div *ngIf="form.controls.lonsec.errors?.['incorrectValue']">
                        The longitude must be between -175.0 and -60.0.
                    </div>
                </div>
            </div>
            <mat-form-field appearance="fill">
                <mat-label>Horizontal Datum</mat-label>
                <mat-select aria-label="Horizontal Datum" required formControlName="hdatum_id">
                    <mat-option *ngFor="let datum of hdatums" [value]="datum.datum_id">
                    {{datum.datum_name}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Horizontal Collection Method</mat-label>
                <mat-select aria-label="Horizontal Collection Method" required formControlName="hcollect_method_id">
                    <mat-option *ngFor="let method of hmethods" [value]="method.hcollect_method_id">
                    {{method.hcollect_method}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Height Above Ground (Ft)</mat-label>
                <input type="number" aria-label="Height Above Ground" matInput formControlName="height_above_gnd" [value]="hwm.height_above_gnd"/>
            </mat-form-field>
            <div>
                <label class="form-header">Tranquil/Stillwater HWM:</label>
                <mat-radio-group class="radio-btn-group" [(value)]="isStillwater" (change)="changeStillwater($event.value)">
                    <mat-radio-button class="radio-button" value="Yes">Yes</mat-radio-button>
                    <mat-radio-button class="radio-button" value="No">No</mat-radio-button>
                    <mat-icon matSuffix class="info-icon" matTooltip="For modeling purposes, all high water marks are assumed to be rapid-water high-water marks unless the user is confident that the mark being entered here was formed in tranquil water. See TM3-A24 for a discussion on rapid versus tranquil high-water marks.">info</mat-icon>
                </mat-radio-group>
            </div>
            <mat-form-field appearance="fill">
                <mat-label>Flag/Found Date</mat-label>
                <input aria-label="Flag/Found Date" matInput formControlName="flag_date" [value]="hwm.flag_date" [matDatepicker]="flagDatePicker" required placeholder="Choose a date">
                <mat-datepicker-toggle matSuffix [for]="flagDatePicker"></mat-datepicker-toggle>
                <mat-datepicker [value]="hwm.flag_date" #flagDatePicker></mat-datepicker>
            </mat-form-field>
            <div>
                <label class="form-header">Flagging Member: </label> {{flagMember}}
            </div>
            <mat-divider></mat-divider>
            <mat-form-field appearance="fill">
                <mat-label>Surveyed Date</mat-label>
                <input aria-label="Surveyed Date" matInput formControlName="survey_date" [value]="hwm.survey_date" [matDatepicker]="surveyedDatePicker" placeholder="Choose a date">
                <mat-datepicker-toggle matSuffix [for]="surveyedDatePicker"></mat-datepicker-toggle>
                <mat-datepicker [value]="hwm.survey_date" #surveyedDatePicker></mat-datepicker>
                <mat-icon matSuffix class="info-icon" matTooltip="Elevation required below if survey date is populated">info</mat-icon>
            </mat-form-field>
            <div>
                <label class="form-header">Survey Member: </label> {{surveyMember}}
            </div>
            <mat-form-field appearance="fill">
                <mat-label>Surveyed Elevation (Ft)</mat-label>
                <input type="number" aria-label="Surveyed Elevation" matInput formControlName="elev_ft" [value]="hwm.elev_ft"/>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Vertical Datum</mat-label>
                <mat-select aria-label="Vertical Datum" formControlName="vdatum_id">
                    <mat-option *ngFor="let datum of vdatums" [value]="datum.datum_id">
                    {{datum.datum_name}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Vertical Collection Method</mat-label>
                <mat-select aria-label="Vertical Collection Method" formControlName="vcollect_method_id" [(value)]="hwm.vcollect_method_id">
                    <mat-option *ngFor="let method of vmethods" [value]="method.vcollect_method_id">
                    {{method.vcollect_method}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <!-- Survey Uncertainty -->
            <div class="inline-fields">
                <mat-form-field id="uncertainty" class="inline-widths" appearance="fill">
                    <mat-label for="uncertainty">Survey Uncertainty</mat-label>
                    <input type="number" aria-label="Uncertainty" matInput formControlName="uncertainty" [value]="hwm.uncertainty"/>
                </mat-form-field>
                <mat-radio-group class="radio-btn-group" [(value)]="uncertainty_unit" (change)="uncertaintyUnitChange($event.value)">
                    <mat-radio-button class="radio-button" value="ft">+/- ft</mat-radio-button>
                    <mat-radio-button class="radio-button" value="cm">+/- cm</mat-radio-button>
                </mat-radio-group>
                <mat-icon class="info-icon uncertainty-icon" matTooltip="Survey Uncertainty will be stored in feet."
                aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
            </div>
            <mat-form-field appearance="fill">
                <mat-label for="description">Notes</mat-label>
                <textarea aria-label="description" matInput formControlName="hwm_notes" id="hwm_notes" [value]="hwm.hwm_notes"></textarea>
            </mat-form-field>
            <div *ngIf="approved">
                <div>
                    <label class="form-header">Approved By: </label> {{approvalMember}}
                </div>
                <div class="vertically-aligned">
                    <label class="form-header">Approved On: </label> {{approvalDate}}
                </div>
            </div>
            </mat-expansion-panel>
            <mat-expansion-panel *ngIf="editOrCreate === 'Edit'" hideToggle [expanded]="filesExpanded"  (opened)="filesExpanded = true" (closed)="filesExpanded = false">
            <mat-expansion-panel-header>
                <mat-panel-title *ngIf="!filesExpanded" style="color: grey; font-weight: 500">
                    HWM File Information
                </mat-panel-title>
                <mat-panel-title *ngIf="filesExpanded" style="color: #FFF; font-weight: 550">
                    HWM File Information
                </mat-panel-title>
            </mat-expansion-panel-header>
            <button *ngIf="currentEvent !== null" mat-stroked-button class="add" type="button" (click)="showFileCreate()"
                aria-label="Add File"><mat-icon>add</mat-icon> Add File
            </button>
            <!-- Create HWM File Form -->
            <form *ngIf="showFileCreateForm" [formGroup]="hwmFileForm">
                <mat-form-field appearance="fill">
                    <mat-label>File Type</mat-label>
                    <mat-select aria-label="File Type" formControlName="filetype_id" (selectionChange)="getFileTypeSelection($event)">
                        <mat-option *ngFor="let file of fileTypes" [value]="file.filetype_id">
                            {{file.filetype}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                
                <!--Upload Single Image with validations*-->
                <div *ngIf="addFileType === 'New' && selectedFile.FileEntity.filetype_id !== 8">
                    <label class="custom-file-input-add" for="addFile">
                        <p class="required">*</p> {{ selectedFile.FileEntity.name || ' None Chosen' }}
                    </label>
                    <input #upload id="addFile" class="upload-file" type="file" max="500000" [hidden]="true" (change)="getFileName($event)">
                </div>
                <br clear="all" />

                <!--File URL (LINK file)-->
                <div *ngIf="selectedFile.FileEntity.filetype_id === 8">
                    <mat-form-field appearance="fill">
                        <mat-label>File URL</mat-label>
                        <input aria-label="File URL" formControlName="name" matInput [value]="selectedFile.FileEntity.name"/>
                        <mat-icon matSuffix class="info-icon" matTooltip="Please link to persistent URLs or digital object identifier (doi) urls." 
                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>                
                    </mat-form-field>
                </div>

                <!--Source Name (photo)-->
                <div *ngIf="selectedFile.FileEntity.filetype_id === 1">
                    <mat-form-field appearance="fill">
                        <mat-label>Source Photographer</mat-label>
                        <input aria-label="Source Photographer" formControlName="FULLname" matInput required [value]="selectedFile.FileEntity.FULLname"/>           
                    </mat-form-field>
                </div>

                <!--Source Name (all other)-->
                <div *ngIf="selectedFile.FileEntity.filetype_id  > 2">
                    <mat-form-field appearance="fill">
                        <mat-label>Source Name</mat-label>
                        <input aria-label="Source Name" formControlName="FULLname" matInput required [value]="selectedFile.FileEntity.FULLname"/>           
                    </mat-form-field>
                </div>

                <!--Source Agency* (photo, allOther)-->
                <div *ngIf="selectedFile.FileEntity.filetype_id === 1 || selectedFile.FileEntity.filetype_id > 2">
                    <mat-form-field appearance="fill">
                        <mat-label>Source Agency</mat-label>
                        <mat-select aria-label="Source Agency" required formControlName="agency_id" (selectionChange)="updateAgencyForCaption()">
                            <mat-option *ngFor="let a of agencies" [value]="a.agency_id">
                                {{a.agency_name}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>

                <!-- Photo Date* (photo) -->
                <div *ngIf="selectedFile.FileEntity.filetype_id === 1">
                    <mat-form-field appearance="fill">
                        <mat-label>Photo Date</mat-label>
                        <input aria-label="Photo Date" matInput formControlName="photo_date" [value]="selectedFile.FileEntity.photo_date" [matDatepicker]="photoDatePicker" (dateChange)="formatDate($event)" required placeholder="Choose a date">
                        <mat-datepicker-toggle matSuffix [for]="photoDatePicker"></mat-datepicker-toggle>
                        <mat-datepicker [value]="selectedFile.FileEntity.photo_date" #photoDatePicker></mat-datepicker>
                    </mat-form-field>
                </div>

                <!-- Date Uploaded* (photo, data, allother) -->
                <div *ngIf="selectedFile.FileEntity.filetype_id > 0">
                    <mat-form-field appearance="fill">
                        <mat-label>Date Uploaded</mat-label>
                        <input aria-label="Date Uploaded" matInput formControlName="file_date" [value]="selectedFile.FileEntity.file_date" [matDatepicker]="fileDatePicker" required placeholder="Choose a date" (dateChange)="formatDate($event)">
                        <mat-datepicker-toggle matSuffix [for]="fileDatePicker"></mat-datepicker-toggle>
                        <mat-datepicker #fileDatePicker></mat-datepicker>
                    </mat-form-field>
                </div>

                <!--Description*(photo, data, allother)-->
                <div *ngIf="selectedFile.FileEntity.filetype_id > 0">
                    <mat-form-field appearance="fill">
                        <mat-label for="description">Description</mat-label>
                        <textarea aria-label="Description" matInput formControlName="description" required id="description" [value]="selectedFile.FileEntity.description"></textarea>
                        <mat-icon [hidden]="selectedFile.FileEntity.filetype_id !== 1" matSuffix class="info-icon" matTooltip="Populates in Photo caption below. If a person or people appear in photo include name(s). If non-USGS personnel, ensure consent to publish name in caption is given." 
                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                    </mat-form-field>
                </div>

                <!-- This is where Other ends, rest is for Photo -->
                <!--Photo Direction (photo)-->
                <div *ngIf="selectedFile.FileEntity.filetype_id === 1">
                    <mat-form-field appearance="fill">
                        <mat-label>Photo Direction</mat-label>
                        <input aria-label="Photo Direction" formControlName="photo_direction" matInput [value]="selectedFile.FileEntity.photo_direction"/>           
                    </mat-form-field>
                </div>

                <!-- Photo Latitude (photo)-->
                <div *ngIf="selectedFile.FileEntity.filetype_id === 1">
                    <mat-form-field appearance="fill">
                        <mat-label>Photo Latitude (if different)</mat-label>
                        <input aria-label="Photo Latitude (if different)" formControlName="latitude_dd" matInput [value]="selectedFile.FileEntity.latitude_dd"/>           
                    </mat-form-field>
                </div>
                <!-- LatDD Validator -->
                <div *ngIf="hwmFileForm.controls.latitude_dd.invalid && (hwmFileForm.controls.latitude_dd.dirty || hwmFileForm.controls.latitude_dd.touched)"
                    class="alert alert-danger">
                    <div *ngIf="hwmFileForm.controls.latitude_dd.errors?.['incorrectValue']">
                        The latitude must be between 0 and 73.0.
                    </div>
                </div>

                <!--Photo Longitude (photo)-->
                <div *ngIf="selectedFile.FileEntity.filetype_id === 1">
                    <mat-form-field appearance="fill">
                        <mat-label>Photo Longitude (if different)</mat-label>
                        <input aria-label="Photo longitude (if different)" formControlName="longitude_dd" matInput [value]="selectedFile.FileEntity.longitude_dd"/>           
                    </mat-form-field>
                </div>
                <!-- LonDD Validator -->
                <div *ngIf="hwmFileForm.controls.longitude_dd.invalid && (hwmFileForm.controls.longitude_dd.dirty || hwmFileForm.controls.longitude_dd.touched)"
                    class="alert alert-danger">
                    <div *ngIf="hwmFileForm.controls.longitude_dd.errors?.['incorrectValue']">
                        The longitude must be between -175.0 and -60.0.
                    </div>
                </div>

                <div *ngIf="selectedFile.FileEntity.filetype_id === 11">
                    <label class="form-header" for="Caption">Preview Caption</label>
                    <div>
                        <span>
                            Photo of {{hwmFileForm.value.description || ' (Description HERE) '}} at {{siteForm.value.site_description}}, {{siteForm.value.county}}, {{siteForm.value.state}}, {{formattedPhotoDate || ' Date taken HERE '}}. Photograph by {{hwmFileForm.value.FULLname || ' Source Name HERE ' }}, {{agencyNameForCap || ' Agency HERE '}}.
                        </span>
                    </div>
                </div>

                <!-- associated files -->
                <div *ngIf="addFileType === 'Existing' && selectedFile.FileEntity.filetype_id !== 8">
                    <label class="form-header">Associated File:</label>
                    <div>
                        <span *ngIf="fileItemExists">
                            <a target="_blank" title="Download File" href="{{fileSource}}">{{selectedFile.FileEntity.name}}</a>
                        </span>
                        <span *ngIf="!fileItemExists">-- Missing --</span>
                        <!--ReUpload Single Image with validations*-->
                        <div *ngIf="!fileItemExists">
                            <label class="custom-file-input" for="Upload">
                                <p class="required">*</p> {{ selectedFile.FileEntity.name || ' None Chosen' }}
                            </label>
                            <input #upload [hidden]="true" id="Upload" type="file" max="500000" file-model="existingFile.File" (change)="getFileName($event)">
                            <span *ngIf="fileUploading" class="file-upload-span">
                                Correct File?
                                <button aria-label="Upload" mat-button class="primary" *ngIf="fileUploading" type="button" (click)="saveFileUpload()">Upload</button>
                            </span>
                        </div>
                        <!-- change out the existing fileItem with a different one-->
                        <div *ngIf="fileItemExists">
                            <div>
                                <label class="custom-file-inputChange" for="Upload">
                                    <p class="required">*</p> {{ selectedFile.FileEntity.name || ' None Chosen' }}
                                </label>
                                <input #upload [hidden]="true" id="Upload" type="file" max="500000" file-model="existingFile.File1" (change)="getFileName($event)">
                            </div>
                            <span *ngIf="fileUploading" class="file-upload-span">
                                Correct File?
                                <button aria-label="Is this file correct?" mat-button class="primary" *ngIf="fileUploading" type="button" (click)="saveFileUpload()">Upload</button>
                            </span>
                        </div>
                    </div>
                </div>
                <div [hidden]="siteFileIsUploading" class="file-button-group">
                    <button aria-label="Save File" mat-button type="button" class="save-btn primary" *ngIf="selectedFile.FileEntity.file_id !== null" (click)="saveFile()">Save File</button>
                    <button aria-label="Create File" mat-button type="button" class="save-btn primary" *ngIf="selectedFile.FileEntity.file_id == null" (click)="createFile()">Create File</button>
                    <button aria-label="Close or Cancel File" mat-stroked-button class="secondary" style="margin-left: 10px" type="button" (click)="cancelFile()">Close/Cancel File</button>
                </div>
            </form>
            <div class="tableContainer" [hidden]="initHWMFiles?.length === 0">
                <table
                    mat-table
                    id="hwmFilesTable"
                    [dataSource]="initHWMFiles"
                    class="mat-elevation-z5"
                    multiTemplateDataRows
                >
                    <!-- file name column -->
                    <ng-container matColumnDef="FileName">
                        <th mat-header-cell *matHeaderCellDef>File Name</th>
                        <td mat-cell *matCellDef="let file">
                            <div>
                                {{file.name}}
                            </div>
                        </td>
                    </ng-container>

                    <!-- file date column -->
                    <ng-container matColumnDef="FileDate">
                        <th mat-header-cell *matHeaderCellDef>File Date</th>
                        <td mat-cell *matCellDef="let file">
                            <div>
                                {{file.file_date | date: 'MM/dd/yyyy'}}
                            </div>
                        </td>
                    </ng-container>

                    <!-- button column -->
                    <ng-container matColumnDef="expand">
                        <th mat-header-cell *matHeaderCellDef></th>
                        <td mat-cell *matCellDef="let element">
                            <button mat-stroked-button *ngIf="showFileForm || expandedElement != element" class="view-details-btn secondary" type="button" (click)="showFileDetails(element)"
                                aria-label="View Details">View Details
                            </button>
                            <button mat-stroked-button *ngIf="!showFileForm && expandedElement == element" class="view-details-btn secondary" type="button" (click)="showFileDetails(null)"
                                aria-label="Close Details">Close Details
                            </button>
                            <button *ngIf="showDetails || expandedElement != element" mat-stroked-button class="edit-details-btn secondary" type="button" (click)="showFileEdit(element)"
                                aria-label="Edit"><mat-icon class="edit-icon">edit</mat-icon>Edit
                            </button>
                            <button *ngIf="!showDetails && expandedElement == element" mat-stroked-button class="edit-details-btn secondary" type="button" (click)="showFileEdit(null)"
                                aria-label="Edit"><mat-icon class="edit-icon">edit</mat-icon>Close Edit
                            </button>
                            <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Icon-button with a menu" type="button">
                                <mat-icon>more_vert</mat-icon>
                            </button>
                            <mat-menu #menu="matMenu">
                                <button mat-menu-item *ngIf="showFileForm || expandedElement != element" class="view-details-mobile" type="button" (click)="showFileDetails(element)"
                                    aria-label="View Details"><mat-icon>search</mat-icon>
                                    <span> View Details</span>
                                </button>
                                <button mat-menu-item *ngIf="!showFileForm && expandedElement == element" class="view-details-mobile" type="button" (click)="showFileDetails(null)"
                                    aria-label="Close Details"><mat-icon>search</mat-icon>
                                    <span> Close Details</span>
                                </button>
                                <button *ngIf="showDetails || expandedElement != element" mat-menu-item class="edit-details-mobile" type="button" (click)="showFileEdit(element)"
                                    aria-label="Edit"><mat-icon class="edit-icon">edit</mat-icon>Edit
                                </button>
                                <button *ngIf="!showDetails && expandedElement == element" mat-menu-item class="edit-details-mobile" type="button" (click)="showFileEdit(null)"
                                    aria-label="Edit"><mat-icon class="edit-icon">edit</mat-icon>Close Edit
                                </button>
                                <button mat-menu-item class="delete-borderless" type="button" (click)="deleteFile(element)"
                                    aria-label="Delete"><mat-icon class="delete-borderless">delete_forever</mat-icon>
                                    <span>Delete</span>
                                </button>
                            </mat-menu>
                        </td>
                    </ng-container>
                    
                    <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
                    <ng-container matColumnDef="expandedDetail">
                        <td mat-cell *matCellDef="let element" [attr.colspan]="3">
                            <div class="element-detail"
                                [@detailExpand]="showFileForm && expandedElement == element ? 'expanded' : 'collapsed'">
                                <div class="expanded-body">
                                    <!-- Edit HWM File Form -->
                                    <form [formGroup]="hwmFileForm">
                                        <mat-form-field appearance="fill">
                                            <mat-label>File Type</mat-label>
                                            <mat-select aria-label="File Type" formControlName="filetype_id" (selectionChange)="getFileTypeSelection($event)">
                                                <mat-option *ngFor="let file of fileTypes" [value]="file.filetype_id">
                                                    {{file.filetype}}
                                                </mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                        
                                        <!--Upload Single Image with validations*-->
                                        <div *ngIf="addFileType === 'New' && selectedFile.FileEntity.filetype_id !== 8">
                                            <label class="custom-file-input-add" for="addFile">
                                                <p class="required">*</p> {{ selectedFile.FileEntity.name || ' None Chosen' }}
                                            </label>
                                            <input #upload id="addFile" class="upload-file" type="file" max="500000" [hidden]="true" (change)="getFileName($event)">
                                        </div>
                                        <br clear="all" />

                                        <!--File URL (LINK file)-->
                                        <div *ngIf="selectedFile.FileEntity.filetype_id === 8">
                                            <mat-form-field appearance="fill">
                                                <mat-label>File URL</mat-label>
                                                <input aria-label="File URL" formControlName="name" matInput [value]="selectedFile.FileEntity.name"/>
                                                <mat-icon matSuffix class="info-icon" matTooltip="Please link to persistent URLs or digital object identifier (doi) urls." 
                                                aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>                
                                            </mat-form-field>
                                        </div>

                                        <!--Source Name (photo)-->
                                        <div *ngIf="selectedFile.FileEntity.filetype_id === 1">
                                            <mat-form-field appearance="fill">
                                                <mat-label>Source Photographer</mat-label>
                                                <input aria-label="Source Photographer" formControlName="FULLname" matInput required [value]="selectedFile.FileEntity.FULLname"/>           
                                            </mat-form-field>
                                        </div>

                                        <!--Source Name (all other)-->
                                        <div *ngIf="selectedFile.FileEntity.filetype_id  > 2">
                                            <mat-form-field appearance="fill">
                                                <mat-label>Source Name</mat-label>
                                                <input aria-label="Source Name" formControlName="FULLname" matInput required [value]="selectedFile.FileEntity.FULLname"/>           
                                            </mat-form-field>
                                        </div>

                                        <!--Source Agency* (photo, allOther)-->
                                        <div *ngIf="selectedFile.FileEntity.filetype_id === 1 || selectedFile.FileEntity.filetype_id > 2">
                                            <mat-form-field appearance="fill">
                                                <mat-label>Source Agency</mat-label>
                                                <mat-select aria-label="Source Agency" required formControlName="agency_id" (selectionChange)="updateAgencyForCaption()">
                                                    <mat-option *ngFor="let a of agencies" [value]="a.agency_id">
                                                        {{a.agency_name}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field>
                                        </div>

                                        <!-- Photo Date* (photo) -->
                                        <div *ngIf="selectedFile.FileEntity.filetype_id === 1">
                                            <mat-form-field appearance="fill">
                                                <mat-label>Photo Date</mat-label>
                                                <input aria-label="Photo Date" matInput formControlName="photo_date" [value]="selectedFile.FileEntity.photo_date" [matDatepicker]="photoDatePicker" (dateChange)="formatDate($event)" required placeholder="Choose a date">
                                                <mat-datepicker-toggle matSuffix [for]="photoDatePicker"></mat-datepicker-toggle>
                                                <mat-datepicker [value]="selectedFile.FileEntity.photo_date" #photoDatePicker></mat-datepicker>
                                            </mat-form-field>
                                        </div>

                                        <!-- Date Uploaded* (photo, data, allother) -->
                                        <div *ngIf="selectedFile.FileEntity.filetype_id > 0">
                                            <mat-form-field appearance="fill">
                                                <mat-label>Date Uploaded</mat-label>
                                                <input aria-label="Date Uploaded" matInput formControlName="file_date" [value]="selectedFile.FileEntity.file_date" [matDatepicker]="fileDatePicker" required placeholder="Choose a date" (dateChange)="formatDate($event)">
                                                <mat-datepicker-toggle matSuffix [for]="fileDatePicker"></mat-datepicker-toggle>
                                                <mat-datepicker #fileDatePicker></mat-datepicker>
                                            </mat-form-field>
                                        </div>

                                        <!--Description*(photo, data, allother)-->
                                        <div *ngIf="selectedFile.FileEntity.filetype_id > 0">
                                            <mat-form-field appearance="fill">
                                                <mat-label for="description">Description</mat-label>
                                                <textarea aria-label="Description" matInput formControlName="description" required id="description" [value]="selectedFile.FileEntity.description"></textarea>
                                                <mat-icon [hidden]="selectedFile.FileEntity.filetype_id !== 1" matSuffix class="info-icon" matTooltip="Populates in Photo caption below. If a person or people appear in photo include name(s). If non-USGS personnel, ensure consent to publish name in caption is given." 
                                                aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                            </mat-form-field>
                                        </div>

                                        <!-- This is where Other ends, rest is for Photo -->
                                        <!--Photo Direction (photo)-->
                                        <div *ngIf="selectedFile.FileEntity.filetype_id === 1">
                                            <mat-form-field appearance="fill">
                                                <mat-label>Photo Direction</mat-label>
                                                <input aria-label="Photo Direction" formControlName="photo_direction" matInput [value]="selectedFile.FileEntity.photo_direction"/>           
                                            </mat-form-field>
                                        </div>

                                        <!-- Photo Latitude (photo)-->
                                        <div *ngIf="selectedFile.FileEntity.filetype_id === 1">
                                            <mat-form-field appearance="fill">
                                                <mat-label>Photo Latitude (if different)</mat-label>
                                                <input aria-label="Photo Latitude (if different)" formControlName="latitude_dd" matInput [value]="selectedFile.FileEntity.latitude_dd"/>           
                                            </mat-form-field>
                                        </div>
                                        <!-- LatDD Validator -->
                                        <div *ngIf="hwmFileForm.controls.latitude_dd.invalid && (hwmFileForm.controls.latitude_dd.dirty || hwmFileForm.controls.latitude_dd.touched)"
                                            class="alert alert-danger">
                                            <div *ngIf="hwmFileForm.controls.latitude_dd.errors?.['incorrectValue']">
                                                The latitude must be between 0 and 73.0.
                                            </div>
                                        </div>

                                        <!--Photo Longitude (photo)-->
                                        <div *ngIf="selectedFile.FileEntity.filetype_id === 1">
                                            <mat-form-field appearance="fill">
                                                <mat-label>Photo Longitude (if different)</mat-label>
                                                <input aria-label="Photo longitude (if different)" formControlName="longitude_dd" matInput [value]="selectedFile.FileEntity.longitude_dd"/>           
                                            </mat-form-field>
                                        </div>
                                        <!-- LonDD Validator -->
                                        <div *ngIf="hwmFileForm.controls.longitude_dd.invalid && (hwmFileForm.controls.longitude_dd.dirty || hwmFileForm.controls.longitude_dd.touched)"
                                            class="alert alert-danger">
                                            <div *ngIf="hwmFileForm.controls.longitude_dd.errors?.['incorrectValue']">
                                                The longitude must be between -175.0 and -60.0.
                                            </div>
                                        </div>

                                        <div *ngIf="selectedFile.FileEntity.filetype_id === 11">
                                            <label class="form-header" for="Caption">Preview Caption</label>
                                            <div>
                                                <span>
                                                    Photo of {{hwmFileForm.value.description || ' (Description HERE) '}} at {{siteForm.value.site_description}}, {{siteForm.value.county}}, {{siteForm.value.state}}, {{formattedPhotoDate || ' Date taken HERE '}}. Photograph by {{hwmFileForm.value.FULLname || ' Source Name HERE ' }}, {{agencyNameForCap || ' Agency HERE '}}.
                                                </span>
                                            </div>
                                        </div>

                                        <!-- associated files -->
                                        <div *ngIf="addFileType === 'Existing' && selectedFile.FileEntity.filetype_id !== 8">
                                            <label class="form-header">Associated File:</label>
                                            <div>
                                                <span *ngIf="fileItemExists">
                                                    <a target="_blank" title="Download File" href="{{fileSource}}">{{selectedFile.FileEntity.name}}</a>
                                                </span>
                                                <span *ngIf="!fileItemExists">-- Missing --</span>
                                                <!--ReUpload Single Image with validations*-->
                                                <div *ngIf="!fileItemExists">
                                                    <label class="custom-file-input" for="Upload">
                                                        <p class="required">*</p> {{ selectedFile.FileEntity.name || ' None Chosen' }}
                                                    </label>
                                                    <input #upload [hidden]="true" id="Upload" type="file" max="500000" file-model="existingFile.File" (change)="getFileName($event)">
                                                    <span *ngIf="fileUploading" class="file-upload-span">
                                                        Correct File?
                                                        <button aria-label="Upload" mat-button class="primary" *ngIf="fileUploading" type="button" (click)="saveFileUpload()">Upload</button>
                                                    </span>
                                                </div>
                                                <!-- change out the existing fileItem with a different one-->
                                                <div *ngIf="fileItemExists">
                                                    <div>
                                                        <label class="custom-file-inputChange" for="Upload">
                                                            <p class="required">*</p> {{ selectedFile.FileEntity.name || ' None Chosen' }}
                                                        </label>
                                                        <input #upload [hidden]="true" id="Upload" type="file" max="500000" file-model="existingFile.File1" (change)="getFileName($event)">
                                                    </div>
                                                    <span *ngIf="fileUploading" class="file-upload-span">
                                                        Correct File?
                                                        <button aria-label="Is this file correct?" mat-button class="primary" *ngIf="fileUploading" type="button" (click)="saveFileUpload()">Upload</button>
                                                    </span>
                                                </div>
                                            </div>
                                        </div>
                                        <div [hidden]="siteFileIsUploading" class="file-button-group">
                                            <button aria-label="Save File" mat-button type="button" class="save-btn primary" *ngIf="selectedFile.FileEntity.file_id !== null" (click)="saveFile()">Save File</button>
                                            <button aria-label="Create File" mat-button type="button" class="save-btn primary" *ngIf="selectedFile.FileEntity.file_id == null" (click)="createFile()">Create File</button>
                                            <button aria-label="Close or Cancel File" mat-stroked-button class="secondary" style="margin-left: 10px" type="button" (click)="cancelFile()">Close/Cancel File</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                            <div class="element-detail"
                                [@detailExpand]="showDetails && expandedElement == element ? 'expanded' : 'collapsed'">
                                <div class="expanded-body">
                                    <div class="table-container">
                                        <div class="outer-content">
                                            <div class="cell-container">
                                                <p class="content-left">File Type</p>
                                                <p class="content-right" *ngIf="fileType !== undefined && fileType !== ''; else nullFileType">{{fileType}}</p>
                                                <ng-template #nullFileType><p class="content-right">---</p></ng-template>
                                            </div>
                                            <div class="cell-container" *ngIf="element.is_nwis !== undefined && element.is_nwis === 1">
                                                <p class="content-left">File URL</p>
                                                <p class="content-right" *ngIf="element.name !== undefined && element.name !== ''; else nullFileURL">{{element.name}}</p>
                                                <ng-template #nullFileURL><p class="content-right">---</p></ng-template>
                                            </div>
                                            <div class="cell-container" *ngIf="fileType === 'Photo'">
                                                <p class="content-left">Source Photographer</p>
                                                <p class="content-right" *ngIf="sourceName !== undefined && sourceName !== ''; else nullSourceName">{{sourceName}}</p>
                                                <ng-template #nullSourceName><p class="content-right">---</p></ng-template>
                                            </div>
                                            <div class="cell-container" *ngIf="fileType !== 'Photo' && fileType !== 'Data' && (element.is_nwis === undefined || element.is_nwis !== 1)">
                                                <p class="content-left">Source Name</p>
                                                <p class="content-right" *ngIf="sourceName !== undefined && sourceName !== ''; else nullSourceName">{{sourceName}}</p>
                                                <ng-template #nullSourceName><p class="content-right">---</p></ng-template>
                                            </div>
                                            <div class="cell-container" *ngIf="fileType !== 'Photo' && fileType !== 'Data' && (element.is_nwis === undefined || element.is_nwis !== 1)">
                                                <p class="content-left">Source Agency</p>
                                                <p class="content-right" *ngIf="sourceAgency !== undefined && sourceAgency !== ''; else nullSourceAgency">{{sourceAgency}}</p>
                                                <ng-template #nullSourceAgency><p class="content-right">---</p></ng-template>
                                            </div>
                                            <div class="cell-container"  *ngIf="fileType === 'Photo'">
                                                <p class="content-left">Photo Date</p>
                                                <p class="content-right" *ngIf="element.photo_date !== undefined && element.photo_date !== ''; else nullPhotoDate">{{element.photo_date | date: 'MM/dd/yyyy'}}</p>
                                                <ng-template #nullPhotoDate><p class="content-right">---</p></ng-template>
                                            </div>
                                            <div class="cell-container">
                                                <p class="content-left">Date Uploaded</p>
                                                <p class="content-right" *ngIf="element.file_date !== undefined && element.file_date !== ''; else nullFileDate">{{element.file_date | date: 'MM/dd/yyyy'}}</p>
                                                <ng-template #nullFileDate><p class="content-right">---</p></ng-template>
                                            </div>
                                            <div class="cell-container">
                                                <p class="content-left">Description</p>
                                                <p class="content-right" *ngIf="element.description !== undefined && element.description !== ''; else nullDesc">{{element.description}}</p>
                                                <ng-template #nullDesc><p class="content-right">---</p></ng-template>
                                            </div>
                                            <div class="cell-container" *ngIf="fileType === 'Photo'">
                                                <p class="content-left">Photo Direction</p>
                                                <p class="content-right" *ngIf="element.photo_direction !== undefined && element.photo_direction !== ''; else nullPhotoDir">{{element.photo_direction}}</p>
                                                <ng-template #nullPhotoDir><p class="content-right">---</p></ng-template>
                                            </div>
                                            <div class="cell-container" *ngIf="fileType === 'Photo'">
                                                <p class="content-left">Photo Latitude (if different)</p>
                                                <p class="content-right" *ngIf="element.latitude_dd !== undefined && element.latitude_dd !== ''; else nullPhotoLat">{{element.latitude_dd}}</p>
                                                <ng-template #nullPhotoLat><p class="content-right">---</p></ng-template>
                                            </div>
                                            <div class="cell-container" *ngIf="fileType === 'Photo'">
                                                <p class="content-left">Photo Longitude (if different)</p>
                                                <p class="content-right" *ngIf="element.longitude_dd !== undefined && element.longitude_dd !== ''; else nullPhotoLon">{{element.longitude_dd}}</p>
                                                <ng-template #nullPhotoLon><p class="content-right">---</p></ng-template>
                                            </div>
                                            <div class="cell-container" *ngIf="fileType === 'Photo'">
                                                <p class="content-left">Preview Caption</p>
                                                <p class="content-right">Photo of {{previewCaption.description}} at {{previewCaption.site_description}}, {{previewCaption.county}}, {{previewCaption.state}}, {{previewCaption.photo_date}}.  Photograph by {{previewCaption.sourceName}}, {{previewCaption.sourceAgency}}</p>
                                            </div>
                                            <div class="cell-container" *ngIf="element.is_nwis === undefined || element.is_nwis !== 1">
                                                <p class="content-left">Associated File</p>
                                                <p class="content-right" *ngIf="fileItemExists; else nullAssociatedFile"><a id="associatedFile" href="{{associatedFileUrl}}" target="_blank">{{element.name}}</a></p>
                                                <ng-template #nullAssociatedFile><p class="content-right">---Missing---</p></ng-template>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedFileColumns"></tr>
                    <tr mat-row *matRowDef="let element; columns: displayedFileColumns;">
                    </tr>
                    <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="detail-row"></tr>
                </table>
            </div>
            </mat-expansion-panel>
        </mat-accordion>
    </mat-dialog-content>
    <mat-dialog-actions align="end">
        <div class="detail-section-buttons centered">
            <div class="ref-button-group">
                <button *ngIf="editOrCreate === 'Edit'" class="primary" mat-button cdkFocusInitial aria-label="Save" type="submit">Save</button>
                <button *ngIf="editOrCreate === 'Create'" class="primary" mat-button cdkFocusInitial aria-label="Create" type="submit">Create</button>
                <button class="secondary cancel-btn" mat-stroked-button [mat-dialog-close]="{returnFiles: returnFiles}" cdkFocusInitial aria-label="Cancel">Cancel</button>
            </div>
        </div>
    </mat-dialog-actions>
</form>

