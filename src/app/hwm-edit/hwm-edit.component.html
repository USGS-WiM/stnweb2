<h2 mat-dialog-title>
    HWM Edit
    <button class="close-button" mat-button mat-dialog-close aria-label="Exit"><mat-icon>close</mat-icon></button>
</h2>

<form [formGroup]="form" (ngSubmit)="submit()">
    <mat-dialog-content>
        <mat-accordion multi="true">
            <mat-expansion-panel hideToggle [expanded]="infoExpanded" (opened)="infoExpanded = true" (closed)="infoExpanded = false">
            <mat-expansion-panel-header>
                <mat-panel-title *ngIf="!infoExpanded" style="color: grey; font-weight: 500">
                    HWM Information
                </mat-panel-title>
                <mat-panel-title *ngIf="infoExpanded" style="color: #FFF; font-weight: 550">
                    HWM Information
                </mat-panel-title>
            </mat-expansion-panel-header>
            <mat-form-field appearance="fill">
                <mat-label>Waterbody</mat-label>
                <input aria-label="Waterbody" matInput formControlName="waterbody" [value]="hwm.waterbody"/>
            </mat-form-field>
            <div *ngIf="role === 3 || role === 2">
                <label class="form-header">Event: </label> {{this.hwm.eventName}}
            </div>
            <div *ngIf="role === 1">
                <mat-form-field appearance="fill">
                    <mat-label>Event</mat-label>
                    <mat-select aria-label="Event" required formControlName="event_id">
                        <mat-option *ngFor="let event of events" [value]="event.event_id">
                        {{event.event_name}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
            </div>
            <mat-form-field appearance="fill">
                <mat-label>HWM Type</mat-label>
                <mat-select aria-label="HWM Type" required formControlName="hwm_type_id">
                    <mat-option *ngFor="let type of hwmTypes" [value]="type.hwm_type_id">
                    {{type.hwm_type}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Marker</mat-label>
                <mat-select aria-label="Marker" formControlName="marker_id">
                    <mat-option *ngFor="let marker of hwmMarkers" [value]="marker.marker_id">
                    {{marker.marker1}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Label</mat-label>
                <input aria-label="Label" matInput formControlName="hwm_label" required [value]="hwm.hwm_label"/>
                <mat-icon matSuffix class="info-icon" matTooltip="Label for distinguishing hwm from other hwms at this site-event. Limited to 12 characters.">info</mat-icon>
            </mat-form-field>
            <div>
                <label class="form-header">HWM Environment:</label>
                <mat-radio-group class="radio-btn-group" [(value)]="hwm_environment" (change)="changeHWMEnvironment($event.value)">
                    <mat-radio-button class="radio-button" value="Coastal">Coastal</mat-radio-button>
                    <mat-radio-button class="radio-button" value="Riverine">Riverine</mat-radio-button>
                </mat-radio-group>
            </div>
            <mat-form-field appearance="fill">
                <mat-label>HWM Uncertainty</mat-label>
                <input aria-label="HWM Uncertainty" type="number" matInput formControlName="hwm_uncertainty" (change)="chooseQuality()"  [value]="hwm.hwm_uncertainty"/>
                <mat-icon matSuffix class="info-icon" matTooltip="A numeric uncertainty entered here is the preferred method of recording uncertainty and represents the vertical range of peak surfaces that could be described by the HWM evidence (see TM3-A24, pg.27). Do not include any survey uncertainty, which is entered further below.">info</mat-icon>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>HWM Quality</mat-label>
                <mat-select aria-label="HWM Quality" required formControlName="hwm_quality_id" (selectionChange)="compareToUncertainty()" >
                    <mat-option *ngFor="let quality of hwmQualities" [value]="quality.hwm_quality_id">
                    {{quality.hwm_quality}}
                    </mat-option>
                </mat-select>
                <mat-icon matSuffix class="info-icon" matTooltip="For continuity with older data, a shorthand quality is auto-populated here based on a numeric uncertainty entered above. In addition, three qualities with undefined uncertainties are available.">info</mat-icon>
            </mat-form-field>
            <div>
                <label class="form-header">Bank:</label>
                <mat-radio-group class="radio-btn-group" [(value)]="hwmBank" (change)="changeBank($event.value)">
                    <mat-radio-button class="radio-button" value="Left">Left</mat-radio-button>
                    <mat-radio-button class="radio-button" value="Right">Right</mat-radio-button>
                    <mat-radio-button class="radio-button" value="N/A">N/A</mat-radio-button>
                </mat-radio-group>
            </div>
            <mat-form-field appearance="fill">
                <mat-label for="description">Location Description</mat-label>
                <textarea aria-label="description" matInput formControlName="hwm_locationdescription" id="location_description" [value]="hwm.hwm_locationdescription"></textarea>
                <mat-icon matSuffix class="info-icon" matTooltip="Please be specific so someone else can find this sensor later. This field is public." 
                    aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
            </mat-form-field>
            <div>
                <mat-radio-group class="radio-btn-group" [(ngModel)]="latLngUnit" [ngModelOptions]="{standalone: true}" (change)="changeLatLngUnit($event)">
                    <mat-radio-button class="radio-button" value="decdeg">Dec Deg</mat-radio-button>
                    <mat-radio-button class="radio-button" value="dms">DMS</mat-radio-button>
                </mat-radio-group>   
            </div>
            <div *ngIf="latLngUnit === 'decdeg'">            
                <mat-form-field appearance="fill">
                    <mat-label>Latitude</mat-label>
                    <input aria-label="Latitude" type="number" required matInput formControlName="latitude_dd" [value]="hwm.latitude_dd"/>
                </mat-form-field>
                <!-- LatDD Validator -->
                <div *ngIf="form.controls.latitude_dd.invalid && (form.controls.latitude_dd.dirty || form.controls.latitude_dd.touched)"
                    class="alert alert-danger">
                    <div *ngIf="form.controls.latitude_dd.errors?.['incorrectValue']">
                        The latitude must be between 0 and 73.0.
                    </div>
                </div>
                <mat-form-field appearance="fill">
                    <mat-label>Longitude</mat-label>
                    <input aria-label="longitude" type="number" required matInput formControlName="longitude_dd" [value]="hwm.longitude_dd"/>
                </mat-form-field>
                <!-- LonDD Validator -->
                <div *ngIf="form.controls.longitude_dd.invalid && (form.controls.longitude_dd.dirty || form.controls.longitude_dd.touched)"
                    class="alert alert-danger">
                    <div *ngIf="form.controls.longitude_dd.errors?.['incorrectValue']">
                        The longitude must be between -175.0 and -60.0.
                    </div>
                </div>
            </div>
            <div *ngIf="latLngUnit === 'dms'">
                <table>
                    <tr>
                        <td>
                            <label>Latitude</label>
                        </td>
                        <td>
                            <mat-form-field appearance="fill">
                                <mat-label>Degree</mat-label>
                                <input type="number" aria-label="Degree" required formControlName="latdeg" matInput [value]="dms.latdeg"/>
                            </mat-form-field>
                        </td>
                        <td>°</td>
                        <td>
                            <mat-form-field appearance="fill">
                                <mat-label>Minute</mat-label>
                                <input type="number" aria-label="Minute" required formControlName="latmin" matInput [value]="dms.latmin"/>
                            </mat-form-field>
                        </td>
                        <td>′</td>
                        <td>
                            <mat-form-field appearance="fill">
                                <mat-label>Second</mat-label>
                                <input type="number" aria-label="Second" required formControlName="latsec" matInput [value]="dms.latsec"/>
                            </mat-form-field>
                        </td>
                        <td>″</td>
                    </tr>
                </table>
                <!-- LatDD Validator -->
                <div *ngIf="form.controls.latdeg.invalid && (form.controls.latdeg.dirty || form.controls.latdeg.touched)"
                    class="alert alert-danger">
                    <div *ngIf="form.controls.latdeg.errors?.['incorrectValue']">
                        The latitude must be between -175.0 and -60.0.
                    </div>
                </div>
                <div *ngIf="form.controls.latmin.invalid && (form.controls.latmin.dirty || form.controls.latmin.touched)"
                    class="alert alert-danger">
                    <div *ngIf="form.controls.latmin.errors?.['incorrectValue']">
                        The latitude must be between 0 and 73.
                    </div>
                </div>
                <div *ngIf="form.controls.latsec.invalid && (form.controls.latsec.dirty || form.controls.latsec.touched)"
                    class="alert alert-danger">
                    <div *ngIf="form.controls.latsec.errors?.['incorrectValue']">
                        The latitude must be between 0 and 73.
                    </div>
                </div>
                <table>
                    <tr>
                        <td>
                            <label>Longitude</label>
                        </td>
                        <td>
                            <mat-form-field appearance="fill">
                                <mat-label>Degree</mat-label>
                                <input type="number" aria-label="Degree" required formControlName="londeg" matInput [value]="dms.londeg"/>
                            </mat-form-field>
                        </td>
                        <td>°</td>
                        <td>
                            <mat-form-field appearance="fill">
                                <mat-label>Minute</mat-label>
                                <input type="number" aria-label="Minute" required formControlName="lonmin" matInput [value]="dms.lonmin"/>
                            </mat-form-field>
                        </td>
                        <td>′</td>
                        <td>
                            <mat-form-field appearance="fill">
                                <mat-label>Second</mat-label>
                                <input type="number" aria-label="Second" required formControlName="lonsec" matInput [value]="dms.lonsec"/>
                            </mat-form-field>
                        </td>
                        <td>″</td>
                    </tr>
                </table>
                <!-- LonDD Validator -->
                <div *ngIf="form.controls.londeg.invalid && (form.controls.londeg.dirty || form.controls.londeg.touched)"
                    class="alert alert-danger">
                    <div *ngIf="form.controls.londeg.errors?.['incorrectValue']">
                        The longitude must be between -175.0 and -60.0.
                    </div>
                </div>
                <div *ngIf="form.controls.lonmin.invalid && (form.controls.lonmin.dirty || form.controls.lonmin.touched)"
                    class="alert alert-danger">
                    <div *ngIf="form.controls.lonmin.errors?.['incorrectValue']">
                        The longitude must be between -175.0 and -60.0.
                    </div>
                </div>
                <div *ngIf="form.controls.lonsec.invalid && (form.controls.lonsec.dirty || form.controls.lonsec.touched)"
                    class="alert alert-danger">
                    <div *ngIf="form.controls.lonsec.errors?.['incorrectValue']">
                        The longitude must be between -175.0 and -60.0.
                    </div>
                </div>
            </div>
            <mat-form-field appearance="fill">
                <mat-label>Horizontal Datum</mat-label>
                <mat-select aria-label="Horizontal Datum" required formControlName="hdatum_id">
                    <mat-option *ngFor="let datum of hdatums" [value]="datum.datum_id">
                    {{datum.datum_name}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Horizontal Collection Method</mat-label>
                <mat-select aria-label="Horizontal Collection Method" required formControlName="hcollect_method_id">
                    <mat-option *ngFor="let method of hmethods" [value]="method.hcollect_method_id">
                    {{method.hcollect_method}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Height Above Ground (Ft)</mat-label>
                <input type="number" aria-label="Height Above Ground" matInput formControlName="height_above_gnd" [value]="hwm.height_above_gnd"/>
            </mat-form-field>
            <div>
                <label class="form-header">Tranquil/Stillwater HWM:</label>
                <mat-radio-group class="radio-btn-group" [(value)]="isStillwater" (change)="changeStillwater($event.value)">
                    <mat-radio-button class="radio-button" value="Yes">Yes</mat-radio-button>
                    <mat-radio-button class="radio-button" value="No">No</mat-radio-button>
                    <mat-icon matSuffix class="info-icon" matTooltip="For modeling purposes, all high water marks are assumed to be rapid-water high-water marks unless the user is confident that the mark being entered here was formed in tranquil water. See TM3-A24 for a discussion on rapid versus tranquil high-water marks.">info</mat-icon>
                </mat-radio-group>
            </div>
            <mat-form-field appearance="fill">
                <mat-label>Flag/Found Date</mat-label>
                <input aria-label="Flag/Found Date" matInput formControlName="flag_date" [value]="hwm.flag_date" [matDatepicker]="flagDatePicker" required placeholder="Choose a date">
                <mat-datepicker-toggle matSuffix [for]="flagDatePicker"></mat-datepicker-toggle>
                <mat-datepicker [value]="hwm.flag_date" #flagDatePicker></mat-datepicker>
            </mat-form-field>
            <div>
                <label class="form-header">Flagging Member: </label> {{flagMember}}
            </div>
            <mat-divider></mat-divider>
            <mat-form-field appearance="fill">
                <mat-label>Surveyed Date</mat-label>
                <input aria-label="Surveyed Date" matInput formControlName="survey_date" [value]="hwm.survey_date" [matDatepicker]="surveyedDatePicker" placeholder="Choose a date">
                <mat-datepicker-toggle matSuffix [for]="surveyedDatePicker"></mat-datepicker-toggle>
                <mat-datepicker [value]="hwm.survey_date" #surveyedDatePicker></mat-datepicker>
                <mat-icon matSuffix class="info-icon" matTooltip="Elevation required below if survey date is populated">info</mat-icon>
            </mat-form-field>
            <div>
                <label class="form-header">Survey Member: </label> {{surveyMember}}
            </div>
            <mat-form-field appearance="fill">
                <mat-label>Surveyed Elevation (Ft)</mat-label>
                <input type="number" aria-label="Surveyed Elevation" matInput formControlName="elev_ft" [value]="hwm.elev_ft"/>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Vertical Datum</mat-label>
                <mat-select aria-label="Vertical Datum" formControlName="vdatum_id">
                    <mat-option *ngFor="let datum of vdatums" [value]="datum.datum_id">
                    {{datum.datum_name}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label>Vertical Collection Method</mat-label>
                <mat-select aria-label="Vertical Collection Method" formControlName="vcollect_method_id" [(value)]="hwm.vcollect_method_id">
                    <mat-option *ngFor="let method of vmethods" [value]="method.vcollect_method_id">
                    {{method.vcollect_method}}
                    </mat-option>
                </mat-select>
            </mat-form-field>
            <mat-radio-group class="radio-btn-group" [(value)]="uncertainty_unit" (change)="uncertaintyUnitChange($event.value)">
                <mat-radio-button class="radio-button" value="ft">+/- ft</mat-radio-button>
                <mat-radio-button class="radio-button" value="cm">+/- cm</mat-radio-button>
            </mat-radio-group>
            <mat-form-field id="uncertainty" appearance="fill">
                <mat-label for="uncertainty">Survey Uncertainty</mat-label>
                <input type="number" aria-label="Uncertainty" matInput formControlName="uncertainty" [value]="hwm.uncertainty"/>
            </mat-form-field>
            <mat-form-field appearance="fill">
                <mat-label for="description">Notes</mat-label>
                <textarea aria-label="description" matInput formControlName="hwm_notes" id="hwm_notes" [value]="hwm.hwm_notes"></textarea>
            </mat-form-field>
            <div *ngIf="approved">
                <div>
                    <label class="form-header">Approved By: </label> {{approvalMember}}
                </div>
                <div class="vertically-aligned">
                    <label class="form-header">Approved On: </label> {{approvalDate}}
                    <mat-icon class="info-icon" matTooltip="Time displayed as local, stored in UTC.">info</mat-icon>
                </div>
            </div>
            </mat-expansion-panel>
            <mat-expansion-panel hideToggle [expanded]="filesExpanded"  (opened)="filesExpanded = true" (closed)="filesExpanded = false">
            <mat-expansion-panel-header>
                <mat-panel-title *ngIf="!filesExpanded" style="color: grey; font-weight: 500">
                    HWM File Information
                </mat-panel-title>
                <mat-panel-title *ngIf="filesExpanded" style="color: #FFF; font-weight: 550">
                    HWM File Information
                </mat-panel-title>
            </mat-expansion-panel-header>
            <button mat-stroked-button class="add-button" type="button"><mat-icon>add</mat-icon> Add File</button>
            <div class="tableContainer" [hidden]="initHWMFiles?.length === 0">
                <table
                    mat-table
                    id="hwmFilesTable"
                    [dataSource]="initHWMFiles"
                    class="mat-elevation-z5"
                >
                    <!-- file name column -->
                    <ng-container matColumnDef="FileName">
                        <th mat-header-cell *matHeaderCellDef>File Name</th>
                        <td mat-cell *matCellDef="let file">
                            <div>
                                {{file.name}}
                            </div>
                        </td>
                    </ng-container>

                    <!-- file date column -->
                    <ng-container matColumnDef="FileDate">
                        <th mat-header-cell *matHeaderCellDef>File Date</th>
                        <td mat-cell *matCellDef="let file">
                            <div>
                                {{file.format_file_date}}
                            </div>
                        </td>
                    </ng-container>

                    <tr mat-header-row *matHeaderRowDef="displayedFileColumns"></tr>
                    <tr
                        mat-row
                        *matRowDef="let row; columns: displayedFileColumns"
                        class="file-table"
                    ></tr>
                </table>
            </div>
            </mat-expansion-panel>
        </mat-accordion>
    </mat-dialog-content>
    <mat-dialog-actions align="end">
        <div class="detail-section-buttons centered">
            <div class="ref-button-group">
                <button class="primary save-btn" mat-button cdkFocusInitial aria-label="Save" type="submit">Save</button>
                <button class="cancel-btn" mat-stroked-button mat-dialog-close cdkFocusInitial aria-label="Cancel">Cancel</button>
            </div>
        </div>
    </mat-dialog-actions>
</form>

