<h2 mat-dialog-title>
    HWM Edit
    <!-- <button class="close-button" mat-button mat-dialog-close aria-label="Exit"><mat-icon>close</mat-icon></button> -->
</h2>
<mat-dialog-content *ngIf="data.row_data">
    <mat-accordion multi="true">
        <mat-expansion-panel hideToggle [expanded]="infoExpanded" (opened)="infoExpanded = true" (closed)="infoExpanded = false">
        <mat-expansion-panel-header>
            <mat-panel-title *ngIf="!infoExpanded" style="color: grey; font-weight: 500">
                HWM Information
            </mat-panel-title>
            <mat-panel-title *ngIf="infoExpanded" style="color: #FFF; font-weight: 550">
                HWM Information
            </mat-panel-title>
        </mat-expansion-panel-header>
        <mat-form-field appearance="fill">
            <mat-label>Waterbody</mat-label>
            <input aria-label="Waterbody" matInput formControlName="waterbody" required [value]="hwm.waterbody"/>
        </mat-form-field>
        <mat-form-field appearance="fill">
            <mat-label>Event</mat-label>
            <input aria-label="Event" matInput formControlName="event" required [value]="hwm.event"/>
        </mat-form-field>
        <mat-select aria-label="HWM Type" formControlName="hwm_type">
            <mat-option *ngFor="let type of hwmTypes" [value]="type.type">
            {{type.type_name}}
            </mat-option>
        </mat-select>
        <mat-select aria-label="Marker" formControlName="marker">
            <mat-option *ngFor="let marker of markers" [value]="marker.id">
            {{marker.marker_name}}
            </mat-option>
        </mat-select>
        <mat-form-field appearance="fill">
            <mat-label>Label</mat-label>
            <input aria-label="Label" matInput formControlName="label" required [value]="hwm.label"/>
            <mat-icon matSuffix class="info-icon" matTooltip="Label for distinguishing hwm from other hwms at this site-event. Limited to 12 characters.">info</mat-icon>
        </mat-form-field>
        <mat-radio-group class="radio-btn-group" [(value)]="hwm_environment" (change)="changeHWMEnvironment($event)">
            <mat-radio-button class="radio-button" value="coastal">Coastal</mat-radio-button>
            <mat-radio-button class="radio-button" value="riverine">Riverine</mat-radio-button>
        </mat-radio-group>
        <mat-form-field appearance="fill">
            <mat-label>HWM Uncertainty</mat-label>
            <input aria-label="HWM Uncertainty" matInput formControlName="hwm_uncertainty" required [value]="hwm.hwm_uncertainty"/>
            <mat-icon matSuffix class="info-icon" matTooltip="A numeric uncertainty entered here is the preferred method of recording uncertainty and represents the vertical range of peak surfaces that could be described by the HWM evidence (see TM3-A24, pg.27). Do not include any survey uncertainty, which is entered further below.">info</mat-icon>
        </mat-form-field>
        <mat-select aria-label="HWM Quality" formControlName="hwm_quality">
            <mat-option *ngFor="let quality of hwm_qualities" [value]="quality.hwm_quality_id">
            {{quality.quality}}
            </mat-option>
            <mat-icon matSuffix class="info-icon" matTooltip="For continuity with older data, a shorthand quality is auto-populated here based on a numeric uncertainty entered above. In addition, three qualities with undefined uncertainties are available.">info</mat-icon>
        </mat-select>
        <mat-radio-group class="radio-btn-group" [(value)]="bank" (change)="changeHWMEnvironment($event)">
            <mat-radio-button class="radio-button" value="left">Left</mat-radio-button>
            <mat-radio-button class="radio-button" value="right">Right</mat-radio-button>
            <mat-radio-button class="radio-button" value="n/a">N/A</mat-radio-button>
        </mat-radio-group>
        <mat-form-field appearance="fill">
            <mat-label for="description">Location Description</mat-label>
            <textarea aria-label="description" matInput formControlName="location_description" required id="location_description" [value]="hwm.location_description"></textarea>
            <mat-icon matSuffix class="info-icon" matTooltip="Please be specific so someone else can find this sensor later. This field is public." 
                aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
        </mat-form-field>
        <div>
            <mat-radio-group class="radio-btn-group" [(ngModel)]="latLngUnit" [ngModelOptions]="{standalone: true}" (change)="changeLatLngUnit($event)">
                <mat-radio-button class="radio-button" value="decdeg">Dec Deg</mat-radio-button>
                <mat-radio-button class="radio-button" value="dms">DMS</mat-radio-button>
            </mat-radio-group>   
        </div>
        <div *ngIf="latLngUnit === 'decdeg'">            
            <mat-form-field appearance="fill">
                <mat-label>Latitude</mat-label>
                <input aria-label="Latitude" matInput formControlName="latitude_dd" [value]="rd.latitude_dd"/>
            </mat-form-field>
            <!-- LatDD Validator -->
            <div *ngIf="form.controls.latitude_dd.invalid && (form.controls.latitude_dd.dirty || form.controls.latitude_dd.touched)"
                class="alert alert-danger">
                <div *ngIf="form.controls.latitude_dd.errors?.['incorrectValue']">
                    The latitude must be between 0 and 73.0.
                </div>
            </div>
            <mat-form-field appearance="fill">
                <mat-label>Longitude</mat-label>
                <input aria-label="longitude" matInput formControlName="longitude_dd" [value]="rd.longitude_dd"/>
            </mat-form-field>
            <!-- LonDD Validator -->
            <div *ngIf="form.controls.longitude_dd.invalid && (form.controls.longitude_dd.dirty || form.controls.longitude_dd.touched)"
                class="alert alert-danger">
                <div *ngIf="form.controls.longitude_dd.errors?.['incorrectValue']">
                    The longitude must be between -175.0 and -60.0.
                </div>
            </div>
        </div>
        <div *ngIf="latLngUnit === 'dms'">
            <table>
                <tr>
                    <td>
                        <label>Latitude</label>
                    </td>
                    <td>
                        <mat-form-field appearance="fill">
                            <mat-label>Degree</mat-label>
                            <input aria-label="Degree" required formControlName="latdeg" matInput [value]="dms.latdeg"/>
                        </mat-form-field>
                    </td>
                    <td>°</td>
                    <td>
                        <mat-form-field appearance="fill">
                            <mat-label>Minute</mat-label>
                            <input aria-label="Minute" required formControlName="latmin" matInput [value]="dms.latmin"/>
                        </mat-form-field>
                    </td>
                    <td>′</td>
                    <td>
                        <mat-form-field appearance="fill">
                            <mat-label>Second</mat-label>
                            <input aria-label="Second" required formControlName="latsec" matInput [value]="dms.latsec"/>
                        </mat-form-field>
                    </td>
                    <td>″</td>
                </tr>
            </table>
            <!-- LatDD Validator -->
            <div *ngIf="form.controls.latdeg.invalid && (form.controls.latdeg.dirty || form.controls.latdeg.touched)"
                class="alert alert-danger">
                <div *ngIf="form.controls.latdeg.errors?.['incorrectValue']">
                    The latitude must be between -175.0 and -60.0.
                </div>
            </div>
            <div *ngIf="form.controls.latmin.invalid && (form.controls.latmin.dirty || form.controls.latmin.touched)"
                class="alert alert-danger">
                <div *ngIf="form.controls.latmin.errors?.['incorrectValue']">
                    The latitude must be between 0 and 73.
                </div>
            </div>
            <div *ngIf="form.controls.latsec.invalid && (form.controls.latsec.dirty || form.controls.latsec.touched)"
                class="alert alert-danger">
                <div *ngIf="form.controls.latsec.errors?.['incorrectValue']">
                    The latitude must be between 0 and 73.
                </div>
            </div>
            <table>
                <tr>
                    <td>
                        <label>Longitude</label>
                    </td>
                    <td>
                        <mat-form-field appearance="fill">
                            <mat-label>Degree</mat-label>
                            <input aria-label="Degree" required formControlName="londeg" matInput [value]="dms.londeg"/>
                        </mat-form-field>
                    </td>
                    <td>°</td>
                    <td>
                        <mat-form-field appearance="fill">
                            <mat-label>Minute</mat-label>
                            <input aria-label="Minute" required formControlName="lonmin" matInput [value]="dms.lonmin"/>
                        </mat-form-field>
                    </td>
                    <td>′</td>
                    <td>
                        <mat-form-field appearance="fill">
                            <mat-label>Second</mat-label>
                            <input aria-label="Second" required formControlName="lonsec" matInput [value]="dms.lonsec"/>
                        </mat-form-field>
                    </td>
                    <td>″</td>
                </tr>
            </table>
            <!-- LonDD Validator -->
            <div *ngIf="form.controls.londeg.invalid && (form.controls.londeg.dirty || form.controls.londeg.touched)"
                class="alert alert-danger">
                <div *ngIf="form.controls.londeg.errors?.['incorrectValue']">
                    The longitude must be between -175.0 and -60.0.
                </div>
            </div>
            <div *ngIf="form.controls.lonmin.invalid && (form.controls.lonmin.dirty || form.controls.lonmin.touched)"
                class="alert alert-danger">
                <div *ngIf="form.controls.lonmin.errors?.['incorrectValue']">
                    The longitude must be between -175.0 and -60.0.
                </div>
            </div>
            <div *ngIf="form.controls.lonsec.invalid && (form.controls.lonsec.dirty || form.controls.lonsec.touched)"
                class="alert alert-danger">
                <div *ngIf="form.controls.lonsec.errors?.['incorrectValue']">
                    The longitude must be between -175.0 and -60.0.
                </div>
            </div>
        </div>
        <mat-form-field appearance="fill">
            <mat-label>Horizontal Datum</mat-label>
            <mat-select aria-label="Horizontal Datum" formControlName="hdatum_id">
                <mat-option *ngFor="let datum of hdatums" [value]="datum.datum_id">
                {{datum.datum_name}}
                </mat-option>
            </mat-select>
        </mat-form-field>
        <mat-form-field appearance="fill">
            <mat-label>Horizontal Collection Method</mat-label>
            <mat-select aria-label="Horizontal Collection Method" formControlName="hcollect_method_id">
                <mat-option *ngFor="let method of hmethods" [value]="method.hcollect_method_id">
                {{method.hcollect_method}}
                </mat-option>
            </mat-select>
        </mat-form-field>
        <mat-form-field appearance="fill">
            <mat-label>Height Above Ground (Ft)</mat-label>
            <input aria-label="Height Above Ground" matInput formControlName="height_above_ground" required [value]="hwm.height_above_ground"/>
        </mat-form-field>
        <mat-radio-group class="radio-btn-group" [(value)]="tranquil" (change)="isTranquil($event)">
            <mat-radio-button class="radio-button" value="yes">Yes</mat-radio-button>
            <mat-radio-button class="radio-button" value="no">No</mat-radio-button>
            <mat-icon matSuffix class="info-icon" matTooltip="For modeling purposes, all high water marks are assumed to be rapid-water high-water marks unless the user is confident that the mark being entered here was formed in tranquil water. See TM3-A24 for a discussion on rapid versus tranquil high-water marks.">info</mat-icon>
        </mat-radio-group>
        <mat-form-field appearance="fill">
            <mat-label>Flag/Found Date</mat-label>
            <input aria-label="Flag/Found Date" matInput formControlName="flag_date" [value]="rd.flag_date" [matDatepicker]="flagDatePicker" required placeholder="Choose a date">
            <mat-datepicker-toggle matSuffix [for]="flagDatePicker"></mat-datepicker-toggle>
            <mat-datepicker [value]="hwm.flag_date" #flagDatePicker></mat-datepicker>
        </mat-form-field>
        <mat-form-field appearance="fill">
            <mat-label>Surveyed Date</mat-label>
            <input aria-label="Surveyed Date" matInput formControlName="surveyed_date" [value]="rd.surveyed_date" [matDatepicker]="surveyedDatePicker" required placeholder="Choose a date">
            <mat-datepicker-toggle matSuffix [for]="surveyedDatePicker"></mat-datepicker-toggle>
            <mat-datepicker [value]="hwm.surveyed_date" #surveyedDatePicker></mat-datepicker>
            <mat-icon matSuffix class="info-icon" matTooltip="Elevation required below if survey date is populated">info</mat-icon>
        </mat-form-field>
        <mat-form-field appearance="fill">
            <mat-label>Surveyed Elevation (Ft)</mat-label>
            <input aria-label="Surveyed Elevation" matInput formControlName="surveyed_elevation" required [value]="hwm.surveyed_elevation"/>
        </mat-form-field>
        <mat-form-field appearance="fill">
            <mat-label>Vertical Datum</mat-label>
            <mat-select aria-label="Vertical Datum" required formControlName="vdatum_id">
                <mat-option *ngFor="let datum of vdatums" [value]="datum.datum_id">
                {{datum.datum_name}}
                </mat-option>
            </mat-select>
        </mat-form-field>
        <mat-form-field appearance="fill">
            <mat-label>Vertical Collection Method</mat-label>
            <mat-select aria-label="Vertical Collection Method" formControlName="vcollect_method_id" [(value)]="rd.vcollect_method_id">
                <mat-option *ngFor="let method of vmethods" [value]="method.vcollect_method_id">
                {{method.vcollect_method}}
                </mat-option>
            </mat-select>
        </mat-form-field>
        <mat-radio-group class="radio-btn-group" [(value)]="uncertainty_unit" (change)="uncertaintyUnitChange($event)">
            <mat-radio-button class="radio-button" value="ft">ft</mat-radio-button>
            <mat-radio-button class="radio-button" value="cm">cm</mat-radio-button>
        </mat-radio-group>
        <mat-form-field id="uncertainty" appearance="fill">
            <mat-label for="uncertainty">Uncertainty</mat-label>
            <input aria-label="Uncertainty" matInput formControlName="uncertainty" [value]="rd.uncertainty"/>
            <mat-icon matSuffix class="info-icon" matTooltip="From GNSS or OPUS solution.">info</mat-icon>
        </mat-form-field>
        <mat-form-field appearance="fill">
            <mat-label for="description">Location Description</mat-label>
            <textarea aria-label="description" matInput formControlName="location_description" required id="location_description" [value]="hwm.location_description"></textarea>
            <mat-icon matSuffix class="info-icon" matTooltip="Please be specific so someone else can find this sensor later. This field is public." 
                aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
        </mat-form-field>
        </mat-expansion-panel>
        <mat-expansion-panel hideToggle [expanded]="filesExpanded"  (opened)="filesExpanded = true" (closed)="filesExpanded = false">
        <mat-expansion-panel-header>
            <mat-panel-title *ngIf="!filesExpanded" style="color: grey; font-weight: 500">
                HWM File Information
            </mat-panel-title>
            <mat-panel-title *ngIf="filesExpanded" style="color: #FFF; font-weight: 550">
                HWM File Information
            </mat-panel-title>
        </mat-expansion-panel-header>
        <div class="tableContainer">
            <table *ngIf="hwmFiles.length > 0; else noHWMFileTable"
                mat-table
                id="hwmFilesTable"
                [dataSource]="filesDataSource"
                (matSortChange)="sortFilesData($event)"
                class="mat-elevation-z5"
                matSort
            >
                <!-- HWM file date column -->
                <ng-container matColumnDef="FileDate">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header="file_date">File Date</th>
                    <td mat-cell *matCellDef="let file">
                        <div *ngIf="file.file_date === '' || file.file_date === undefined; else displayHWMFileDate">
                            ---
                        </div>
                        <ng-template #displayHWMFileDate>
                            {{ file.file_date }}
                        </ng-template>
                    </td>
                </ng-container>

                <!-- HWM file name column -->
                <ng-container matColumnDef="FileName">
                    <th mat-header-cell *matHeaderCellDef mat-sort-header="name">File Name</th>
                    <td mat-cell *matCellDef="let file">
                        <div *ngIf="file.name === '' || file.name === undefined; else displayHWMFileName">
                            ---
                        </div>
                        <ng-template #displayHWMFileName>
                            {{ file.name }}
                        </ng-template>
                    </td>
                </ng-container>

                <tr mat-header-row *matHeaderRowDef="displayedHWMFileColumns"></tr>
                <tr
                    mat-row
                    *matRowDef="let row; columns: displayedHWMFileColumns"
                    (click)="openFileDetailsDialog(row, 'HWM File')"
                    class="results-row"
                ></tr>
            </table>
        </div>
        <ng-template #noHWMFileTable>
            <p class="tableContainer">No HWM Files listed.</p>
        </ng-template>
        <mat-paginator [hidden]="hwmFiles === undefined || hwmFiles.length === 0" #paginator [pageSizeOptions]="[5, 10, 25]" class="results-paginator"></mat-paginator>
        </mat-expansion-panel>
    </mat-accordion>
</mat-dialog-content>
<mat-dialog-actions align="end">
    <div class="detail-section-buttons centered">
        <button mat-button mat-dialog-close cdkFocusInitial aria-label="Close">Close</button>
        <!-- The mat-dialog-close directive optionally accepts a value as a result for the dialog. -->
    </div>
</mat-dialog-actions>

