<h2 *ngIf="editOrCreate === 'Edit'" mat-dialog-title>
    Edit Sensor
    <button class="close-button" mat-button [mat-dialog-close]="{returnFiles: returnFiles}" aria-label="Exit"><mat-icon>close</mat-icon></button>
</h2>
<h2 *ngIf="editOrCreate === 'Create'" mat-dialog-title>
    Deploy Sensor
    <button class="close-button" mat-button [mat-dialog-close]="{returnFiles: returnFiles}" aria-label="Exit"><mat-icon>close</mat-icon></button>
</h2>
<div [hidden]="!loading" class="loading">
    <mat-spinner style="margin:0 auto; top: 50%" mode="indeterminate" diameter="20"></mat-spinner>
</div>
<form [formGroup]="form" (ngSubmit)="submit($event.submitter.id)">
    <mat-dialog-content>
        <mat-accordion multi="true">
            <mat-expansion-panel hideToggle [expanded]="deployedExpanded" (opened)="deployedExpanded = true" (closed)="deployedExpanded = false">
                <mat-expansion-panel-header *ngIf="editOrCreate === 'Edit'">
                    <mat-panel-title *ngIf="!deployedExpanded" style="color: grey; font-weight: 500">
                        Deployed Sensor Information
                    </mat-panel-title>
                    <mat-panel-title *ngIf="deployedExpanded" style="color: #FFF; font-weight: 550">
                        Deployed Sensor Information
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <div *ngIf="(editOrCreate === 'Edit' && (role === 2 || role === 3)) || editOrCreate === 'Create'">
                    <label class="form-header">Event: </label> {{this.sensor.eventName}}
                </div>
                <div *ngIf="role === 1 && editOrCreate === 'Edit'">
                    <mat-form-field appearance="fill">
                        <mat-label>Event</mat-label>
                        <mat-select required aria-label="Event" formControlName="event_id">
                            <mat-option *ngFor="let event of events" [value]="event.event_id">
                            {{event.event_name}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <mat-form-field appearance="fill">
                    <mat-label>Sensor Type</mat-label>
                    <mat-select required aria-label="Sensor Type" formControlName="sensor_type_id">
                        <mat-option *ngFor="let type of sensorTypes" [value]="type.sensor_type_id">
                        {{type.sensor}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                <mat-form-field appearance="fill">
                    <mat-label>Sensor Brand</mat-label>
                    <mat-select required aria-label="Sensor Brand" formControlName="sensor_brand_id">
                        <mat-option *ngFor="let brand of sensorBrands" [value]="brand.sensor_brand_id">
                        {{brand.brand_name}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                <mat-form-field appearance="fill">
                    <mat-label>Serial Number</mat-label>
                    <input aria-label="Serial Number" matInput formControlName="serial_number" required [value]="sensor.serial_number"/>
                    <mat-icon matSuffix class="info-icon" matTooltip="Will be used in netCDF metadata." 
                    aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                </mat-form-field>
                <mat-form-field appearance="fill">
                    <mat-label>Housing Serial Number</mat-label>
                    <input aria-label="Housing Serial Number" matInput formControlName="housing_serial_number" [value]="sensor.housing_serial_number"/>
                    <mat-icon matSuffix class="info-icon" matTooltip="Required for DOI WATCH OFFICE 800 number." 
                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                </mat-form-field>
                <mat-form-field appearance="fill">
                    <mat-label>Housing Type</mat-label>
                    <mat-select aria-label="Housing Type" formControlName="housing_type_id">
                        <mat-option *ngFor="let type of housingTypes" [value]="type.housing_type_id">
                        {{type.type_name}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                <mat-divider></mat-divider>
                <!-- Edit Deployed tapedowns -->
                <mat-expansion-panel hideToggle [expanded]="tapedownsExpanded" (opened)="tapedownsExpanded = true" (closed)="tapedownsExpanded = false">
                    <mat-expansion-panel-header *ngIf="editOrCreate === 'Create'">
                        <mat-panel-title *ngIf="!tapedownsExpanded" style="color: grey; font-weight: 500">
                            Tapedown Information
                        </mat-panel-title>
                        <mat-panel-title *ngIf="tapedownsExpanded" style="color: #FFF; font-weight: 550">
                            Tapedown Information
                        </mat-panel-title>
                        <mat-icon matSuffix class="info-icon-white" matTooltip="These elevations and tapedown data are used for both field activities and final products. Please pay attention to how your data is entered." 
                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                    </mat-expansion-panel-header>
                    <mat-form-field appearance="fill" *ngIf="editOrCreate === 'Create'">
                        <mat-label>Reference Datums</mat-label>
                        <mat-select aria-label="Reference Datums" formControlName="deployedRefMarks" (selectionChange)="changeTableValue($event.value, 'Deployed')" multiple>
                            <mat-option *ngFor="let refmark of data.siteRefMarks" [value]="refmark.name">
                            {{refmark.name}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                    <div class="tapedown-header" *ngIf="editOrCreate === 'Edit'">
                        <label class="form-header">Tapedowns: </label>
                    </div>
                    <div class="tapedowns" [hidden]="!opsPresent">
                            <mat-form-field appearance="fill">
                                <mat-label>Reference Datums</mat-label>
                                        <mat-select aria-label="Reference Datums" formControlName="deployedRefMarks" (selectionChange)="changeTableValue($event.value, 'Deployed')" multiple>
                                            <mat-option *ngFor="let refmark of data.siteRefMarks" [value]="refmark.name">
                                            {{refmark.name}}
                                            </mat-option>
                                        </mat-select>
                                    <mat-icon matSuffix class="info-icon" matTooltip="These elevations and tapedown data are used for both field activities and final products. Please pay attention to how your data is entered." 
                                    aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                            </mat-form-field>
                    </div>
                    <div class="tapedowns" [hidden]="opsPresent || editOrCreate !== 'Edit'">
                        <label>
                            No Datum Locations have been added to this site yet to use for a tape down
                        </label>
                    </div>
                    <div class="tableContainer">
                        <table [hidden]="!form.controls.deployedTapedowns.length > 0"
                            #deployedTable
                            mat-table
                            id="tapedownsTable"
                            [dataSource]="deployedTapedowns"
                            formArrayName="deployedTapedowns"
                            class="mat-elevation-z5"
                            matSort
                        >

                            <!-- Reference Datum name column -->
                            <ng-container matColumnDef="ReferenceDatum">
                                <th mat-header-cell *matHeaderCellDef>Reference Datum</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field>
                                        <input matInput formControlName="op_name" [value]="tapedown.op_name" class="disabled"/>
                                    </mat-form-field>
                                </td>
                            </ng-container>
        
                            <!-- Elevation column -->
                            <ng-container matColumnDef="Elevation">
                                <th mat-header-cell *matHeaderCellDef>Elevation</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field>
                                        <div class="inline-fields">
                                            <div *ngIf="tapedown.elevation !== undefined && tapedown.elevation !== null">
                                                <input matInput formControlName="elevation" [value]="tapedown.elevation" class="disabled"/>
                                            </div>
                                            <input matInput formControlName="vdatum" [value]="tapedown.vdatum" class="disabled"/>
                                        </div>
                                    </mat-form-field>
                                    <!-- Elevation Validator -->
                                    <div *ngIf="form.controls.deployedTapedowns.controls[i].controls.elevation.invalid && (form.controls.deployedTapedowns.controls[i].controls.elevation.dirty || form.controls.deployedTapedowns.controls[i].controls.elevation.touched)"
                                        class="alert alert-danger">
                                        <div *ngIf="form.controls.deployedTapedowns.controls[i].controls.elevation.errors?.['incorrectValue']">
                                            Elevation must be a numeric value.
                                        </div>
                                    </div>
                                </td>
                            </ng-container>

                            <!-- Offset correction column -->
                            <ng-container matColumnDef="OffsetCorrection">
                                <th mat-header-cell *matHeaderCellDef>Offset Correction</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field appearance="fill">
                                        <input matInput type="number" formControlName="offset_correction" [value]="tapedown.offset_correction"/>
                                        <mat-icon matSuffix class="info-icon" matTooltip="From the datum location to the sensor orifice."
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                    </mat-form-field>
                                    <!-- Offset Correction Validator -->
                                    <div *ngIf="form.controls.deployedTapedowns.controls[i].controls.offset_correction.invalid && (form.controls.deployedTapedowns.controls[i].controls.offset_correction.dirty || form.controls.deployedTapedowns.controls[i].controls.offset_correction.touched)"
                                        class="alert alert-danger">
                                        <div *ngIf="form.controls.deployedTapedowns.controls[i].controls.offset_correction.errors?.['incorrectValue']">
                                            Offset Correction must be a numeric value.
                                        </div>
                                    </div>
                                </td>
                            </ng-container>

                            <!-- WS column -->
                            <ng-container matColumnDef="WaterSurface">
                                <th mat-header-cell *matHeaderCellDef>Water Surface</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field appearance="fill">
                                        <input matInput formControlName="water_surface" type="number" [value]="tapedown.water_surface"/>
                                        <mat-icon matSuffix class="info-icon" matTooltip="From the datum location to the water surface."
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                    </mat-form-field>
                                    <!-- Water Surface Validator -->
                                    <div *ngIf="form.controls.deployedTapedowns.controls[i].controls.water_surface.invalid && (form.controls.deployedTapedowns.controls[i].controls.water_surface.dirty || form.controls.deployedTapedowns.controls[i].controls.water_surface.touched)"
                                        class="alert alert-danger">
                                        <div *ngIf="form.controls.deployedTapedowns.controls[i].controls.water_surface.errors?.['incorrectValue']">
                                            Water Surface must be a numeric value.
                                        </div>
                                    </div>
                                </td>
                            </ng-container>

                            <!-- GS column -->
                            <ng-container matColumnDef="GroundSurface">
                                <th mat-header-cell *matHeaderCellDef>Ground Surface</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field appearance="fill">
                                        <input matInput formControlName="ground_surface" type="number" [value]="tapedown.ground_surface"/>
                                        <mat-icon matSuffix class="info-icon" matTooltip="From the datum location to the ground surface."
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                    </mat-form-field>
                                    <!-- Ground Surface Validator -->
                                    <div *ngIf="form.controls.deployedTapedowns.controls[i].controls.ground_surface.invalid && (form.controls.deployedTapedowns.controls[i].controls.ground_surface.dirty || form.controls.deployedTapedowns.controls[i].controls.ground_surface.touched)"
                                        class="alert alert-danger">
                                        <div *ngIf="form.controls.deployedTapedowns.controls[i].controls.ground_surface.errors?.['incorrectValue']">
                                            Ground Surface must be a numeric value.
                                        </div>
                                    </div>
                                </td>
                            </ng-container>
        
                            <tr mat-header-row *matHeaderRowDef="displayedTapedownColumns"></tr>
                            <tr
                                mat-row
                                *matRowDef="let row; columns: displayedTapedownColumns"
                                class="results-row"
                            ></tr>
                        </table>
                        <div class="note" *ngIf="form.controls.deployedTapedowns.length > 0">
                            <label>Note: these are not used for any calculations but are to facilitate field activities.</label>
                        </div>
                    </div>
                    <!-- Edit: sensor status fields for tapedown -->
                    <!-- Create: Display these fields when reference datum is selected, Edit: always display these fields -->
                    <div *ngIf="(editOrCreate === 'Create' && form.controls.deployedTapedowns.length > 0) || editOrCreate === 'Edit'">
                        <div *ngIf="sensor.instrument_status.length > 0">
                            <div *ngFor="let instrument of sensor.instrument_status; let i = index" formArrayName="instrument_status">
                                <div *ngIf="instrument.status === 'Deployed'">
                                    <div [formGroupName]="i">
                                        <mat-form-field appearance="fill">
                                            <mat-label>Sensor Elevation</mat-label>
                                            <input aria-label="Sensor Elevation" matInput type="number" formControlName="sensor_elevation" [value]="instrument.sensor_elevation">
                                            <mat-icon matSuffix class="info-icon" matTooltip="Using the offset correction, elevation of the sensor orifice." 
                                                aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                        </mat-form-field>
                                        <!-- Sensor Elevation Validator -->
                                        <div *ngIf="form.controls.instrument_status.controls[i].controls.sensor_elevation.invalid && (form.controls.instrument_status.controls[i].controls.sensor_elevation.dirty || form.controls.instrument_status.controls[i].controls.sensor_elevation.touched)"
                                            class="alert alert-danger">
                                            <div *ngIf="form.controls.instrument_status.controls[i].controls.sensor_elevation.errors?.['incorrectValue']">
                                                Sensor Elevation must be a numeric value.
                                            </div>
                                        </div>
                                        <mat-form-field appearance="fill">
                                            <mat-label>Water Surface Elevation</mat-label>
                                            <input aria-label="Water Surface Elevation" matInput type="number" formControlName="ws_elevation" [value]="instrument.ws_elevation">
                                            <mat-icon matSuffix class="info-icon" matTooltip="Using the water surface tape down, elevation of the water surface." 
                                                aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                        </mat-form-field>
                                        <!-- Water Surface Elevation Validator -->
                                        <div *ngIf="form.controls.instrument_status.controls[i].controls.ws_elevation.invalid && (form.controls.instrument_status.controls[i].controls.ws_elevation.dirty || form.controls.instrument_status.controls[i].controls.ws_elevation.touched)"
                                            class="alert alert-danger">
                                            <div *ngIf="form.controls.instrument_status.controls[i].controls.ws_elevation.errors?.['incorrectValue']">
                                                Water Surface Elevation must be a numeric value.
                                            </div>
                                        </div>
                                        <mat-form-field appearance="fill">
                                            <mat-label>Ground Elevation</mat-label>
                                            <input aria-label="Ground Elevation" matInput type="number" formControlName="gs_elevation" [value]="instrument.gs_elevation">
                                            <mat-icon matSuffix class="info-icon" matTooltip="Using the ground surface tape down, elevation of the ground surface." 
                                                aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                        </mat-form-field>
                                        <!-- Ground Surface Elevation Validator -->
                                        <div *ngIf="form.controls.instrument_status.controls[i].controls.gs_elevation.invalid && (form.controls.instrument_status.controls[i].controls.gs_elevation.dirty || form.controls.instrument_status.controls[i].controls.gs_elevation.touched)"
                                            class="alert alert-danger">
                                            <div *ngIf="form.controls.instrument_status.controls[i].controls.gs_elevation.errors?.['incorrectValue']">
                                                Ground Surface Elevation must be a numeric value.
                                            </div>
                                        </div>
                                        <mat-form-field appearance="fill">
                                            <mat-label>In Feet Above</mat-label>
                                            <mat-select aria-label="In Feet Above" formControlName="vdatum_id">
                                                <mat-option *ngFor="let datum of vDatumList" [value]="datum.datum_id">
                                                {{datum.datum_name}}
                                                </mat-option>
                                            </mat-select>
                                        </mat-form-field>
                                    </div>
                                </div>
                            </div>
                            <div class="note">
                                <label>Note: these elevations are used in the sensor processing and the final products.</label>
                            </div>
                        </div>
                    </div>
                    <!-- Create: sensor status fields for tapedown -->
                </mat-expansion-panel>
                <mat-divider></mat-divider>
                <!-- Vented (only if Sensor Type is Pressure Transducer)-->
                <mat-radio-group *ngIf="form.controls.sensor_type_id.value === 1" class="radio-btn-group" [(value)]="vented" (change)="ventedChange($event.value)">
                    <mat-label class="form-header">Vented: </mat-label>
                    <mat-radio-button class="radio-button" value="Yes">Yes</mat-radio-button>
                    <mat-radio-button class="radio-button" value="No">No</mat-radio-button>
                </mat-radio-group>
                <mat-form-field appearance="fill">
                    <mat-label>Deployment Type</mat-label>
                    <mat-select aria-label="Deployment Type" formControlName="deployment_type_id">
                        <mat-option *ngFor="let type of deploymentTypes" [value]="type.deployment_type_id">
                        {{type.method}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                <mat-form-field appearance="fill">
                    <mat-label for="description">Location Description</mat-label>
                    <textarea aria-label="Location Description" matInput formControlName="location_description" [value]="sensor.location_description"></textarea>
                    <mat-icon matSuffix class="info-icon" matTooltip="Please be specific so others can find this sensor later. This field is public." 
                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                </mat-form-field>
                <div class="inline-fields-70">
                    <mat-form-field class="inline-widths" appearance="fill">
                        <mat-label for="interval">Interval</mat-label>
                        <input aria-label="Interval" matInput formControlName="interval" type="number" [value]="sensor.interval"/>
                    </mat-form-field>
                    <mat-radio-group class="radio-btn-group" [(value)]="interval_unit" (change)="intervalUnitChange($event.value)">
                        <mat-radio-button class="radio-button" value="min">Minutes</mat-radio-button>
                        <mat-radio-button class="radio-button" value="sec">Seconds</mat-radio-button>
                    </mat-radio-group>
                    <mat-icon matSuffix class="info-icon" matTooltip="Interval will be stored in seconds."
                    aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                </div>
                <!-- Interval Validator -->
                <div *ngIf="form.controls.interval.invalid && (form.controls.interval.dirty || form.controls.interval.touched)"
                    class="alert alert-danger">
                    <div *ngIf="form.controls.interval.errors?.['incorrectValue']">
                        Interval must be a numeric value.
                    </div>
                </div>
                <div *ngIf="sensor.instrument_status.length > 0">
                    <div *ngFor="let instrument of sensor.instrument_status; let i = index" formArrayName="instrument_status">
                        <div *ngIf="instrument.status === 'Deployed'">
                            <div [formGroupName]="i" (change)="previewUTC(instrument)">
                                <div class="dateFields">
                                    <mat-form-field appearance="fill">
                                        <mat-label>Deploy Date</mat-label>
                                        <input aria-label="Deploy Date" matInput formControlName="time_stamp" [value]="instrument.time_stamp" (dateChange)="previewUTC(instrument)" [matDatepicker]="deployDatePicker" required placeholder="Choose a date">
                                        <mat-datepicker-toggle matSuffix [for]="deployDatePicker"></mat-datepicker-toggle>
                                        <mat-datepicker [value]="instrument.time_stamp" #deployDatePicker></mat-datepicker>
                                    </mat-form-field>
                                    <input class="date-input" formControlName="hour" type="number" max="12" min="0" aria-label="Deploy Hour" [value]="instrument.hour" required placeholder="00">
                                    <span class="date-span"> : </span>
                                    <input class="date-input" formControlName="minute" type="number" max="60" min="0" aria-label="Deploy Minute" [value]="instrument.minute" required placeholder="00">
                                    <button mat-stroked-button class="date-input date-button secondary" type="button" (click)="changeTime(instrument)" [value]="instrument.ampm">{{instrument.ampm}}</button>
                                </div>
                                <!-- Minute Validator -->
                                <div *ngIf="form.controls.instrument_status.controls[i].controls.minute.invalid && (form.controls.instrument_status.controls[i].controls.minute.dirty || form.controls.instrument_status.controls[i].controls.minute.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.instrument_status.controls[i].controls.minute.errors?.['incorrectValue']">
                                        Minutes must be between 0 and 60.
                                    </div>
                                </div>
                                <!-- Hours Validator -->
                                <div *ngIf="form.controls.instrument_status.controls[i].controls.hour.invalid && (form.controls.instrument_status.controls[i].controls.hour.dirty || form.controls.instrument_status.controls[i].controls.hour.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.instrument_status.controls[i].controls.hour.errors?.['incorrectValue']">
                                        Hours must be between 0 and 12.
                                    </div>
                                </div>
                                <mat-form-field appearance="fill">
                                    <mat-label>Time Zone</mat-label>
                                    <mat-select aria-label="Time Zone" required formControlName="time_zone" (selectionChange)="setTimeZone(instrument)">
                                        <mat-option *ngFor="let zone of timeZones" [value]="zone">
                                        {{zone}}
                                        </mat-option>
                                    </mat-select>
                                    <mat-icon matSuffix class="info-icon" matTooltip="Date/Time will be stored in UTC."
                                    aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                </mat-form-field>
                                <div>
                                    <label class="form-header">Preview time in UTC: </label> {{instrument.utc_preview}}
                                </div>
                                <mat-form-field appearance="fill">
                                    <mat-label for="description">Note</mat-label>
                                    <textarea aria-label="Note" matInput formControlName="notes" [value]="instrument.notes"></textarea>
                                </mat-form-field>
                                <div>
                                    <label class="form-header">Deploy Member: </label> {{instrument.member_name}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ref-button-group">
                    <button *ngIf="editOrCreate === 'Edit'" class="primary" mat-button cdkFocusInitial aria-label="Save" id="1" type="submit">Save</button>
                    <button *ngIf="editOrCreate === 'Edit'" class="secondary cancel-btn" type="button" mat-stroked-button cdkFocusInitial aria-label="Cancel Edits" (click)="cancelForm('Deployed')">Cancel Edits</button>
                </div>
            </mat-expansion-panel>
            <mat-expansion-panel hideToggle [expanded]="retrievedExpanded" (opened)="retrievedExpanded = true" (closed)="retrievedExpanded = false" *ngIf="sensor.statusType === 'Retrieved'">
                <mat-expansion-panel-header>
                    <mat-panel-title *ngIf="!retrievedExpanded" style="color: grey; font-weight: 500">
                        Retrieved Sensor Information
                    </mat-panel-title>
                    <mat-panel-title *ngIf="retrievedExpanded" style="color: #FFF; font-weight: 550">
                        Retrieved Sensor Information
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <div *ngIf="sensor.instrument_status.length > 0">
                    <div *ngFor="let instrument of sensor.instrument_status; let i = index" formArrayName="instrument_status">
                        <div *ngIf="instrument.status === 'Retrieved'">
                            <div [formGroupName]="i">
                                <mat-form-field appearance="fill">
                                    <mat-label>Status</mat-label>
                                    <mat-select required aria-label="Status" formControlName="status_type_id"  (selectionChange)="statusChanged($event.value)">
                                        <mat-option *ngFor="let type of statusTypes" [value]="type.status_type_id">
                                        {{type.status}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>
                    </div>
                    <mat-form-field appearance="fill">
                        <mat-label>Collection Conditions</mat-label>
                        <mat-select required aria-label="Collection Conditions" formControlName="inst_collection_id">
                            <mat-option *ngFor="let condition of collectConds" [value]="condition.id">
                            {{condition.condition}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                    <div *ngFor="let instrument of sensor.instrument_status; let i = index" formArrayName="instrument_status">
                        <div *ngIf="instrument.status === 'Retrieved'">
                            <div [formGroupName]="i" (change)="previewUTC(instrument)">
                                <mat-form-field appearance="fill">
                                    <mat-label for="description">Note</mat-label>
                                    <textarea aria-label="Note" matInput formControlName="notes" [value]="instrument.notes"></textarea>
                                </mat-form-field>
                                <div class="dateFields">
                                    <mat-form-field appearance="fill">
                                        <mat-label>Retrieve Date</mat-label>
                                        <input aria-label="Retrieve Date" matInput formControlName="time_stamp" [value]="instrument.time_stamp" (dateChange)="previewUTC(instrument)" [matDatepicker]="deployDatePicker" required placeholder="Choose a date">
                                        <mat-datepicker-toggle matSuffix [for]="deployDatePicker"></mat-datepicker-toggle>
                                        <mat-datepicker [value]="instrument.time_stamp" #deployDatePicker></mat-datepicker>
                                    </mat-form-field>
                                    <input class="date-input" formControlName="hour" aria-label="Deploy Hour" max="12" min="0" type="number" [value]="instrument.hour" required placeholder="00"> 
                                    <span class="date-span"> : </span>
                                    <input class="date-input" formControlName="minute" aria-label="Deploy Minute" max="60" min="0" type="number" [value]="instrument.minute" required placeholder="00">
                                    <button mat-stroked-button class="date-input date-button" type="button" (click)="changeTime(instrument)" [value]="instrument.ampm">{{instrument.ampm}}</button>
                                </div>
                                <!-- Minute Validator -->
                                <div *ngIf="form.controls.instrument_status.controls[i].controls.minute.invalid && (form.controls.instrument_status.controls[i].controls.minute.dirty || form.controls.instrument_status.controls[i].controls.minute.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.instrument_status.controls[i].controls.minute.errors?.['incorrectValue']">
                                        Minutes must be between 0 and 60.
                                    </div>
                                </div>
                                <!-- Hours Validator -->
                                <div *ngIf="form.controls.instrument_status.controls[i].controls.hour.invalid && (form.controls.instrument_status.controls[i].controls.hour.dirty || form.controls.instrument_status.controls[i].controls.hour.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.instrument_status.controls[i].controls.hour.errors?.['incorrectValue']">
                                        Hours must be between 0 and 12.
                                    </div>
                                </div>
                                <mat-form-field appearance="fill">
                                    <mat-label>Time Zone</mat-label>
                                    <mat-select aria-label="Time Zone" required formControlName="time_zone" (selectionChange)="setTimeZone(instrument)">
                                        <mat-option *ngFor="let zone of timeZones" [value]="zone">
                                        {{zone}}
                                        </mat-option>
                                    </mat-select>
                                    <mat-icon matSuffix class="info-icon" matTooltip="Date/Time will be stored in UTC."
                                    aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                </mat-form-field>
                                <div>
                                    <label class="form-header">Preview time in UTC: </label> {{instrument.utc_preview}}
                                </div>
                            </div>
                        </div>
                    </div>
                    <mat-divider></mat-divider>
                    <div class="tapedown-header">
                        <label class="form-header">Tapedowns: </label>
                    </div>
                    <div class="tapedowns" [hidden]="!opsPresent">
                            <mat-form-field appearance="fill">
                                <mat-label>Reference Datums</mat-label>
                                        <mat-select aria-label="Reference Datums" formControlName="retrievedRefMarks" (selectionChange)="changeTableValue($event.value, 'Retrieved')" multiple>
                                            <mat-option *ngFor="let refmark of data.siteRefMarks" [value]="refmark.name">
                                            {{refmark.name}}
                                            </mat-option>
                                        </mat-select>
                                    <mat-icon matSuffix class="info-icon" matTooltip="These elevations and tapedown data are used for both field activities and final products. Please pay attention to how your data is entered."
                                    aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                            </mat-form-field>
                    </div>
                    <div class="tapedowns" [hidden]="opsPresent">
                        <label>
                            No Datum Locations have been added to this site yet to use for a tape down
                        </label>
                    </div>
                    <div class="tableContainer">
                        <table [hidden]="!form.controls.retrievedTapedowns.length > 0"
                            #retrievedTable
                            mat-table
                            id="tapedownsTable"
                            [dataSource]="retrievedTapedowns"
                            formArrayName="retrievedTapedowns"
                            class="mat-elevation-z5"
                            matSort
                        >
    
                            <!-- Reference Datum name column -->
                            <ng-container matColumnDef="ReferenceDatum">
                                <th mat-header-cell *matHeaderCellDef>Reference Datum</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field>
                                        <input matInput formControlName="op_name" [value]="tapedown.op_name" class="disabled"/>
                                    </mat-form-field>
                                </td>
                            </ng-container>
        
                            <!-- Elevation column -->
                            <ng-container matColumnDef="Elevation">
                                <th mat-header-cell *matHeaderCellDef>Elevation</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field>
                                        <div class="inline-fields">
                                            <div *ngIf="tapedown.elevation !== undefined && tapedown.elevation !== null">
                                                <input matInput formControlName="elevation" [value]="tapedown.elevation" class="disabled"/>
                                            </div>
                                            <input matInput formControlName="vdatum" [value]="tapedown.vdatum" class="disabled"/>
                                        </div>
                                    </mat-form-field>
                                    <!-- Elevation Validator -->
                                    <div *ngIf="form.controls.retrievedTapedowns.controls[i].controls.elevation.invalid && (form.controls.retrievedTapedowns.controls[i].controls.elevation.dirty || form.controls.retrievedTapedowns.controls[i].controls.elevation.touched)"
                                        class="alert alert-danger">
                                        <div *ngIf="form.controls.retrievedTapedowns.controls[i].controls.elevation.errors?.['incorrectValue']">
                                            Elevation must be a numeric value.
                                        </div>
                                    </div>
                                </td>
                            </ng-container>
    
                            <!-- Offset correction column -->
                            <ng-container matColumnDef="OffsetCorrection">
                                <th mat-header-cell *matHeaderCellDef>Offset Correction</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field appearance="fill">
                                        <input matInput type="number" formControlName="offset_correction" [value]="tapedown.offset_correction"/>
                                        <mat-icon matSuffix class="info-icon" matTooltip="From the datum location to the sensor orifice."
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                    </mat-form-field>
                                    <!-- Offset Correction Validator -->
                                    <div *ngIf="form.controls.retrievedTapedowns.controls[i].controls.offset_correction.invalid && (form.controls.retrievedTapedowns.controls[i].controls.offset_correction.dirty || form.controls.retrievedTapedowns.controls[i].controls.offset_correction.touched)"
                                        class="alert alert-danger">
                                        <div *ngIf="form.controls.retrievedTapedowns.controls[i].controls.offset_correction.errors?.['incorrectValue']">
                                            Offset Correction must be a numeric value.
                                        </div>
                                    </div>
                                </td>
                            </ng-container>
    
                            <!-- WS column -->
                            <ng-container matColumnDef="WaterSurface">
                                <th mat-header-cell *matHeaderCellDef>Water Surface</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field appearance="fill">
                                        <input matInput type="number" formControlName="water_surface" [value]="tapedown.water_surface"/>
                                        <mat-icon matSuffix class="info-icon" matTooltip="From the datum location to the water surface."
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                    </mat-form-field>
                                    <!-- Water Surface Validator -->
                                    <div *ngIf="form.controls.retrievedTapedowns.controls[i].controls.water_surface.invalid && (form.controls.retrievedTapedowns.controls[i].controls.water_surface.dirty || form.controls.retrievedTapedowns.controls[i].controls.water_surface.touched)"
                                        class="alert alert-danger">
                                        <div *ngIf="form.controls.retrievedTapedowns.controls[i].controls.water_surface.errors?.['incorrectValue']">
                                            Water Surface must be a numeric value.
                                        </div>
                                    </div>
                                </td>
                            </ng-container>
    
                            <!-- GS column -->
                            <ng-container matColumnDef="GroundSurface">
                                <th mat-header-cell *matHeaderCellDef>Ground Surface</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field appearance="fill">
                                        <input matInput type="number" formControlName="ground_surface" [value]="tapedown.ground_surface"/>
                                        <mat-icon matSuffix class="info-icon" matTooltip="From the datum location to the ground surface."
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                    </mat-form-field>
                                    <!-- Ground Surface Validator -->
                                    <div *ngIf="form.controls.retrievedTapedowns.controls[i].controls.ground_surface.invalid && (form.controls.retrievedTapedowns.controls[i].controls.ground_surface.dirty || form.controls.retrievedTapedowns.controls[i].controls.ground_surface.touched)"
                                        class="alert alert-danger">
                                        <div *ngIf="form.controls.retrievedTapedowns.controls[i].controls.ground_surface.errors?.['incorrectValue']">
                                            Ground Surface must be a numeric value.
                                        </div>
                                    </div>
                                </td>
                            </ng-container>
        
                            <tr mat-header-row *matHeaderRowDef="displayedTapedownColumns"></tr>
                            <tr
                                mat-row
                                *matRowDef="let row; columns: displayedTapedownColumns"
                                class="results-row"
                            ></tr>
                        </table>
                    </div>
                    <div class="note">
                        <label>Note: these are not used for any calculations but are to facilitate field activities.</label>
                    </div>
                    <mat-divider></mat-divider>
                    <div *ngFor="let instrument of sensor.instrument_status; let i = index" formArrayName="instrument_status">
                        <div *ngIf="instrument.status === 'Retrieved'">
                            <div [formGroupName]="i">
                                <mat-form-field appearance="fill">
                                    <mat-label>Sensor Elevation</mat-label>
                                    <input aria-label="Sensor Elevation" matInput type="number" formControlName="sensor_elevation" [value]="instrument.sensor_elevation">
                                    <mat-icon matSuffix class="info-icon" matTooltip="Using the offset correction, elevation of the sensor orifice." 
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                </mat-form-field>
                                <!-- Sensor Elevation Validator -->
                                <div *ngIf="form.controls.instrument_status.controls[i].controls.sensor_elevation.invalid && (form.controls.instrument_status.controls[i].controls.sensor_elevation.dirty || form.controls.instrument_status.controls[i].controls.sensor_elevation.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.instrument_status.controls[i].controls.sensor_elevation.errors?.['incorrectValue']">
                                        Sensor Elevation must be a numeric value.
                                    </div>
                                </div>
                                <mat-form-field appearance="fill">
                                    <mat-label>Water Surface Elevation</mat-label>
                                    <input aria-label="Water Surface Elevation" matInput type="number" formControlName="ws_elevation" [value]="instrument.ws_elevation">
                                    <mat-icon matSuffix class="info-icon" matTooltip="Using the water surface tape down, elevation of the water surface." 
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                </mat-form-field>
                                <!-- Water Surface Elevation Validator -->
                                <div *ngIf="form.controls.instrument_status.controls[i].controls.ws_elevation.invalid && (form.controls.instrument_status.controls[i].controls.ws_elevation.dirty || form.controls.instrument_status.controls[i].controls.ws_elevation.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.instrument_status.controls[i].controls.ws_elevation.errors?.['incorrectValue']">
                                        Water Surface Elevation must be a numeric value.
                                    </div>
                                </div>
                                <mat-form-field appearance="fill">
                                    <mat-label>Ground Elevation</mat-label>
                                    <input aria-label="Ground Elevation" matInput type="number" formControlName="gs_elevation" [value]="instrument.gs_elevation">
                                    <mat-icon matSuffix class="info-icon" matTooltip="Using the ground surface tape down, elevation of the ground surface." 
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                </mat-form-field>
                                <!-- Ground Surface Elevation Validator -->
                                <div *ngIf="form.controls.instrument_status.controls[i].controls.gs_elevation.invalid && (form.controls.instrument_status.controls[i].controls.gs_elevation.dirty || form.controls.instrument_status.controls[i].controls.gs_elevation.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.instrument_status.controls[i].controls.gs_elevation.errors?.['incorrectValue']">
                                        Ground Surface Elevation must be a numeric value.
                                    </div>
                                </div>
                                <mat-form-field appearance="fill">
                                    <mat-label>In Feet Above</mat-label>
                                    <mat-select aria-label="In Feet Above" formControlName="vdatum_id">
                                        <mat-option *ngFor="let datum of vDatumList" [value]="datum.datum_id">
                                        {{datum.datum_name}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                                <div class="note">
                                    <label>Note: these elevations are used in the sensor processing and the final products.</label>
                                </div>
                                <mat-divider></mat-divider>
                                <div>
                                    <label class="form-header">Member: </label><p class="required">*</p>{{instrument.member_name}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ref-button-group">
                    <button class="primary" mat-button cdkFocusInitial aria-label="Save" id="2" type="submit">Save</button>
                    <button class="secondary cancel-btn" type="button" mat-stroked-button cdkFocusInitial aria-label="Cancel Edits" (click)="cancelForm('Retrieved')">Cancel Edits</button>
                </div>
            </mat-expansion-panel>
            <mat-expansion-panel hideToggle [expanded]="lostExpanded" (opened)="lostExpanded = true" (closed)="lostExpanded = false" *ngIf="sensor.statusType === 'Lost'">
                <mat-expansion-panel-header>
                    <mat-panel-title *ngIf="!lostExpanded" style="color: grey; font-weight: 500">
                    Lost Sensor Information
                    </mat-panel-title>
                    <mat-panel-title *ngIf="lostExpanded" style="color: #FFF; font-weight: 550">
                        Lost Sensor Information
                        </mat-panel-title>
                </mat-expansion-panel-header>
                <div *ngIf="sensor.instrument_status.length > 0">
                    <div *ngFor="let instrument of sensor.instrument_status; let i = index" formArrayName="instrument_status">
                        <div *ngIf="instrument.status === 'Lost'">
                            <div [formGroupName]="i">
                                <mat-form-field appearance="fill">
                                    <mat-label>Status</mat-label>
                                    <mat-select required aria-label="Status" formControlName="status_type_id" (selectionChange)="statusChanged($event.value)">
                                        <mat-option *ngFor="let type of statusTypes" [value]="type.status_type_id">
                                        {{type.status}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>
                    </div>
                    <mat-form-field appearance="fill">
                        <mat-label>Collection Conditions</mat-label>
                        <mat-select required aria-label="Collection Conditions" formControlName="inst_collection_id">
                            <mat-option *ngFor="let condition of collectConds" [value]="condition.id">
                            {{condition.condition}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                    <div *ngFor="let instrument of sensor.instrument_status; let i = index" formArrayName="instrument_status">
                        <div *ngIf="instrument.status === 'Lost'">
                            <div [formGroupName]="i" (change)="previewUTC(instrument)">
                                <mat-form-field appearance="fill">
                                    <mat-label for="description">Note</mat-label>
                                    <textarea aria-label="Note" matInput formControlName="notes" [value]="instrument.notes"></textarea>
                                </mat-form-field>
                                <div class="dateFields">
                                    <mat-form-field appearance="fill">
                                        <mat-label>Retrieve Date</mat-label>
                                        <input aria-label="Retrieve Date" matInput formControlName="time_stamp" [value]="instrument.time_stamp" (dateChange)="previewUTC(instrument)" [matDatepicker]="deployDatePicker" required placeholder="Choose a date">
                                        <mat-datepicker-toggle matSuffix [for]="deployDatePicker"></mat-datepicker-toggle>
                                        <mat-datepicker [value]="instrument.time_stamp" #deployDatePicker></mat-datepicker>
                                    </mat-form-field>
                                    <input class="date-input" formControlName="hour" aria-label="Deploy Hour" type="number" max="12" min="0" [value]="instrument.hour" required placeholder="00">
                                    <span class="date-span"> : </span>
                                    <input class="date-input" formControlName="minute" aria-label="Deploy Minute" type="number" max="12" min="0" [value]="instrument.minute" required placeholder="00">
                                    <button mat-stroked-button class="date-input date-button" type="button" (click)="changeTime(instrument)" [value]="instrument.ampm">{{instrument.ampm}}</button>
                                </div>
                                <!-- Minute Validator -->
                                <div *ngIf="form.controls.instrument_status.controls[i].controls.minute.invalid && (form.controls.instrument_status.controls[i].controls.minute.dirty || form.controls.instrument_status.controls[i].controls.minute.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.instrument_status.controls[i].controls.minute.errors?.['incorrectValue']">
                                        Minutes must be between 0 and 60.
                                    </div>
                                </div>
                                <!-- Hours Validator -->
                                <div *ngIf="form.controls.instrument_status.controls[i].controls.hour.invalid && (form.controls.instrument_status.controls[i].controls.hour.dirty || form.controls.instrument_status.controls[i].controls.hour.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.instrument_status.controls[i].controls.hour.errors?.['incorrectValue']">
                                        Hours must be between 0 and 12.
                                    </div>
                                </div>
                                <mat-form-field appearance="fill">
                                    <mat-label>Time Zone</mat-label>
                                    <mat-select aria-label="Time Zone" required formControlName="time_zone" (selectionChange)="setTimeZone(instrument)">
                                        <mat-option *ngFor="let zone of timeZones" [value]="zone">
                                        {{zone}}
                                        </mat-option>
                                    </mat-select>
                                    <mat-icon matSuffix class="info-icon" matTooltip="Date/Time will be stored in UTC."
                                    aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                </mat-form-field>
                                <div>
                                    <label class="form-header">Preview time in UTC: </label> {{instrument.utc_preview}}
                                </div>
                            </div>
                        </div>
                    </div>
                    <mat-divider></mat-divider>
                    <div class="tapedown-header">
                        <label class="form-header">Tapedowns: </label>
                    </div>
                    <div class="tapedowns" [hidden]="!opsPresent">
                        <mat-form-field appearance="fill">
                            <mat-label>Reference Datums</mat-label>
                                <mat-select aria-label="Reference Datums" formControlName="lostRefMarks" (selectionChange)="changeTableValue($event.value, 'Lost')" multiple>
                                    <mat-option *ngFor="let refmark of data.siteRefMarks" [value]="refmark.name">
                                    {{refmark.name}}
                                    </mat-option>
                                </mat-select>
                                <mat-icon matSuffix class="info-icon" matTooltip="These elevations and tapedown data are used for both field activities and final products. Please pay attention to how your data is entered."
                                aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                        </mat-form-field>
                    </div>
                    <div class="tapedowns" [hidden]="opsPresent">
                        <label>
                            No Datum Locations have been added to this site yet to use for a tape down
                        </label>
                    </div>
                    <div class="tableContainer">
                        <table [hidden]="!form.controls.lostTapedowns.length > 0"
                            #lostTable
                            mat-table
                            id="tapedownsTable"
                            [dataSource]="lostTapedowns"
                            formArrayName="lostTapedowns"
                            class="mat-elevation-z5"
                            matSort
                        >
    
                            <!-- Reference Datum name column -->
                            <ng-container matColumnDef="ReferenceDatum">
                                <th mat-header-cell *matHeaderCellDef>Reference Datum</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field>
                                        <input matInput formControlName="op_name" [value]="tapedown.op_name" class="disabled"/>
                                    </mat-form-field>
                                </td>
                            </ng-container>
        
                            <!-- Elevation column -->
                            <ng-container matColumnDef="Elevation">
                                <th mat-header-cell *matHeaderCellDef>Elevation</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field>
                                        <div class="inline-fields">
                                            <div *ngIf="tapedown.elevation !== undefined && tapedown.elevation !== null">
                                                <input matInput formControlName="elevation" [value]="tapedown.elevation" class="disabled"/>
                                            </div>
                                            <input matInput formControlName="vdatum" [value]="tapedown.vdatum" class="disabled"/>
                                        </div>
                                    </mat-form-field>
                                    <!-- Elevation Validator -->
                                    <div *ngIf="form.controls.lostTapedowns.controls[i].controls.elevation.invalid && (form.controls.lostTapedowns.controls[i].controls.elevation.dirty || form.controls.lostTapedowns.controls[i].controls.elevation.touched)"
                                        class="alert alert-danger">
                                        <div *ngIf="form.controls.lostTapedowns.controls[i].controls.elevation.errors?.['incorrectValue']">
                                            Elevation must be a numeric value.
                                        </div>
                                    </div>
                                </td>
                            </ng-container>
    
                            <!-- Offset correction column -->
                            <ng-container matColumnDef="OffsetCorrection">
                                <th mat-header-cell *matHeaderCellDef>Offset Correction</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field appearance="fill">
                                        <input matInput type="number" formControlName="offset_correction" [value]="tapedown.offset_correction"/>
                                        <mat-icon matSuffix class="info-icon" matTooltip="From the datum location to the sensor orifice."
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                    </mat-form-field>
                                    <!-- Offset Correction Validator -->
                                    <div *ngIf="form.controls.lostTapedowns.controls[i].controls.offset_correction.invalid && (form.controls.lostTapedowns.controls[i].controls.offset_correction.dirty || form.controls.lostTapedowns.controls[i].controls.offset_correction.touched)"
                                        class="alert alert-danger">
                                        <div *ngIf="form.controls.lostTapedowns.controls[i].controls.offset_correction.errors?.['incorrectValue']">
                                            Offset Correction must be a numeric value.
                                        </div>
                                    </div>
                                </td>
                            </ng-container>
    
                            <!-- WS column -->
                            <ng-container matColumnDef="WaterSurface">
                                <th mat-header-cell *matHeaderCellDef>Water Surface</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field appearance="fill">
                                        <input matInput type="number" formControlName="water_surface" [value]="tapedown.water_surface"/>
                                        <mat-icon matSuffix class="info-icon" matTooltip="From the datum location to the water surface."
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                    </mat-form-field>
                                    <!-- Water Surface Validator -->
                                    <div *ngIf="form.controls.lostTapedowns.controls[i].controls.water_surface.invalid && (form.controls.lostTapedowns.controls[i].controls.water_surface.dirty || form.controls.lostTapedowns.controls[i].controls.water_surface.touched)"
                                        class="alert alert-danger">
                                        <div *ngIf="form.controls.lostTapedowns.controls[i].controls.water_surface.errors?.['incorrectValue']">
                                            Water Surface must be a numeric value.
                                        </div>
                                    </div>
                                </td>
                            </ng-container>
    
                            <!-- GS column -->
                            <ng-container matColumnDef="GroundSurface">
                                <th mat-header-cell *matHeaderCellDef>Ground Surface</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field appearance="fill">
                                        <input matInput type="number" formControlName="ground_surface" [value]="tapedown.ground_surface"/>
                                        <mat-icon matSuffix class="info-icon" matTooltip="From the datum location to the ground surface."
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                    </mat-form-field>
                                    <!-- Ground Surface Validator -->
                                    <div *ngIf="form.controls.lostTapedowns.controls[i].controls.ground_surface.invalid && (form.controls.lostTapedowns.controls[i].controls.ground_surface.dirty || form.controls.lostTapedowns.controls[i].controls.ground_surface.touched)"
                                        class="alert alert-danger">
                                        <div *ngIf="form.controls.lostTapedowns.controls[i].controls.ground_surface.errors?.['incorrectValue']">
                                            Ground Surface must be a numeric value.
                                        </div>
                                    </div>
                                </td>
                            </ng-container>
        
                            <tr mat-header-row *matHeaderRowDef="displayedTapedownColumns"></tr>
                            <tr
                                mat-row
                                *matRowDef="let row; columns: displayedTapedownColumns"
                                class="results-row"
                            ></tr>
                        </table>
                    </div>
                    <div class="note">
                        <label>Note: these are not used for any calculations but are to facilitate field activities.</label>
                    </div>
                    <mat-divider></mat-divider>
                    <div *ngFor="let instrument of sensor.instrument_status; let i = index" formArrayName="instrument_status">
                        <div *ngIf="instrument.status === 'Lost'">
                            <div [formGroupName]="i">
                                <mat-form-field appearance="fill">
                                    <mat-label>Sensor Elevation</mat-label>
                                    <input aria-label="Sensor Elevation" matInput type="number" formControlName="sensor_elevation" [value]="instrument.sensor_elevation">
                                    <mat-icon matSuffix class="info-icon" matTooltip="Using the offset correction, elevation of the sensor orifice." 
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                </mat-form-field>
                                <!-- Sensor Elevation Validator -->
                                <div *ngIf="form.controls.instrument_status.controls[i].controls.sensor_elevation.invalid && (form.controls.instrument_status.controls[i].controls.sensor_elevation.dirty || form.controls.instrument_status.controls[i].controls.sensor_elevation.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.instrument_status.controls[i].controls.sensor_elevation.errors?.['incorrectValue']">
                                        Sensor Elevation must be a numeric value.
                                    </div>
                                </div>
                                <mat-form-field appearance="fill">
                                    <mat-label>Water Surface Elevation</mat-label>
                                    <input aria-label="Water Surface Elevation" matInput type="number" formControlName="ws_elevation" [value]="instrument.ws_elevation">
                                    <mat-icon matSuffix class="info-icon" matTooltip="Using the water surface tape down, elevation of the water surface." 
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                </mat-form-field>
                                <!-- Water Surface Elevation Validator -->
                                <div *ngIf="form.controls.instrument_status.controls[i].controls.ws_elevation.invalid && (form.controls.instrument_status.controls[i].controls.ws_elevation.dirty || form.controls.instrument_status.controls[i].controls.ws_elevation.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.instrument_status.controls[i].controls.ws_elevation.errors?.['incorrectValue']">
                                        Water Surface Elevation must be a numeric value.
                                    </div>
                                </div>
                                <mat-form-field appearance="fill">
                                    <mat-label>Ground Elevation</mat-label>
                                    <input aria-label="Ground Elevation" matInput type="number" formControlName="gs_elevation" [value]="instrument.gs_elevation">
                                    <mat-icon matSuffix class="info-icon" matTooltip="Using the ground surface tape down, elevation of the ground surface." 
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                </mat-form-field>
                                <!-- Ground Surface Elevation Validator -->
                                <div *ngIf="form.controls.instrument_status.controls[i].controls.gs_elevation.invalid && (form.controls.instrument_status.controls[i].controls.gs_elevation.dirty || form.controls.instrument_status.controls[i].controls.gs_elevation.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.instrument_status.controls[i].controls.gs_elevation.errors?.['incorrectValue']">
                                        Ground Surface Elevation must be a numeric value.
                                    </div>
                                </div>
                                <mat-form-field appearance="fill">
                                    <mat-label>In Feet Above</mat-label>
                                    <mat-select aria-label="In Feet Above" formControlName="vdatum_id">
                                        <mat-option *ngFor="let datum of vDatumList" [value]="datum.datum_id">
                                        {{datum.datum_name}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                                <div class="note">
                                    <label>Note: these elevations are used in the sensor processing and the final products.</label>
                                </div>
                                <mat-divider></mat-divider>
                                <div>
                                    <label class="form-header">Member: </label> <p class="required">*</p>{{instrument.member_name}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ref-button-group">
                    <button class="primary" mat-button cdkFocusInitial aria-label="Save" id="3" type="submit">Save</button>
                    <button class="secondary cancel-btn" type="button" mat-stroked-button cdkFocusInitial aria-label="Cancel Edits" (click)="cancelForm('Lost')">Cancel Edits</button>
                </div>
            </mat-expansion-panel>
            <mat-expansion-panel hideToggle [expanded]="filesExpanded" (opened)="filesExpanded = true" (closed)="filesExpanded = false" *ngIf="editOrCreate === 'Edit'">
                <mat-expansion-panel-header>
                    <mat-panel-title *ngIf="!filesExpanded" style="color: grey; font-weight: 500">
                        Sensor File Information
                    </mat-panel-title>
                    <mat-panel-title *ngIf="filesExpanded" style="color: #FFF; font-weight: 550">
                        Sensor File Information
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <button mat-stroked-button (click)="showFileCreate(false)" class="add" type="button"
                    aria-label="Add File"><mat-icon>add</mat-icon> Add File
                </button>
                <!-- Create Sensor File Form -->
                <!-- <form *ngIf="showFileCreateForm" [formGroup]="sensorFileForm">
                    <mat-form-field appearance="fill">
                        <mat-label>File Type</mat-label>
                        <mat-select aria-label="File Type" formControlName="filetype_id" (selectionChange)="getFileTypeSelection($event)">
                            <mat-option *ngFor="let file of fileTypes" [value]="file.filetype_id">
                                {{file.filetype}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field> -->

                    <!--Upload Single Image with validations*-->
                    <!-- <div *ngIf="addFileType === 'New' && selectedFile.FileEntity.filetype_id !== 8">
                        <label class="custom-file-input-add" for="addFile">
                            <p class="required">*</p> {{ selectedFile.FileEntity.name || ' None Chosen' }}
                        </label>
                        <input #upload id="addFile" class="upload-file" type="file" max="500000" [hidden]="true" (change)="getFileName($event)">
                    </div>
                    <br clear="all" /> -->

                    <!-- Data Process By (Data) -->
                    <!-- <div class="row" *ngIf="selectedFile.FileEntity.filetype_id === 2">
                        <label class="form-header">Data Process By: </label> {{processorName}}
                    </div> -->

                    <!-- Date Collected/Processed* (Data) -->
                    <!-- <div *ngIf="selectedFile.FileEntity.filetype_id === 2">
                        <mat-form-field appearance="fill">
                            <mat-label>Date Collected/Processed</mat-label>
                            <input aria-label="Date Collected/Processed" required matInput formControlName="collect_date" [value]="collectDate" [matDatepicker]="collectedDatePicker" placeholder="Choose a date">
                            <mat-datepicker-toggle matSuffix [for]="collectedDatePicker"></mat-datepicker-toggle>
                            <mat-datepicker [value]="collectDate" #collectedDatePicker></mat-datepicker>
                        </mat-form-field>
                    </div> -->

                    <!--Source Name (photo)-->
                    <!-- <div *ngIf="selectedFile.FileEntity.filetype_id === 1">
                        <mat-form-field appearance="fill">
                            <mat-label>Source Photographer</mat-label>
                            <input aria-label="Source Photographer" formControlName="FULLname" matInput required [value]="selectedFile.FileEntity.FULLname"/>           
                        </mat-form-field>
                    </div> -->

                    <!--Source Name (all other)-->
                    <!-- <div *ngIf="selectedFile.FileEntity.filetype_id  > 2">
                        <mat-form-field appearance="fill">
                            <mat-label>Source Name</mat-label>
                            <input aria-label="Source Name" formControlName="FULLname" matInput required [value]="selectedFile.FileEntity.FULLname"/>           
                        </mat-form-field>
                    </div> -->

                    <!--Source Agency* (photo, allOther)-->
                    <!-- <div *ngIf="selectedFile.FileEntity.filetype_id === 1 || selectedFile.FileEntity.filetype_id > 2">
                        <mat-form-field appearance="fill">
                            <mat-label>Source Agency</mat-label>
                            <mat-select aria-label="Source Agency" required formControlName="agency_id" (selectionChange)="updateAgencyForCaption()">
                                <mat-option *ngFor="let a of agencies" [value]="a.agency_id">
                                    {{a.agency_name}}
                                </mat-option>
                            </mat-select>
                        </mat-form-field>
                    </div> -->

                    <!-- Photo Date* (photo) -->
                    <!-- <div *ngIf="selectedFile.FileEntity.filetype_id === 1">
                        <mat-form-field appearance="fill">
                            <mat-label>Photo Date</mat-label>
                            <input aria-label="Photo Date" matInput formControlName="photo_date" [value]="selectedFile.FileEntity.photo_date" [matDatepicker]="photoDatePicker" required placeholder="Choose a date">
                            <mat-datepicker-toggle matSuffix [for]="photoDatePicker"></mat-datepicker-toggle>
                            <mat-datepicker [value]="selectedFile.FileEntity.photo_date" #photoDatePicker></mat-datepicker>
                        </mat-form-field>
                    </div> -->

                    <!-- Date Uploaded* (photo, data, allother) -->
                    <!-- <div *ngIf="selectedFile.FileEntity.filetype_id > 0">
                        <mat-form-field appearance="fill">
                            <mat-label>Date Uploaded</mat-label>
                            <input aria-label="Date Uploaded" matInput formControlName="file_date" [value]="selectedFile.FileEntity.file_date" [matDatepicker]="fileDatePicker" required placeholder="Choose a date">
                            <mat-datepicker-toggle matSuffix [for]="fileDatePicker"></mat-datepicker-toggle>
                            <mat-datepicker #fileDatePicker></mat-datepicker>
                        </mat-form-field>
                    </div> -->

                    <!--Description*(photo, data, allother)-->
                    <!-- <div *ngIf="selectedFile.FileEntity.filetype_id > 0">
                        <mat-form-field appearance="fill">
                            <mat-label for="description">Description</mat-label>
                            <textarea aria-label="Description" matInput formControlName="description" required id="description" [value]="selectedFile.FileEntity.description"></textarea>
                            <mat-icon [hidden]="selectedFile.FileEntity.filetype_id !== 1" matSuffix class="info-icon" matTooltip="Populates in Photo caption below. If a person or people appear in photo include name(s). If non-USGS personnel, ensure consent to publish name in caption is given." 
                            aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                        </mat-form-field>
                    </div> -->

                     <!-- Elevation (Data) -->
                     <!-- <div class="row" *ngIf="selectedFile.FileEntity.filetype_id === 2">
                        <label class="form-header">Elevation:</label>
                        <mat-radio-group class="radio-btn-group" [(value)]="selectedFile.FileEntity.elevation_status" formControlName="elevation_status">
                            <mat-radio-button class="radio-button" value="Final">Final</mat-radio-button>
                            <mat-radio-button class="radio-button" value="Arbitrary">Arbitrary</mat-radio-button>
                        </mat-radio-group>
                    </div> -->

                    <!-- Approval Info -->
                    <!-- <div class="row" *ngIf="selectedFile.FileEntity.filetype_id === 2 && selectedFile.FileEntity.file_id !== undefined && (selectedFile.FileEntity.is_nwis === undefined || selectedFile.FileEntity.is_nwis !== 1) && approvedBy">
                        <label class="form-header">Approved By:</label> {{approvedBy || '---'}}
                    </div>
                    <div class="row" *ngIf="selectedFile.FileEntity.filetype_id === 2 && selectedFile.FileEntity.file_id !== undefined && (selectedFile.FileEntity.is_nwis === undefined || selectedFile.FileEntity.is_nwis !== 1) && approvedOn">
                        <label class="form-header">Approval Date:</label> {{approvedOn | date: 'MM/dd/yyyy' || '---'}}
                    </div> -->

                    <!-- This is where Other ends, rest is for Photo -->
                    <!--Photo Direction (photo)-->
                    <!-- <div *ngIf="selectedFile.FileEntity.filetype_id === 1">
                        <mat-form-field appearance="fill">
                            <mat-label>Photo Direction</mat-label>
                            <input aria-label="Photo Direction" formControlName="photo_direction" matInput [value]="selectedFile.FileEntity.photo_direction"/>           
                        </mat-form-field>
                    </div> -->

                    <!-- Photo Latitude (photo)-->
                    <!-- <div *ngIf="selectedFile.FileEntity.filetype_id === 1">
                        <mat-form-field appearance="fill">
                            <mat-label>Photo Latitude (if different)</mat-label>
                            <input aria-label="Photo Latitude (if different)" formControlName="latitude_dd" matInput [value]="selectedFile.FileEntity.latitude_dd"/>           
                        </mat-form-field>
                    </div> -->
                    <!-- LatDD Validator -->
                    <!-- <div *ngIf="sensorFileForm.controls.latitude_dd.invalid && (sensorFileForm.controls.latitude_dd.dirty || sensorFileForm.controls.latitude_dd.touched)"
                        class="alert alert-danger">
                        <div *ngIf="sensorFileForm.controls.latitude_dd.errors?.['incorrectValue']">
                            The latitude must be between 0 and 73.0.
                        </div>
                    </div> -->

                    <!--Photo Longitude (photo)-->
                    <!-- <div *ngIf="selectedFile.FileEntity.filetype_id === 1">
                        <mat-form-field appearance="fill">
                            <mat-label>Photo Longitude (if different)</mat-label>
                            <input aria-label="Photo longitude (if different)" formControlName="longitude_dd" matInput [value]="selectedFile.FileEntity.longitude_dd"/>           
                        </mat-form-field>
                    </div> -->
                    <!-- LonDD Validator -->
                    <!-- <div *ngIf="sensorFileForm.controls.longitude_dd.invalid && (sensorFileForm.controls.longitude_dd.dirty || sensorFileForm.controls.longitude_dd.touched)"
                        class="alert alert-danger">
                        <div *ngIf="sensorFileForm.controls.longitude_dd.errors?.['incorrectValue']">
                            The longitude must be between -175.0 and -60.0.
                        </div>
                    </div>

                    <div *ngIf="selectedFile.FileEntity.filetype_id === 1">
                        <label class="form-header" for="Caption">Preview Caption</label>
                        <div>
                            <span>
                                Photo of {{sensorFileForm.value.description || ' (Description HERE) '}} at {{data.siteInfo.site_description}}, {{data.siteInfo.county}}, {{data.siteInfo.state}}, {{sensorFileForm.value.photo_date | date: 'MM/dd/yyyy' || ' Date taken HERE '}}. Photograph by {{sensorFileForm.value.FULLname || ' Source Name HERE ' }}, {{agencyNameForCap || ' Agency HERE '}}.
                            </span>
                        </div>
                    </div> -->

                    <!-- associated files -->
                    <!-- <div *ngIf="addFileType === 'Existing' && selectedFile.FileEntity.filetype_id !== 8 && selectedFile.FileEntity.is_nwis !== 1">
                        <label class="form-header">Associated File:</label>
                        <div>
                            <span *ngIf="fileItemExists">
                                <a target="_blank" title="Download File" href="{{fileSource}}">{{selectedFile.FileEntity.name}}</a>
                            </span>
                            <span *ngIf="!fileItemExists">-- Missing --</span> -->
                            <!--ReUpload Single Image with validations*-->
                            <!-- <div *ngIf="!fileItemExists">
                                <label class="custom-file-input" for="Upload">
                                    <p class="required">*</p> {{ selectedFile.FileEntity.name || ' None Chosen' }}
                                </label>
                                <input #upload [hidden]="true" id="Upload" type="file" max="500000" file-model="existingFile.File" (change)="getFileName($event)">
                                <span *ngIf="fileUploading" class="file-upload-span">
                                    Correct File?
                                    <button aria-label="Upload" mat-button class="primary" *ngIf="fileUploading" type="button" (click)="saveFileUpload()">Upload</button>
                                </span>
                            </div> -->
                            <!-- change out the existing fileItem with a different one-->
                            <!-- <div *ngIf="fileItemExists">
                                <div>
                                    <label class="custom-file-inputChange" for="Upload">
                                        <p class="required">*</p> {{ selectedFile.FileEntity.name || ' None Chosen' }}
                                    </label>
                                    <input #upload [hidden]="true" id="Upload" type="file" max="500000" file-model="existingFile.File1" (change)="getFileName($event)">
                                </div>
                                <span *ngIf="fileUploading" class="file-upload-span">
                                    Correct File?
                                    <button aria-label="Is this file correct?" mat-button class="primary" *ngIf="fileUploading" type="button" (click)="saveFileUpload()">Upload</button>
                                </span>
                            </div>
                        </div>
                    </div>
                    <div [hidden]="siteFileIsUploading" class="file-button-group">
                        <button aria-label="Save File" mat-button type="button" class="save-btn primary" *ngIf="selectedFile.FileEntity.file_id !== null" (click)="saveFile()">Save File</button>
                        <button aria-label="Create File" mat-button type="button" class="save-btn primary" *ngIf="selectedFile.FileEntity.file_id == null" (click)="createFile()">Create File</button>
                        <button aria-label="Close or Cancel File" mat-stroked-button class="secondary" style="margin-left: 10px" type="button" (click)="cancelFile()">Close/Cancel File</button>
                    </div>
                </form> -->
                <div class="tableContainer" [hidden]="initSensorFiles?.length === 0">
                    <table
                        mat-table
                        id="sensorFileTable"
                        [dataSource]="initSensorFiles"
                        class="mat-elevation-z5"
                        matSort
                        multiTemplateDataRows
                    >

                        <!-- file name column -->
                        <ng-container matColumnDef="FileName">
                            <th mat-header-cell *matHeaderCellDef>File Name</th>
                            <td mat-cell *matCellDef="let file">
                                <div>
                                    {{file.name}}
                                </div>
                            </td>
                        </ng-container>

                        <!-- file date column -->
                        <ng-container matColumnDef="FileDate">
                            <th mat-header-cell *matHeaderCellDef>File Date</th>
                            <td mat-cell *matCellDef="let file">
                                <div>
                                    {{file.file_date | date: 'MM/dd/yyyy'}}
                                </div>
                            </td>
                        </ng-container>

                        <!-- button column -->
                        <!-- <ng-container matColumnDef="expand">
                            <th mat-header-cell *matHeaderCellDef></th>
                            <td mat-cell *matCellDef="let element">
                                <button mat-stroked-button *ngIf="showFileForm || expandedElement != element" class="view-details-btn secondary" type="button" (click)="showFileDetails(element)"
                                    aria-label="View Details">View Details
                                </button>
                                <button mat-stroked-button *ngIf="!showFileForm && expandedElement == element" class="view-details-btn secondary" type="button" (click)="showFileDetails(null)"
                                    aria-label="Close Details">Close Details
                                </button>
                                <button *ngIf="showDetails || expandedElement != element" mat-stroked-button class="edit-details-btn secondary" type="button" (click)="showFileEdit(element)"
                                    aria-label="Edit"><mat-icon class="edit-icon">edit</mat-icon>Edit
                                </button>
                                <button *ngIf="!showDetails && expandedElement == element" mat-stroked-button class="edit-details-btn secondary" type="button" (click)="showFileEdit(null)"
                                    aria-label="Edit"><mat-icon class="edit-icon">edit</mat-icon>Close Edit
                                </button>
                                <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Icon-button with a menu" type="button">
                                    <mat-icon>more_vert</mat-icon>
                                </button>
                                <mat-menu #menu="matMenu">
                                    <button mat-menu-item *ngIf="showFileForm || expandedElement != element" class="view-details-mobile" type="button" (click)="showFileDetails(element)"
                                        aria-label="View Details"><mat-icon>search</mat-icon>
                                        <span> View Details</span>
                                    </button>
                                    <button mat-menu-item *ngIf="!showFileForm && expandedElement == element" class="view-details-mobile" type="button" (click)="showFileDetails(null)"
                                        aria-label="Close Details"><mat-icon>search</mat-icon>
                                        <span> Close Details</span>
                                    </button>
                                    <button *ngIf="showDetails || expandedElement != element" mat-menu-item class="edit-details-mobile" type="button" (click)="showFileEdit(element)"
                                        aria-label="Edit"><mat-icon class="edit-icon">edit</mat-icon>Edit
                                    </button>
                                    <button *ngIf="!showDetails && expandedElement == element" mat-menu-item class="edit-details-mobile" type="button" (click)="showFileEdit(null)"
                                        aria-label="Edit"><mat-icon class="edit-icon">edit</mat-icon>Close Edit
                                    </button>
                                    <button mat-menu-item class="delete-borderless" type="button" (click)="deleteFile(element)"
                                        aria-label="Delete"><mat-icon class="delete-borderless">delete_forever</mat-icon>
                                        <span>Delete</span>
                                    </button>
                                </mat-menu>
                            </td>
                        </ng-container> -->

                        <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
                        <ng-container matColumnDef="expandedDetail">
                            <td mat-cell *matCellDef="let element" [attr.colspan]="3">
                                <div class="element-detail"
                                    [@detailExpand]="showFileForm && expandedElement == element ? 'expanded' : 'collapsed'">
                                    <div class="expanded-body">
                                        <!-- Edit Sensor File Form -->
                                        <!-- <form [formGroup]="sensorFileForm">
                                            <mat-form-field appearance="fill">
                                                <mat-label>File Type</mat-label>
                                                <mat-select aria-label="File Type" formControlName="filetype_id" (selectionChange)="getFileTypeSelection($event)">
                                                    <mat-option *ngFor="let file of fileTypes" [value]="file.filetype_id">
                                                        {{file.filetype}}
                                                    </mat-option>
                                                </mat-select>
                                            </mat-form-field> -->

                                            <!--Upload Single Image with validations*-->
                                            <!-- <div *ngIf="addFileType === 'New' && selectedFile.FileEntity.filetype_id !== 8">
                                                <label class="custom-file-input-add" for="addFile">
                                                    <p class="required">*</p> {{ selectedFile.FileEntity.name || ' None Chosen' }}
                                                </label>
                                                <input #upload id="addFile" class="upload-file" type="file" max="500000" [hidden]="true" (change)="getFileName($event)">
                                            </div>
                                            <br clear="all" /> -->

                                            <!-- Data Process By (Data) -->
                                            <!-- <div class="row" *ngIf="selectedFile.FileEntity.filetype_id === 2">
                                                <label class="form-header">Data Process By: </label> {{processorName}}
                                            </div> -->

                                            <!-- Date Collected/Processed* (Data) -->
                                            <!-- <div *ngIf="selectedFile.FileEntity.filetype_id === 2">
                                                <mat-form-field appearance="fill">
                                                    <mat-label>Date Collected/Processed</mat-label>
                                                    <input aria-label="Date Collected/Processed" required matInput formControlName="collect_date" [value]="collectDate" [matDatepicker]="collectedDatePicker" placeholder="Choose a date">
                                                    <mat-datepicker-toggle matSuffix [for]="collectedDatePicker"></mat-datepicker-toggle>
                                                    <mat-datepicker [value]="collectDate" #collectedDatePicker></mat-datepicker>
                                                </mat-form-field>
                                            </div> -->

                                            <!--Source Name (photo)-->
                                            <!-- <div *ngIf="selectedFile.FileEntity.filetype_id === 1">
                                                <mat-form-field appearance="fill">
                                                    <mat-label>Source Photographer</mat-label>
                                                    <input aria-label="Source Photographer" formControlName="FULLname" matInput required [value]="selectedFile.FileEntity.FULLname"/>           
                                                </mat-form-field>
                                            </div> -->

                                            <!--Source Name (all other)-->
                                            <!-- <div *ngIf="selectedFile.FileEntity.filetype_id  > 2">
                                                <mat-form-field appearance="fill">
                                                    <mat-label>Source Name</mat-label>
                                                    <input aria-label="Source Name" formControlName="FULLname" matInput required [value]="selectedFile.FileEntity.FULLname"/>           
                                                </mat-form-field>
                                            </div> -->

                                            <!--Source Agency* (photo, allOther)-->
                                            <!-- <div *ngIf="selectedFile.FileEntity.filetype_id === 1 || selectedFile.FileEntity.filetype_id > 2">
                                                <mat-form-field appearance="fill">
                                                    <mat-label>Source Agency</mat-label>
                                                    <mat-select aria-label="Source Agency" required formControlName="agency_id" (selectionChange)="updateAgencyForCaption()">
                                                        <mat-option *ngFor="let a of agencies" [value]="a.agency_id">
                                                            {{a.agency_name}}
                                                        </mat-option>
                                                    </mat-select>
                                                </mat-form-field>
                                            </div> -->

                                            <!-- Photo Date* (photo) -->
                                            <!-- <div *ngIf="selectedFile.FileEntity.filetype_id === 1">
                                                <mat-form-field appearance="fill">
                                                    <mat-label>Photo Date</mat-label>
                                                    <input aria-label="Photo Date" matInput formControlName="photo_date" [value]="selectedFile.FileEntity.photo_date" [matDatepicker]="photoDatePicker" required placeholder="Choose a date">
                                                    <mat-datepicker-toggle matSuffix [for]="photoDatePicker"></mat-datepicker-toggle>
                                                    <mat-datepicker [value]="selectedFile.FileEntity.photo_date" #photoDatePicker></mat-datepicker>
                                                </mat-form-field>
                                            </div> -->

                                            <!-- Date Uploaded* (photo, data, allother) -->
                                            <!-- <div *ngIf="selectedFile.FileEntity.filetype_id > 0">
                                                <mat-form-field appearance="fill">
                                                    <mat-label>Date Uploaded</mat-label>
                                                    <input aria-label="Date Uploaded" matInput formControlName="file_date" [value]="selectedFile.FileEntity.file_date" [matDatepicker]="fileDatePicker" required placeholder="Choose a date">
                                                    <mat-datepicker-toggle matSuffix [for]="fileDatePicker"></mat-datepicker-toggle>
                                                    <mat-datepicker #fileDatePicker></mat-datepicker>
                                                </mat-form-field>
                                            </div> -->

                                            <!--Description*(photo, data, allother)-->
                                            <!-- <div *ngIf="selectedFile.FileEntity.filetype_id > 0">
                                                <mat-form-field appearance="fill">
                                                    <mat-label for="description">Description</mat-label>
                                                    <textarea aria-label="Description" matInput formControlName="description" required id="description" [value]="selectedFile.FileEntity.description"></textarea>
                                                    <mat-icon [hidden]="selectedFile.FileEntity.filetype_id !== 1" matSuffix class="info-icon" matTooltip="Populates in Photo caption below. If a person or people appear in photo include name(s). If non-USGS personnel, ensure consent to publish name in caption is given." 
                                                    aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                                </mat-form-field>
                                            </div> -->

                                            <!-- Elevation (Data) -->
                                            <!-- <div class="row" *ngIf="selectedFile.FileEntity.filetype_id === 2">
                                                <label class="form-header">Elevation:</label>
                                                <mat-radio-group class="radio-btn-group" [(value)]="selectedFile.FileEntity.elevation_status" formControlName="elevation_status">
                                                    <mat-radio-button class="radio-button" value="Final">Final</mat-radio-button>
                                                    <mat-radio-button class="radio-button" value="Arbitrary">Arbitrary</mat-radio-button>
                                                </mat-radio-group>
                                            </div> -->

                                            <!-- Approval Info -->
                                            <!-- <div class="row" *ngIf="selectedFile.FileEntity.filetype_id === 2 && selectedFile.FileEntity.file_id !== undefined && (selectedFile.FileEntity.is_nwis === undefined || selectedFile.FileEntity.is_nwis !== 1) && approvedBy">
                                                <label class="form-header">Approved By:</label> {{approvedBy || '---'}}
                                            </div>
                                            <div class="row" *ngIf="selectedFile.FileEntity.filetype_id === 2 && selectedFile.FileEntity.file_id !== undefined && (selectedFile.FileEntity.is_nwis === undefined || selectedFile.FileEntity.is_nwis !== 1) && approvedOn">
                                                <label class="form-header">Approval Date:</label> {{approvedOn | date: 'MM/dd/yyyy' || '---'}}
                                            </div> -->

                                            <!-- This is where Other ends, rest is for Photo -->
                                            <!--Photo Direction (photo)-->
                                            <!-- <div *ngIf="selectedFile.FileEntity.filetype_id === 1">
                                                <mat-form-field appearance="fill">
                                                    <mat-label>Photo Direction</mat-label>
                                                    <input aria-label="Photo Direction" formControlName="photo_direction" matInput [value]="selectedFile.FileEntity.photo_direction"/>           
                                                </mat-form-field>
                                            </div> -->

                                            <!-- Photo Latitude (photo)-->
                                            <!-- <div *ngIf="selectedFile.FileEntity.filetype_id === 1">
                                                <mat-form-field appearance="fill">
                                                    <mat-label>Photo Latitude (if different)</mat-label>
                                                    <input aria-label="Photo Latitude (if different)" formControlName="latitude_dd" matInput [value]="selectedFile.FileEntity.latitude_dd"/>           
                                                </mat-form-field>
                                            </div> -->
                                            <!-- LatDD Validator -->
                                            <!-- <div *ngIf="sensorFileForm.controls.latitude_dd.invalid && (sensorFileForm.controls.latitude_dd.dirty || sensorFileForm.controls.latitude_dd.touched)"
                                                class="alert alert-danger">
                                                <div *ngIf="sensorFileForm.controls.latitude_dd.errors?.['incorrectValue']">
                                                    The latitude must be between 0 and 73.0.
                                                </div>
                                            </div> -->

                                            <!--Photo Longitude (photo)-->
                                            <!-- <div *ngIf="selectedFile.FileEntity.filetype_id === 1">
                                                <mat-form-field appearance="fill">
                                                    <mat-label>Photo Longitude (if different)</mat-label>
                                                    <input aria-label="Photo longitude (if different)" formControlName="longitude_dd" matInput [value]="selectedFile.FileEntity.longitude_dd"/>           
                                                </mat-form-field>
                                            </div> -->
                                            <!-- LonDD Validator -->
                                            <!-- <div *ngIf="sensorFileForm.controls.longitude_dd.invalid && (sensorFileForm.controls.longitude_dd.dirty || sensorFileForm.controls.longitude_dd.touched)"
                                                class="alert alert-danger">
                                                <div *ngIf="sensorFileForm.controls.longitude_dd.errors?.['incorrectValue']">
                                                    The longitude must be between -175.0 and -60.0.
                                                </div>
                                            </div>

                                            <div *ngIf="selectedFile.FileEntity.filetype_id === 1">
                                                <label class="form-header" for="Caption">Preview Caption</label>
                                                <div>
                                                    <span>
                                                        Photo of {{sensorFileForm.value.description || ' (Description HERE) '}} at {{data.siteInfo.site_description}}, {{data.siteInfo.county}}, {{data.siteInfo.state}}, {{sensorFileForm.value.photo_date | date: 'MM/dd/yyyy' || ' Date taken HERE '}}. Photograph by {{sensorFileForm.value.FULLname || ' Source Name HERE ' }}, {{agencyNameForCap || ' Agency HERE '}}.
                                                    </span>
                                                </div>
                                            </div> -->

                                            <!-- associated files -->
                                            <!-- <div *ngIf="addFileType === 'Existing' && selectedFile.FileEntity.filetype_id !== 8 && selectedFile.FileEntity.is_nwis !== 1">
                                                <label class="form-header">Associated File:</label>
                                                <div>
                                                    <span *ngIf="fileItemExists">
                                                        <a target="_blank" title="Download File" href="{{fileSource}}">{{selectedFile.FileEntity.name}}</a>
                                                    </span>
                                                    <span *ngIf="!fileItemExists">-- Missing --</span> -->
                                                    <!--ReUpload Single Image with validations*-->
                                                    <!-- <div *ngIf="!fileItemExists">
                                                        <label class="custom-file-input" for="Upload">
                                                            <p class="required">*</p> {{ selectedFile.FileEntity.name || ' None Chosen' }}
                                                        </label>
                                                        <input #upload [hidden]="true" id="Upload" type="file" max="500000" file-model="existingFile.File" (change)="getFileName($event)">
                                                        <span *ngIf="fileUploading" class="file-upload-span">
                                                            Correct File?
                                                            <button aria-label="Upload" mat-button class="primary" *ngIf="fileUploading" type="button" (click)="saveFileUpload()">Upload</button>
                                                        </span>
                                                    </div> -->
                                                    <!-- change out the existing fileItem with a different one-->
                                                    <!-- <div *ngIf="fileItemExists">
                                                        <div>
                                                            <label class="custom-file-inputChange" for="Upload">
                                                                <p class="required">*</p> {{ selectedFile.FileEntity.name || ' None Chosen' }}
                                                            </label>
                                                            <input #upload [hidden]="true" id="Upload" type="file" max="500000" file-model="existingFile.File1" (change)="getFileName($event)">
                                                        </div>
                                                        <span *ngIf="fileUploading" class="file-upload-span">
                                                            Correct File?
                                                            <button aria-label="Is this file correct?" mat-button class="primary" *ngIf="fileUploading" type="button" (click)="saveFileUpload()">Upload</button>
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div [hidden]="siteFileIsUploading" class="file-button-group">
                                                <button aria-label="Save File" mat-button type="button" class="save-btn primary" *ngIf="selectedFile.FileEntity.file_id !== null" (click)="saveFile()">Save File</button>
                                                <button aria-label="Create File" mat-button type="button" class="save-btn primary" *ngIf="selectedFile.FileEntity.file_id == null" (click)="createFile()">Create File</button>
                                                <button aria-label="Close or Cancel File" mat-stroked-button class="secondary" style="margin-left: 10px" type="button" (click)="cancelFile()">Close/Cancel File</button>
                                            </div>
                                        </form> -->
                                    </div>
                                </div>
                                <div class="element-detail"
                                    [@detailExpand]="showDetails && expandedElement == element ? 'expanded' : 'collapsed'">
                                    <div class="expanded-body">
                                        <div class="table-container">
                                            <div class="outer-content">
                                                <div class="cell-container">
                                                    <p class="content-left">File Type</p>
                                                    <p class="content-right" *ngIf="fileType !== undefined && fileType !== ''; else nullFileType">{{fileType}}</p>
                                                    <ng-template #nullFileType><p class="content-right">---</p></ng-template>
                                                </div>
                                                <div class="cell-container" *ngIf="(element.is_nwis !== undefined && element.is_nwis === 1) || element.filetype_id === 8">
                                                    <p class="content-left">File URL</p>
                                                    <p class="content-right" *ngIf="element.name !== undefined && element.name !== ''; else nullFileURL">{{element.name}}</p>
                                                    <ng-template #nullFileURL><p class="content-right">---</p></ng-template>
                                                </div>
                                                <div class="cell-container" *ngIf="fileType === 'Photo'">
                                                    <p class="content-left">Source Photographer</p>
                                                    <p class="content-right" *ngIf="sourceName !== undefined && sourceName !== ''; else nullSourceName">{{sourceName}}</p>
                                                    <ng-template #nullSourceName><p class="content-right">---</p></ng-template>
                                                </div>
                                                <div class="cell-container" *ngIf="fileType !== 'Photo' && fileType !== 'Data' && (element.is_nwis === undefined || element.is_nwis !== 1)">
                                                    <p class="content-left">Source Name</p>
                                                    <p class="content-right" *ngIf="sourceName !== undefined && sourceName !== ''; else nullSourceName">{{sourceName}}</p>
                                                    <ng-template #nullSourceName><p class="content-right">---</p></ng-template>
                                                </div>
                                                <div class="cell-container" *ngIf="fileType !== 'Photo' && fileType !== 'Data' && (element.is_nwis === undefined || element.is_nwis !== 1)">
                                                    <p class="content-left">Source Agency</p>
                                                    <p class="content-right" *ngIf="sourceAgency !== undefined && sourceAgency !== ''; else nullSourceAgency">{{sourceAgency}}</p>
                                                    <ng-template #nullSourceAgency><p class="content-right">---</p></ng-template>
                                                </div>
                                                <div class="cell-container" *ngIf="fileType === 'Data'">
                                                    <p class="content-left">Data Process By</p>
                                                    <p class="content-right" *ngIf="processorName !== undefined && processorName !== ''; else nullProcessorName">{{processorName}}</p>
                                                    <ng-template #nullProcessorName><p class="content-right">---</p></ng-template>
                                                </div>
                                                <div class="cell-container" *ngIf="fileType === 'Data'">
                                                    <p class="content-left">Date Collected/Processed</p>
                                                    <p class="content-right" *ngIf="collectDate !== undefined && collectDate !== ''; else nullCollectDate">{{collectDate | date: 'MM/dd/yyyy' }}</p>
                                                    <ng-template #nullCollectDate><p class="content-right">---</p></ng-template>
                                                </div>
                                                <div class="cell-container"  *ngIf="fileType === 'Photo'">
                                                    <p class="content-left">Photo Date</p>
                                                    <p class="content-right" *ngIf="element.photo_date !== undefined && element.photo_date !== ''; else nullPhotoDate">{{element.photo_date | date: 'MM/dd/yyyy'}}</p>
                                                    <ng-template #nullPhotoDate><p class="content-right">---</p></ng-template>
                                                </div>
                                                <div class="cell-container">
                                                    <p class="content-left">Date Uploaded</p>
                                                    <p class="content-right" *ngIf="element.file_date !== undefined && element.file_date !== ''; else nullFileDate">{{element.file_date | date: 'MM/dd/yyyy'}}</p>
                                                    <ng-template #nullFileDate><p class="content-right">---</p></ng-template>
                                                </div>
                                                <div class="cell-container">
                                                    <p class="content-left">Description</p>
                                                    <p class="content-right" *ngIf="element.description !== undefined && element.description !== ''; else nullDesc">{{element.description}}</p>
                                                    <ng-template #nullDesc><p class="content-right">---</p></ng-template>
                                                </div>
                                                <div class="cell-container" *ngIf="fileType === 'Data'">
                                                    <p class="content-left">Elevation</p>
                                                    <p class="content-right" *ngIf="elevation !== undefined && elevation !== ''; else nullElevation">{{elevation}}</p>
                                                    <ng-template #nullElevation><p class="content-right">---</p></ng-template>
                                                </div>
                                                <div class="cell-container" *ngIf="fileType === 'Data' && (element.is_nwis === undefined || element.is_nwis !== 1)">
                                                    <p class="content-left">Approved By</p>
                                                    <p class="content-right" *ngIf="approvedBy !== undefined && approvedBy !== '' && approvedBy !== null; else nullApprovalBy">{{approvedBy}}</p>
                                                    <ng-template #nullApprovalBy><p class="content-right">---</p></ng-template>
                                                </div>
                                                <div class="cell-container" *ngIf="fileType === 'Data' && (element.is_nwis === undefined || element.is_nwis !== 1)">
                                                    <p class="content-left">Approval Date</p>
                                                    <p class="content-right" *ngIf="approvedOn !== undefined && approvedOn !== '' && approvedOn !== null; else nullApprovalOn">{{approvedOn | date: 'MM/dd/yyyy hh:mm a'}}</p>
                                                    <ng-template #nullApprovalOn><p class="content-right">---</p></ng-template>
                                                </div>
                                                <div class="cell-container" *ngIf="fileType === 'Photo'">
                                                    <p class="content-left">Photo Direction</p>
                                                    <p class="content-right" *ngIf="element.photo_direction !== undefined && element.photo_direction !== ''; else nullPhotoDir">{{element.photo_direction}}</p>
                                                    <ng-template #nullPhotoDir><p class="content-right">---</p></ng-template>
                                                </div>
                                                <div class="cell-container" *ngIf="fileType === 'Photo'">
                                                    <p class="content-left">Photo Latitude (if different)</p>
                                                    <p class="content-right" *ngIf="element.latitude_dd !== undefined && element.latitude_dd !== ''; else nullPhotoLat">{{element.latitude_dd}}</p>
                                                    <ng-template #nullPhotoLat><p class="content-right">---</p></ng-template>
                                                </div>
                                                <div class="cell-container" *ngIf="fileType === 'Photo'">
                                                    <p class="content-left">Photo Longitude (if different)</p>
                                                    <p class="content-right" *ngIf="element.longitude_dd !== undefined && element.longitude_dd !== ''; else nullPhotoLon">{{element.longitude_dd}}</p>
                                                    <ng-template #nullPhotoLon><p class="content-right">---</p></ng-template>
                                                </div>
                                                <div class="cell-container" *ngIf="fileType === 'Photo'">
                                                    <p class="content-left">Preview Caption</p>
                                                    <p class="content-right">Photo of {{previewCaption.description}} at {{previewCaption.site_description}}, {{previewCaption.county}}, {{previewCaption.state}}, {{previewCaption.photo_date | date: 'MM/dd/yyyy'}}.  Photograph by {{previewCaption.sourceName}}, {{previewCaption.sourceAgency}}</p>
                                                </div>
                                                <div class="cell-container" *ngIf="element.is_nwis === undefined || element.is_nwis !== 1">
                                                    <p class="content-left">Associated File</p>
                                                    <p class="content-right"><a id="associatedFile" href="{{fileSource}}" target="_blank">{{element.name}}</a></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedFileColumns"></tr>
                        <tr mat-row *matRowDef="let element; columns: displayedFileColumns;">
                        </tr>
                        <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="detail-row"></tr>
                    </table>
                </div>
            </mat-expansion-panel>
            <mat-expansion-panel hideToggle [expanded]="nwisExpanded"  (opened)="nwisExpanded = true" (closed)="nwisExpanded = false" *ngIf="sensor.statusType === 'Deployed' && editOrCreate === 'Edit'">
                <mat-expansion-panel-header>
                    <mat-panel-title *ngIf="!nwisExpanded" style="color: grey; font-weight: 500">
                        NWIS Connection
                    </mat-panel-title>
                    <mat-panel-title *ngIf="nwisExpanded" style="color: #FFF; font-weight: 550">
                        NWIS Connection
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <button mat-stroked-button *ngIf="this.currentUser !== null && (this.currentUser.role_id === 1 || this.currentUser.role_id === 2)" (click)="showFileCreate(true)" class="add" type="button"
                    aria-label="Add File"><mat-icon>add</mat-icon> Add File
                </button> 
                <!-- Disabled Add -->
                <button *ngIf="this.currentUser !== null && this.currentUser.role_id !== 1 && this.currentUser.role_id !== 2" disabled mat-stroked-button class="disabled-border"
                    aria-label="Add File"><mat-icon>add</mat-icon> Add File
                </button>
                <!-- Create Sensor File Form -->
                <!-- <form *ngIf="showNWISFileCreateForm" [formGroup]="sensorFileForm">
                    <div class="row">
                        <label class="form-header filetype-header">File Type: </label> {{fileType}}
                    </div> -->

                    <!--File URL (NWIS file)-->
                    <!-- <div *ngIf="(selectedFile.FileEntity.is_nwis === 1)">
                        <mat-form-field appearance="fill">
                            <mat-label>File URL</mat-label>
                            <input aria-label="File URL" formControlName="name" matInput [value]="selectedFile.FileEntity.name"/>
                            <mat-icon matSuffix class="info-icon" matTooltip="Please link to persistent URLs or digital object identifier (doi) urls." 
                            aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>                
                        </mat-form-field>
                    </div> -->

                    <!-- Data Process By (Data) -->
                    <!-- <div class="row" *ngIf="selectedFile.FileEntity.filetype_id === 2">
                        <label class="form-header">Data Process By: </label> {{processorName}}
                    </div> -->

                    <!-- Date Collected/Processed* (Data) -->
                    <!-- <div *ngIf="selectedFile.FileEntity.filetype_id === 2">
                        <mat-form-field appearance="fill">
                            <mat-label>Date Collected/Processed</mat-label>
                            <input aria-label="Date Collected/Processed" required matInput formControlName="collect_date" [value]="collectDate" [matDatepicker]="collectedDatePicker" placeholder="Choose a date">
                            <mat-datepicker-toggle matSuffix [for]="collectedDatePicker"></mat-datepicker-toggle>
                            <mat-datepicker [value]="collectDate" #collectedDatePicker></mat-datepicker>
                        </mat-form-field>
                    </div> -->

                    <!-- Date Uploaded* (photo, data, allother) -->
                    <!-- <div *ngIf="selectedFile.FileEntity.filetype_id > 0">
                        <mat-form-field appearance="fill">
                            <mat-label>Date Uploaded</mat-label>
                            <input aria-label="Date Uploaded" matInput formControlName="file_date" [value]="selectedFile.FileEntity.file_date" [matDatepicker]="fileDatePicker" required placeholder="Choose a date">
                            <mat-datepicker-toggle matSuffix [for]="fileDatePicker"></mat-datepicker-toggle>
                            <mat-datepicker #fileDatePicker></mat-datepicker>
                        </mat-form-field>
                    </div> -->

                    <!--Description*(photo, data, allother)-->
                    <!-- <div *ngIf="selectedFile.FileEntity.filetype_id > 0">
                        <mat-form-field appearance="fill">
                            <mat-label for="description">Description</mat-label>
                            <textarea aria-label="Description" matInput formControlName="description" required id="description" [value]="selectedFile.FileEntity.description"></textarea>
                            <mat-icon [hidden]="selectedFile.FileEntity.filetype_id !== 1" matSuffix class="info-icon" matTooltip="Populates in Photo caption below. If a person or people appear in photo include name(s). If non-USGS personnel, ensure consent to publish name in caption is given." 
                            aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                        </mat-form-field>
                    </div> -->

                     <!-- Elevation (Data) -->
                     <!-- <div class="row" *ngIf="selectedFile.FileEntity.filetype_id === 2">
                        <label class="form-header">Elevation:</label>
                        <mat-radio-group class="radio-btn-group" [(value)]="selectedFile.FileEntity.elevation_status" formControlName="elevation_status">
                            <mat-radio-button class="radio-button" value="Final">Final</mat-radio-button>
                            <mat-radio-button class="radio-button" value="Arbitrary">Arbitrary</mat-radio-button>
                        </mat-radio-group>
                    </div> -->

                    <!-- Approval Info -->
                    <!-- <div class="row" *ngIf="selectedFile.FileEntity.filetype_id === 2 && selectedFile.FileEntity.file_id !== undefined && (selectedFile.FileEntity.is_nwis === undefined || selectedFile.FileEntity.is_nwis !== 1) && approvedBy">
                        <label class="form-header">Approved By:</label> {{approvedBy || '---'}}
                    </div>
                    <div class="row" *ngIf="selectedFile.FileEntity.filetype_id === 2 && selectedFile.FileEntity.file_id !== undefined && (selectedFile.FileEntity.is_nwis === undefined || selectedFile.FileEntity.is_nwis !== 1) && approvedOn">
                        <label class="form-header">Approval Date:</label> {{approvedOn | date: 'MM/dd/yyyy' || '---'}}
                    </div>

                    <div [hidden]="siteFileIsUploading" class="file-button-group">
                        <button aria-label="Save File" mat-button type="button" class="save-btn primary" *ngIf="selectedFile.FileEntity.file_id !== null" (click)="saveFile()">Save File</button>
                        <button aria-label="Create File" mat-button type="button" class="save-btn primary" *ngIf="selectedFile.FileEntity.file_id == null" (click)="createFile()">Create File</button>
                        <button aria-label="Close or Cancel File" mat-stroked-button class="secondary" style="margin-left: 10px" type="button" (click)="cancelFile()">Close/Cancel File</button>
                    </div>
                </form> -->
                <div class="tableContainer">
                    <table *ngIf="initNWISFiles.length > 0"
                        mat-table
                        id="initNWISFilesTable"
                        [dataSource]="initNWISFiles"
                        class="mat-elevation-z5"
                        multiTemplateDataRows
                    >
        
                        <!-- NWIS file name column -->
                        <ng-container matColumnDef="FileName">
                            <th mat-header-cell *matHeaderCellDef>File Name</th>
                            <td mat-cell *matCellDef="let file">
                                <div *ngIf="file.name === '' || file.name === undefined; else displayNWISFileName">
                                    ---
                                </div>
                                <ng-template #displayNWISFileName>
                                    {{ file.name }}
                                </ng-template>
                            </td>
                        </ng-container>

                        <!-- NWIS file date column -->
                        <ng-container matColumnDef="FileDate">
                            <th mat-header-cell *matHeaderCellDef>File Date</th>
                            <td mat-cell *matCellDef="let file">
                                <div *ngIf="file.file_date === '' || file.file_date === undefined; else displayNWISFileDate">
                                    ---
                                </div>
                                <ng-template #displayNWISFileDate>
                                    {{ file.file_date | date: 'MM/dd/yyyy'}}
                                </ng-template>
                            </td>
                        </ng-container>

                        <!-- button column -->
                        <!-- <ng-container matColumnDef="expand">
                            <th mat-header-cell *matHeaderCellDef></th>
                            <td mat-cell *matCellDef="let element">
                                <button mat-stroked-button *ngIf="showFileForm || expandedElement != element" class="view-details-btn secondary" type="button" (click)="showFileDetails(element)"
                                    aria-label="View Details">View Details
                                </button>
                                <button mat-stroked-button *ngIf="!showFileForm && expandedElement == element" class="view-details-btn secondary" type="button" (click)="showFileDetails(null)"
                                    aria-label="Close Details">Close Details
                                </button>
                                <button *ngIf="showDetails || expandedElement != element" [disabled]="this.currentUser !== null && this.currentUser.role_id !== 1 && this.currentUser.role_id !== 2" mat-stroked-button class="edit-details-btn secondary" type="button" (click)="showFileEdit(element)"
                                    aria-label="Edit"><mat-icon class="edit-icon">edit</mat-icon>Edit
                                </button>
                                <button *ngIf="!showDetails && expandedElement == element" mat-stroked-button class="edit-details-btn secondary" type="button" (click)="showFileEdit(null)"
                                    aria-label="Edit"><mat-icon class="edit-icon">edit</mat-icon>Close Edit
                                </button>
                                <button mat-icon-button [matMenuTriggerFor]="menu" aria-label="Icon-button with a menu" type="button">
                                    <mat-icon>more_vert</mat-icon>
                                </button>
                                <mat-menu #menu="matMenu">
                                    <button mat-menu-item *ngIf="showFileForm || expandedElement != element" class="view-details-mobile" type="button" (click)="showFileDetails(element)"
                                        aria-label="View Details"><mat-icon>search</mat-icon>
                                        <span> View Details</span>
                                    </button>
                                    <button mat-menu-item *ngIf="!showFileForm && expandedElement == element" class="view-details-mobile" type="button" (click)="showFileDetails(null)"
                                        aria-label="Close Details"><mat-icon>search</mat-icon>
                                        <span> Close Details</span>
                                    </button>
                                    <button *ngIf="showDetails || expandedElement != element" [disabled]="this.currentUser !== null && this.currentUser.role_id !== 1 && this.currentUser.role_id !== 2" mat-menu-item class="edit-details-mobile" type="button" (click)="showFileEdit(element)"
                                        aria-label="Edit"><mat-icon class="edit-icon">edit</mat-icon>Edit
                                    </button>
                                    <button *ngIf="!showDetails && expandedElement == element" mat-menu-item class="edit-details-mobile" type="button" (click)="showFileEdit(null)"
                                        aria-label="Edit"><mat-icon class="edit-icon">edit</mat-icon>Close Edit
                                    </button>
                                    <button mat-menu-item class="delete-borderless" type="button" (click)="deleteFile(element)"
                                        aria-label="Delete"><mat-icon class="delete-borderless">delete_forever</mat-icon>
                                        <span>Delete</span>
                                    </button>
                                </mat-menu>
                            </td>
                        </ng-container> -->

                        <!-- Expanded Content Column - The detail row is made up of this one column that spans across all columns -->
                        <ng-container matColumnDef="expandedDetail">
                            <td mat-cell *matCellDef="let element" [attr.colspan]="3">
                                <div class="element-detail"
                                    [@detailExpand]="showFileForm && expandedElement == element ? 'expanded' : 'collapsed'">
                                    <div class="expanded-body">
                                        <!-- Edit Sensor File Form -->
                                        <form [formGroup]="sensorFileForm">
                                            <div class="row">
                                                <label class="form-header">File Type: </label> {{fileType}}
                                            </div>

                                            <!--File URL (NWIS file)-->
                                            <div *ngIf="(selectedFile.FileEntity.is_nwis !== undefined && selectedFile.FileEntity.is_nwis === 1) || selectedFile.FileEntity.filetype_id === 8">
                                                <mat-form-field appearance="fill">
                                                    <mat-label>File URL</mat-label>
                                                    <input aria-label="File URL" formControlName="name" matInput [value]="selectedFile.FileEntity.name"/>
                                                    <mat-icon matSuffix class="info-icon" matTooltip="Please link to persistent URLs or digital object identifier (doi) urls." 
                                                    aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>                
                                                </mat-form-field>
                                            </div>

                                            <!-- Data Process By (Data) -->
                                            <div class="row" *ngIf="selectedFile.FileEntity.filetype_id === 2">
                                                <label class="form-header">Data Process By: </label> {{processorName}}
                                            </div>

                                            <!-- Date Collected/Processed* (Data) -->
                                            <div *ngIf="selectedFile.FileEntity.filetype_id === 2">
                                                <mat-form-field appearance="fill">
                                                    <mat-label>Date Collected/Processed</mat-label>
                                                    <input aria-label="Date Collected/Processed" required matInput formControlName="collect_date" [value]="collectDate" [matDatepicker]="collectedDatePicker" placeholder="Choose a date">
                                                    <mat-datepicker-toggle matSuffix [for]="collectedDatePicker"></mat-datepicker-toggle>
                                                    <mat-datepicker [value]="collectDate" #collectedDatePicker></mat-datepicker>
                                                </mat-form-field>
                                            </div>

                                            <!-- Date Uploaded* (photo, data, allother) -->
                                            <div *ngIf="selectedFile.FileEntity.filetype_id > 0">
                                                <mat-form-field appearance="fill">
                                                    <mat-label>Date Uploaded</mat-label>
                                                    <input aria-label="Date Uploaded" matInput formControlName="file_date" [value]="selectedFile.FileEntity.file_date" [matDatepicker]="fileDatePicker" required placeholder="Choose a date">
                                                    <mat-datepicker-toggle matSuffix [for]="fileDatePicker"></mat-datepicker-toggle>
                                                    <mat-datepicker #fileDatePicker></mat-datepicker>
                                                </mat-form-field>
                                            </div>

                                            <!--Description*(photo, data, allother)-->
                                            <div *ngIf="selectedFile.FileEntity.filetype_id > 0">
                                                <mat-form-field appearance="fill">
                                                    <mat-label for="description">Description</mat-label>
                                                    <textarea aria-label="Description" matInput formControlName="description" required id="description" [value]="selectedFile.FileEntity.description"></textarea>
                                                    <mat-icon [hidden]="selectedFile.FileEntity.filetype_id !== 1" matSuffix class="info-icon" matTooltip="Populates in Photo caption below. If a person or people appear in photo include name(s). If non-USGS personnel, ensure consent to publish name in caption is given." 
                                                    aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                                </mat-form-field>
                                            </div>

                                            <!-- Elevation (Data) -->
                                            <div class="row" *ngIf="selectedFile.FileEntity.filetype_id === 2">
                                                <label class="form-header">Elevation:</label>
                                                <mat-radio-group class="radio-btn-group" [(value)]="selectedFile.FileEntity.elevation_status" formControlName="elevation_status">
                                                    <mat-radio-button class="radio-button" value="Final">Final</mat-radio-button>
                                                    <mat-radio-button class="radio-button" value="Arbitrary">Arbitrary</mat-radio-button>
                                                </mat-radio-group>
                                            </div>

                                            <!-- Approval Info -->
                                            <div class="row" *ngIf="selectedFile.FileEntity.filetype_id === 2 && selectedFile.FileEntity.file_id !== undefined && (selectedFile.FileEntity.is_nwis === undefined || selectedFile.FileEntity.is_nwis !== 1) && approvedBy">
                                                <label class="form-header">Approved By:</label> {{approvedBy || '---'}}
                                            </div>
                                            <div class="row" *ngIf="selectedFile.FileEntity.filetype_id === 2 && selectedFile.FileEntity.file_id !== undefined && (selectedFile.FileEntity.is_nwis === undefined || selectedFile.FileEntity.is_nwis !== 1) && approvedOn">
                                                <label class="form-header">Approval Date:</label> {{approvedOn | date: 'MM/dd/yyyy' || '---'}}
                                            </div>

                                            <div [hidden]="siteFileIsUploading" class="file-button-group">
                                                <button aria-label="Save File" mat-button type="button" class="save-btn primary" *ngIf="selectedFile.FileEntity.file_id !== null" (click)="saveFile()">Save File</button>
                                                <button aria-label="Create File" mat-button type="button" class="save-btn primary" *ngIf="selectedFile.FileEntity.file_id == null" (click)="createFile()">Create File</button>
                                                <button aria-label="Close or Cancel File" mat-stroked-button class="secondary" style="margin-left: 10px" type="button" (click)="cancelFile()">Close/Cancel File</button>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                                <div class="element-detail"
                                    [@detailExpand]="showDetails && expandedElement == element ? 'expanded' : 'collapsed'">
                                    <div class="expanded-body">
                                        <div class="table-container">
                                            <div class="outer-content">
                                                <div class="cell-container">
                                                    <p class="content-left">File Type</p>
                                                    <p class="content-right" *ngIf="fileType !== undefined && fileType !== ''; else nullFileType">{{fileType}}</p>
                                                    <ng-template #nullFileType><p class="content-right">---</p></ng-template>
                                                </div>
                                                <div class="cell-container" *ngIf="(element.is_nwis !== undefined && element.is_nwis === 1) || element.filetype_id === 8">
                                                    <p class="content-left">File URL</p>
                                                    <p class="content-right" *ngIf="element.name !== undefined && element.name !== ''; else nullFileURL">{{element.name}}</p>
                                                    <ng-template #nullFileURL><p class="content-right">---</p></ng-template>
                                                </div>
                                                <div class="cell-container" *ngIf="fileType === 'Data'">
                                                    <p class="content-left">Data Process By</p>
                                                    <p class="content-right" *ngIf="processorName !== undefined && processorName !== ''; else nullProcessorName">{{processorName}}</p>
                                                    <ng-template #nullProcessorName><p class="content-right">---</p></ng-template>
                                                </div>
                                                <div class="cell-container" *ngIf="fileType === 'Data'">
                                                    <p class="content-left">Date Collected/Processed</p>
                                                    <p class="content-right" *ngIf="collectDate !== undefined && collectDate !== ''; else nullCollectDate">{{collectDate | date: 'MM/dd/yyyy' }}</p>
                                                    <ng-template #nullCollectDate><p class="content-right">---</p></ng-template>
                                                </div>
                                                <div class="cell-container">
                                                    <p class="content-left">Date Uploaded</p>
                                                    <p class="content-right" *ngIf="element.file_date !== undefined && element.file_date !== ''; else nullFileDate">{{element.file_date | date: 'MM/dd/yyyy'}}</p>
                                                    <ng-template #nullFileDate><p class="content-right">---</p></ng-template>
                                                </div>
                                                <div class="cell-container">
                                                    <p class="content-left">Description</p>
                                                    <p class="content-right" *ngIf="element.description !== undefined && element.description !== ''; else nullDesc">{{element.description}}</p>
                                                    <ng-template #nullDesc><p class="content-right">---</p></ng-template>
                                                </div>
                                                <div class="cell-container" *ngIf="fileType === 'Data'">
                                                    <p class="content-left">Elevation</p>
                                                    <p class="content-right" *ngIf="elevation !== undefined && elevation !== ''; else nullElevation">{{elevation}}</p>
                                                    <ng-template #nullElevation><p class="content-right">---</p></ng-template>
                                                </div>
                                                <div class="cell-container" *ngIf="fileType === 'Data' && (element.is_nwis === undefined || element.is_nwis !== 1)">
                                                    <p class="content-left">Approved By</p>
                                                    <p class="content-right" *ngIf="approvedBy !== undefined && approvedBy !== '' && approvedBy !== null; else nullApprovalBy">{{approvedBy}}</p>
                                                    <ng-template #nullApprovalBy><p class="content-right">---</p></ng-template>
                                                </div>
                                                <div class="cell-container" *ngIf="fileType === 'Data' && (element.is_nwis === undefined || element.is_nwis !== 1)">
                                                    <p class="content-left">Approval Date</p>
                                                    <p class="content-right" *ngIf="approvedOn !== undefined && approvedOn !== '' && approvedOn !== null; else nullApprovalOn">{{approvedOn | date: 'MM/dd/yyyy hh:mm a'}}</p>
                                                    <ng-template #nullApprovalOn><p class="content-right">---</p></ng-template>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </td>
                        </ng-container>
                        
                        <tr mat-row *matRowDef="let element; columns: displayedNWISFileColumns;">
                        </tr>
                        <tr mat-row *matRowDef="let row; columns: ['expandedDetail']" class="detail-row"></tr>
                    </table>
                </div>
            </mat-expansion-panel>
        </mat-accordion>
    </mat-dialog-content>
    <mat-dialog-actions align="end">
        <div class="detail-section-buttons centered">
            <button *ngIf="editOrCreate === 'Create'" class="primary" mat-button cdkFocusInitial aria-label="Deploy" id="1" type="submit">Deploy</button>
            <button mat-stroked-button class="secondary" [mat-dialog-close]="{returnFiles: returnFiles}" cdkFocusInitial aria-label="Cancel">Cancel</button>
            <!-- The mat-dialog-close directive optionally accepts a value as a result for the dialog. -->
        </div>
    </mat-dialog-actions>
</form>



