<h2 mat-dialog-title>
    Edit Sensor
    <button class="close-button" mat-button [mat-dialog-close]="returnData" aria-label="Exit"><mat-icon>close</mat-icon></button>
</h2>
<div [hidden]="!loading" class="loading">
    <mat-spinner style="margin:0 auto; top: 50%" mode="indeterminate" diameter="20"></mat-spinner>
</div>
<form [formGroup]="form" (ngSubmit)="submit($event.submitter.id)">
    <mat-dialog-content>
        <mat-accordion multi="true">
            <mat-expansion-panel hideToggle [expanded]="deployedExpanded" (opened)="deployedExpanded = true" (closed)="deployedExpanded = false">
                <mat-expansion-panel-header>
                    <mat-panel-title *ngIf="!deployedExpanded" style="color: grey; font-weight: 500">
                        Deployed Sensor Information
                    </mat-panel-title>
                    <mat-panel-title *ngIf="deployedExpanded" style="color: #FFF; font-weight: 550">
                        Deployed Sensor Information
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <div *ngIf="role === 2 || role === 3">
                    <label class="form-header">Event: </label> {{this.sensor.eventName}}
                </div>
                <div *ngIf="role === 1">
                    <mat-form-field appearance="fill">
                        <mat-label>Event</mat-label>
                        <mat-select required aria-label="Event" formControlName="event_id">
                            <mat-option *ngFor="let event of events" [value]="event.event_id">
                            {{event.event_name}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                </div>
                <mat-form-field appearance="fill">
                    <mat-label>Sensor Type</mat-label>
                    <mat-select required aria-label="Sensor Type" formControlName="sensor_type_id">
                        <mat-option *ngFor="let type of sensorTypes" [value]="type.sensor_type_id">
                        {{type.sensor}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                <mat-form-field appearance="fill">
                    <mat-label>Sensor Brand</mat-label>
                    <mat-select required aria-label="Sensor Brand" formControlName="sensor_brand_id">
                        <mat-option *ngFor="let brand of sensorBrands" [value]="brand.sensor_brand_id">
                        {{brand.brand_name}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                <mat-form-field appearance="fill">
                    <mat-label>Serial Number</mat-label>
                    <input aria-label="Serial Number" matInput formControlName="serial_number" required [value]="sensor.serial_number"/>
                    <mat-icon matSuffix class="info-icon" matTooltip="Will be used in netCDF metadata." 
                    aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                </mat-form-field>
                <mat-form-field appearance="fill">
                    <mat-label>Housing Serial Number</mat-label>
                    <input aria-label="Housing Serial Number" matInput formControlName="housing_serial_number" [value]="sensor.housing_serial_number"/>
                    <mat-icon matSuffix class="info-icon" matTooltip="Required for DOI WATCH OFFICE 800 number." 
                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                </mat-form-field>
                <mat-form-field appearance="fill">
                    <mat-label>Housing Type</mat-label>
                    <mat-select aria-label="Housing Type" formControlName="housing_type_id">
                        <mat-option *ngFor="let type of housingTypes" [value]="type.housing_type_id">
                        {{type.type_name}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                <mat-divider></mat-divider>
                <div class="tapedown-header">
                    <label class="form-header">Tapedowns: </label>
                </div>
                <div class="tapedowns" [hidden]="!opsPresent">
                        <mat-form-field appearance="fill">
                            <mat-label>Reference Datums</mat-label>
                                    <mat-select aria-label="Reference Datums" formControlName="deployedRefMarks" (selectionChange)="changeTableValue($event.value, 'Deployed')" multiple>
                                        <mat-option *ngFor="let refmark of data.siteRefMarks" [value]="refmark.name">
                                        {{refmark.name}}
                                        </mat-option>
                                    </mat-select>
                                <mat-icon matSuffix class="info-icon" matTooltip="These elevations and tapedown data are used for both field activities and final products. Please pay attention to how your data is entered." 
                                aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                        </mat-form-field>
                </div>
                <div class="tapedowns" [hidden]="opsPresent">
                    <label>
                        No Datum Locations have been added to this site yet to use for a tape down
                    </label>
                </div>
                <div class="tableContainer">
                    <table [hidden]="!form.controls.deployedTapedowns.length > 0"
                        #deployedTable
                        mat-table
                        id="tapedownsTable"
                        [dataSource]="deployedTapedowns"
                        formArrayName="deployedTapedowns"
                        class="mat-elevation-z5"
                        matSort
                    >

                        <!-- Reference Datum name column -->
                        <ng-container matColumnDef="ReferenceDatum">
                            <th mat-header-cell *matHeaderCellDef>Reference Datum</th>
                            <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                <mat-form-field>
                                    <input matInput formControlName="op_name" [value]="tapedown.op_name" class="disabled"/>
                                </mat-form-field>
                            </td>
                        </ng-container>
    
                        <!-- Elevation column -->
                        <ng-container matColumnDef="Elevation">
                            <th mat-header-cell *matHeaderCellDef>Elevation</th>
                            <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                <mat-form-field>
                                    <div class="inline-fields">
                                        <div *ngIf="tapedown.elevation !== undefined">
                                            <input matInput formControlName="elevation" [value]="tapedown.elevation" class="disabled"/>
                                        </div>
                                        <input matInput formControlName="vdatum" [value]="tapedown.vdatum" class="disabled"/>
                                    </div>
                                </mat-form-field>
                                <!-- Elevation Validator -->
                                <div *ngIf="form.controls.deployedTapedowns.controls[i].controls.elevation.invalid && (form.controls.deployedTapedowns.controls[i].controls.elevation.dirty || form.controls.deployedTapedowns.controls[i].controls.elevation.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.deployedTapedowns.controls[i].controls.elevation.errors?.['incorrectValue']">
                                        Elevation must be a numeric value.
                                    </div>
                                </div>
                            </td>
                        </ng-container>

                        <!-- Offset correction column -->
                        <ng-container matColumnDef="OffsetCorrection">
                            <th mat-header-cell *matHeaderCellDef>Offset Correction</th>
                            <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                <mat-form-field appearance="fill">
                                    <input matInput type="number" formControlName="offset_correction" [value]="tapedown.offset_correction"/>
                                    <mat-icon matSuffix class="info-icon" matTooltip="From the datum location to the sensor orifice."
                                    aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                </mat-form-field>
                                <!-- Offset Correction Validator -->
                                <div *ngIf="form.controls.deployedTapedowns.controls[i].controls.offset_correction.invalid && (form.controls.deployedTapedowns.controls[i].controls.offset_correction.dirty || form.controls.deployedTapedowns.controls[i].controls.offset_correction.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.deployedTapedowns.controls[i].controls.offset_correction.errors?.['incorrectValue']">
                                        Offset Correction must be a numeric value.
                                    </div>
                                </div>
                            </td>
                        </ng-container>

                        <!-- WS column -->
                        <ng-container matColumnDef="WaterSurface">
                            <th mat-header-cell *matHeaderCellDef>Water Surface</th>
                            <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                <mat-form-field appearance="fill">
                                    <input matInput formControlName="water_surface" type="number" [value]="tapedown.water_surface"/>
                                    <mat-icon matSuffix class="info-icon" matTooltip="From the datum location to the water surface."
                                    aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                </mat-form-field>
                                <!-- Water Surface Validator -->
                                <div *ngIf="form.controls.deployedTapedowns.controls[i].controls.water_surface.invalid && (form.controls.deployedTapedowns.controls[i].controls.water_surface.dirty || form.controls.deployedTapedowns.controls[i].controls.water_surface.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.deployedTapedowns.controls[i].controls.water_surface.errors?.['incorrectValue']">
                                        Water Surface must be a numeric value.
                                    </div>
                                </div>
                            </td>
                        </ng-container>

                        <!-- GS column -->
                        <ng-container matColumnDef="GroundSurface">
                            <th mat-header-cell *matHeaderCellDef>Ground Surface</th>
                            <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                <mat-form-field appearance="fill">
                                    <input matInput formControlName="ground_surface" type="number" [value]="tapedown.ground_surface"/>
                                    <mat-icon matSuffix class="info-icon" matTooltip="From the datum location to the ground surface."
                                    aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                </mat-form-field>
                                <!-- Ground Surface Validator -->
                                <div *ngIf="form.controls.deployedTapedowns.controls[i].controls.ground_surface.invalid && (form.controls.deployedTapedowns.controls[i].controls.ground_surface.dirty || form.controls.deployedTapedowns.controls[i].controls.ground_surface.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.deployedTapedowns.controls[i].controls.ground_surface.errors?.['incorrectValue']">
                                        Ground Surface must be a numeric value.
                                    </div>
                                </div>
                            </td>
                        </ng-container>
    
                        <tr mat-header-row *matHeaderRowDef="displayedTapedownColumns"></tr>
                        <tr
                            mat-row
                            *matRowDef="let row; columns: displayedTapedownColumns"
                            class="results-row"
                        ></tr>
                    </table>
                </div>
                <div class="note">
                    <label>Note: these are not used for any calculations but are to facilitate field activities.</label>
                </div>
                <div *ngIf="sensor.instrument_status.length > 0">
                    <div *ngFor="let instrument of sensor.instrument_status; let i = index" formArrayName="instrument_status">
                        <div *ngIf="instrument.status === 'Deployed'">
                            <div [formGroupName]="i">
                                <mat-form-field appearance="fill">
                                    <mat-label>Sensor Elevation</mat-label>
                                    <input aria-label="Sensor Elevation" matInput type="number" formControlName="sensor_elevation" [value]="instrument.sensor_elevation">
                                    <mat-icon matSuffix class="info-icon" matTooltip="Using the offset correction, elevation of the sensor orifice." 
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                </mat-form-field>
                                <!-- Sensor Elevation Validator -->
                                <div *ngIf="form.controls.instrument_status.controls[i].controls.sensor_elevation.invalid && (form.controls.instrument_status.controls[i].controls.sensor_elevation.dirty || form.controls.instrument_status.controls[i].controls.sensor_elevation.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.instrument_status.controls[i].controls.sensor_elevation.errors?.['incorrectValue']">
                                        Sensor Elevation must be a numeric value.
                                    </div>
                                </div>
                                <mat-form-field appearance="fill">
                                    <mat-label>Water Surface Elevation</mat-label>
                                    <input aria-label="Water Surface Elevation" matInput type="number" formControlName="ws_elevation" [value]="instrument.ws_elevation">
                                    <mat-icon matSuffix class="info-icon" matTooltip="Using the water surface tape down, elevation of the water surface." 
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                </mat-form-field>
                                <!-- Water Surface Elevation Validator -->
                                <div *ngIf="form.controls.instrument_status.controls[i].controls.ws_elevation.invalid && (form.controls.instrument_status.controls[i].controls.ws_elevation.dirty || form.controls.instrument_status.controls[i].controls.ws_elevation.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.instrument_status.controls[i].controls.ws_elevation.errors?.['incorrectValue']">
                                        Water Surface Elevation must be a numeric value.
                                    </div>
                                </div>
                                <mat-form-field appearance="fill">
                                    <mat-label>Ground Elevation</mat-label>
                                    <input aria-label="Ground Elevation" matInput type="number" formControlName="gs_elevation" [value]="instrument.gs_elevation">
                                    <mat-icon matSuffix class="info-icon" matTooltip="Using the ground surface tape down, elevation of the ground surface." 
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                </mat-form-field>
                                <!-- Ground Surface Elevation Validator -->
                                <div *ngIf="form.controls.instrument_status.controls[i].controls.gs_elevation.invalid && (form.controls.instrument_status.controls[i].controls.gs_elevation.dirty || form.controls.instrument_status.controls[i].controls.gs_elevation.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.instrument_status.controls[i].controls.gs_elevation.errors?.['incorrectValue']">
                                        Ground Surface Elevation must be a numeric value.
                                    </div>
                                </div>
                                <mat-form-field appearance="fill">
                                    <mat-label>In Feet Above</mat-label>
                                    <mat-select aria-label="In Feet Above" formControlName="vdatum_id">
                                        <mat-option *ngFor="let datum of vDatumList" [value]="datum.datum_id">
                                        {{datum.datum_name}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="note">
                    <label>Note: these elevations are used in the sensor processing and the final products.</label>
                </div>
                <mat-divider></mat-divider>
                <mat-radio-group class="radio-btn-group" [(value)]="vented" (change)="ventedChange($event.value)">
                    <mat-label>Vented</mat-label>
                    <mat-radio-button class="radio-button" value="Yes">Yes</mat-radio-button>
                    <mat-radio-button class="radio-button" value="No">No</mat-radio-button>
                </mat-radio-group>
                <mat-form-field appearance="fill">
                    <mat-label>Deployment Type</mat-label>
                    <mat-select aria-label="Deployment Type" formControlName="deployment_type_id">
                        <mat-option *ngFor="let type of deploymentTypes" [value]="type.deployment_type_id">
                        {{type.method}}
                        </mat-option>
                    </mat-select>
                </mat-form-field>
                <mat-form-field appearance="fill">
                    <mat-label for="description">Location Description</mat-label>
                    <textarea aria-label="Location Description" matInput formControlName="location_description" [value]="sensor.location_description"></textarea>
                    <mat-icon matSuffix class="info-icon" matTooltip="Please be specific so others can find this sensor later. This field is public." 
                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                </mat-form-field>
                <mat-radio-group class="radio-btn-group" [(value)]="interval_unit" (change)="intervalUnitChange($event.value)">
                    <mat-radio-button class="radio-button" value="min">Minutes</mat-radio-button>
                    <mat-radio-button class="radio-button" value="sec">Seconds</mat-radio-button>
                </mat-radio-group>
                <mat-form-field appearance="fill">
                    <mat-label for="elevation">Interval</mat-label>
                    <input aria-label="Interval" matInput formControlName="interval" type="number" [value]="sensor.interval"/>
                </mat-form-field>
                <!-- Interval Validator -->
                <div *ngIf="form.controls.interval.invalid && (form.controls.interval.dirty || form.controls.interval.touched)"
                    class="alert alert-danger">
                    <div *ngIf="form.controls.interval.errors?.['incorrectValue']">
                        Interval must be a numeric value.
                    </div>
                </div>
                <div *ngIf="sensor.instrument_status.length > 0">
                    <div *ngFor="let instrument of sensor.instrument_status; let i = index" formArrayName="instrument_status">
                        <div *ngIf="instrument.status === 'Deployed'">
                            <div [formGroupName]="i" (change)="previewUTC(instrument)">
                                <div class="dateFields">
                                    <mat-form-field appearance="fill">
                                        <mat-label>Deploy Date</mat-label>
                                        <input aria-label="Deploy Date" matInput formControlName="time_stamp" [value]="instrument.time_stamp" (dateChange)="previewUTC(instrument)" [matDatepicker]="deployDatePicker" required placeholder="Choose a date">
                                        <mat-datepicker-toggle matSuffix [for]="deployDatePicker"></mat-datepicker-toggle>
                                        <mat-datepicker [value]="instrument.time_stamp" #deployDatePicker></mat-datepicker>
                                    </mat-form-field>
                                    <input class="date-input" formControlName="hour" type="number" aria-label="Deploy Hour" [value]="instrument.hour" required placeholder="00"> : 
                                    <input class="date-input" formControlName="minute" type="number" aria-label="Deploy Minute" [value]="instrument.minute" required placeholder="00">
                                    <button mat-stroked-button class="date-input date-button secondary" type="button" (click)="changeTime(instrument)" [value]="instrument.ampm">{{instrument.ampm}}</button>
                                </div>
                                <mat-form-field appearance="fill">
                                    <mat-label>Time Zone</mat-label>
                                    <mat-select aria-label="Time Zone" required formControlName="time_zone" (selectionChange)="setTimeZone(instrument)">
                                        <mat-option *ngFor="let zone of timeZones" [value]="zone">
                                        {{zone}}
                                        </mat-option>
                                    </mat-select>
                                    <mat-icon matSuffix class="info-icon" matTooltip="Date/Time will be stored in UTC."
                                    aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                </mat-form-field>
                                <div>
                                    <label class="form-header">Preview time in UTC: </label> {{instrument.utc_preview}} GMT
                                </div>
                                <mat-form-field appearance="fill">
                                    <mat-label for="description">Note</mat-label>
                                    <textarea aria-label="Note" matInput formControlName="notes" [value]="instrument.notes"></textarea>
                                </mat-form-field>
                                <div>
                                    <label class="form-header">Deploy Member: </label> {{instrument.member_name}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ref-button-group">
                    <button class="primary" mat-button cdkFocusInitial aria-label="Save" id="1" type="submit">Save</button>
                    <button class="secondary cancel-btn" type="button" mat-stroked-button cdkFocusInitial aria-label="Cancel Edits" (click)="cancelForm('Deployed')">Cancel Edits</button>
                </div>
            </mat-expansion-panel>
            <mat-expansion-panel hideToggle [expanded]="retrievedExpanded" (opened)="retrievedExpanded = true" (closed)="retrievedExpanded = false" *ngIf="sensor.statusType === 'Retrieved'">
                <mat-expansion-panel-header>
                    <mat-panel-title *ngIf="!retrievedExpanded" style="color: grey; font-weight: 500">
                        Retrieved Sensor Information
                    </mat-panel-title>
                    <mat-panel-title *ngIf="retrievedExpanded" style="color: #FFF; font-weight: 550">
                        Retrieved Sensor Information
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <div *ngIf="sensor.instrument_status.length > 0">
                    <div *ngFor="let instrument of sensor.instrument_status; let i = index" formArrayName="instrument_status">
                        <div *ngIf="instrument.status === 'Retrieved'">
                            <div [formGroupName]="i">
                                <mat-form-field appearance="fill">
                                    <mat-label>Status</mat-label>
                                    <mat-select required aria-label="Status" formControlName="status_type_id"  (selectionChange)="statusChanged($event.value)">
                                        <mat-option *ngFor="let type of statusTypes" [value]="type.status_type_id">
                                        {{type.status}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>
                    </div>
                    <mat-form-field appearance="fill">
                        <mat-label>Collection Conditions</mat-label>
                        <mat-select required aria-label="Collection Conditions" formControlName="inst_collection_id">
                            <mat-option *ngFor="let condition of collectConds" [value]="condition.id">
                            {{condition.condition}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                    <div *ngFor="let instrument of sensor.instrument_status; let i = index" formArrayName="instrument_status">
                        <div *ngIf="instrument.status === 'Retrieved'">
                            <div [formGroupName]="i" (change)="previewUTC(instrument)">
                                <mat-form-field appearance="fill">
                                    <mat-label for="description">Note</mat-label>
                                    <textarea aria-label="Note" matInput formControlName="notes" [value]="instrument.notes"></textarea>
                                </mat-form-field>
                                <div class="dateFields">
                                    <mat-form-field appearance="fill">
                                        <mat-label>Retrieve Date</mat-label>
                                        <input aria-label="Retrieve Date" matInput formControlName="time_stamp" [value]="instrument.time_stamp" (dateChange)="previewUTC(instrument)" [matDatepicker]="deployDatePicker" required placeholder="Choose a date">
                                        <mat-datepicker-toggle matSuffix [for]="deployDatePicker"></mat-datepicker-toggle>
                                        <mat-datepicker [value]="instrument.time_stamp" #deployDatePicker></mat-datepicker>
                                    </mat-form-field>
                                    <input class="date-input" formControlName="hour" aria-label="Deploy Hour" type="number" [value]="instrument.hour" required placeholder="00"> : 
                                    <input class="date-input" formControlName="minute" aria-label="Deploy Minute" type="number" [value]="instrument.minute" required placeholder="00">
                                    <button mat-stroked-button class="date-input date-button" type="button" (click)="changeTime(instrument)" [value]="instrument.ampm">{{instrument.ampm}}</button>
                                </div>
                                <mat-form-field appearance="fill">
                                    <mat-label>Time Zone</mat-label>
                                    <mat-select aria-label="Time Zone" required formControlName="time_zone" (selectionChange)="setTimeZone(instrument)">
                                        <mat-option *ngFor="let zone of timeZones" [value]="zone">
                                        {{zone}}
                                        </mat-option>
                                    </mat-select>
                                    <mat-icon matSuffix class="info-icon" matTooltip="Date/Time will be stored in UTC."
                                    aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                </mat-form-field>
                                <div>
                                    <label class="form-header">Preview time in UTC: </label> {{instrument.utc_preview}} GMT
                                </div>
                            </div>
                        </div>
                    </div>
                    <mat-divider></mat-divider>
                    <div class="tapedown-header">
                        <label class="form-header">Tapedowns: </label>
                    </div>
                    <div class="tapedowns" [hidden]="!opsPresent">
                            <mat-form-field appearance="fill">
                                <mat-label>Reference Datums</mat-label>
                                        <mat-select aria-label="Reference Datums" formControlName="retrievedRefMarks" (selectionChange)="changeTableValue($event.value, 'Retrieved')" multiple>
                                            <mat-option *ngFor="let refmark of data.siteRefMarks" [value]="refmark.name">
                                            {{refmark.name}}
                                            </mat-option>
                                        </mat-select>
                                    <mat-icon matSuffix class="info-icon" matTooltip="These elevations and tapedown data are used for both field activities and final products. Please pay attention to how your data is entered."
                                    aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                            </mat-form-field>
                    </div>
                    <div class="tapedowns" [hidden]="opsPresent">
                        <label>
                            No Datum Locations have been added to this site yet to use for a tape down
                        </label>
                    </div>
                    <div class="tableContainer">
                        <table [hidden]="!form.controls.retrievedTapedowns.length > 0"
                            #retrievedTable
                            mat-table
                            id="tapedownsTable"
                            [dataSource]="retrievedTapedowns"
                            formArrayName="retrievedTapedowns"
                            class="mat-elevation-z5"
                            matSort
                        >
    
                            <!-- Reference Datum name column -->
                            <ng-container matColumnDef="ReferenceDatum">
                                <th mat-header-cell *matHeaderCellDef>Reference Datum</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field>
                                        <input matInput formControlName="op_name" [value]="tapedown.op_name" class="disabled"/>
                                    </mat-form-field>
                                </td>
                            </ng-container>
        
                            <!-- Elevation column -->
                            <ng-container matColumnDef="Elevation">
                                <th mat-header-cell *matHeaderCellDef>Elevation</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field>
                                        <div class="inline-fields">
                                            <div *ngIf="tapedown.elevation !== undefined">
                                                <input matInput formControlName="elevation" [value]="tapedown.elevation" class="disabled"/>
                                            </div>
                                            <input matInput formControlName="vdatum" [value]="tapedown.vdatum" class="disabled"/>
                                        </div>
                                    </mat-form-field>
                                    <!-- Elevation Validator -->
                                    <div *ngIf="form.controls.retrievedTapedowns.controls[i].controls.elevation.invalid && (form.controls.retrievedTapedowns.controls[i].controls.elevation.dirty || form.controls.retrievedTapedowns.controls[i].controls.elevation.touched)"
                                        class="alert alert-danger">
                                        <div *ngIf="form.controls.retrievedTapedowns.controls[i].controls.elevation.errors?.['incorrectValue']">
                                            Elevation must be a numeric value.
                                        </div>
                                    </div>
                                </td>
                            </ng-container>
    
                            <!-- Offset correction column -->
                            <ng-container matColumnDef="OffsetCorrection">
                                <th mat-header-cell *matHeaderCellDef>Offset Correction</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field appearance="fill">
                                        <input matInput type="number" formControlName="offset_correction" [value]="tapedown.offset_correction"/>
                                        <mat-icon matSuffix class="info-icon" matTooltip="From the datum location to the sensor orifice."
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                    </mat-form-field>
                                    <!-- Offset Correction Validator -->
                                    <div *ngIf="form.controls.retrievedTapedowns.controls[i].controls.offset_correction.invalid && (form.controls.retrievedTapedowns.controls[i].controls.offset_correction.dirty || form.controls.retrievedTapedowns.controls[i].controls.offset_correction.touched)"
                                        class="alert alert-danger">
                                        <div *ngIf="form.controls.retrievedTapedowns.controls[i].controls.offset_correction.errors?.['incorrectValue']">
                                            Offset Correction must be a numeric value.
                                        </div>
                                    </div>
                                </td>
                            </ng-container>
    
                            <!-- WS column -->
                            <ng-container matColumnDef="WaterSurface">
                                <th mat-header-cell *matHeaderCellDef>Water Surface</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field appearance="fill">
                                        <input matInput type="number" formControlName="water_surface" [value]="tapedown.water_surface"/>
                                        <mat-icon matSuffix class="info-icon" matTooltip="From the datum location to the water surface."
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                    </mat-form-field>
                                    <!-- Water Surface Validator -->
                                    <div *ngIf="form.controls.retrievedTapedowns.controls[i].controls.water_surface.invalid && (form.controls.retrievedTapedowns.controls[i].controls.water_surface.dirty || form.controls.retrievedTapedowns.controls[i].controls.water_surface.touched)"
                                        class="alert alert-danger">
                                        <div *ngIf="form.controls.retrievedTapedowns.controls[i].controls.water_surface.errors?.['incorrectValue']">
                                            Water Surface must be a numeric value.
                                        </div>
                                    </div>
                                </td>
                            </ng-container>
    
                            <!-- GS column -->
                            <ng-container matColumnDef="GroundSurface">
                                <th mat-header-cell *matHeaderCellDef>Ground Surface</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field appearance="fill">
                                        <input matInput type="number" formControlName="ground_surface" [value]="tapedown.ground_surface"/>
                                        <mat-icon matSuffix class="info-icon" matTooltip="From the datum location to the ground surface."
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                    </mat-form-field>
                                    <!-- Ground Surface Validator -->
                                    <div *ngIf="form.controls.retrievedTapedowns.controls[i].controls.ground_surface.invalid && (form.controls.retrievedTapedowns.controls[i].controls.ground_surface.dirty || form.controls.retrievedTapedowns.controls[i].controls.ground_surface.touched)"
                                        class="alert alert-danger">
                                        <div *ngIf="form.controls.retrievedTapedowns.controls[i].controls.ground_surface.errors?.['incorrectValue']">
                                            Ground Surface must be a numeric value.
                                        </div>
                                    </div>
                                </td>
                            </ng-container>
        
                            <tr mat-header-row *matHeaderRowDef="displayedTapedownColumns"></tr>
                            <tr
                                mat-row
                                *matRowDef="let row; columns: displayedTapedownColumns"
                                class="results-row"
                            ></tr>
                        </table>
                    </div>
                    <div class="note">
                        <label>Note: these are not used for any calculations but are to facilitate field activities.</label>
                    </div>
                    <mat-divider></mat-divider>
                    <div *ngFor="let instrument of sensor.instrument_status; let i = index" formArrayName="instrument_status">
                        <div *ngIf="instrument.status === 'Retrieved'">
                            <div [formGroupName]="i">
                                <mat-form-field appearance="fill">
                                    <mat-label>Sensor Elevation</mat-label>
                                    <input aria-label="Sensor Elevation" matInput type="number" formControlName="sensor_elevation" [value]="instrument.sensor_elevation">
                                    <mat-icon matSuffix class="info-icon" matTooltip="Using the offset correction, elevation of the sensor orifice." 
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                </mat-form-field>
                                <!-- Sensor Elevation Validator -->
                                <div *ngIf="form.controls.instrument_status.controls[i].controls.sensor_elevation.invalid && (form.controls.instrument_status.controls[i].controls.sensor_elevation.dirty || form.controls.instrument_status.controls[i].controls.sensor_elevation.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.instrument_status.controls[i].controls.sensor_elevation.errors?.['incorrectValue']">
                                        Sensor Elevation must be a numeric value.
                                    </div>
                                </div>
                                <mat-form-field appearance="fill">
                                    <mat-label>Water Surface Elevation</mat-label>
                                    <input aria-label="Water Surface Elevation" matInput type="number" formControlName="ws_elevation" [value]="instrument.ws_elevation">
                                    <mat-icon matSuffix class="info-icon" matTooltip="Using the water surface tape down, elevation of the water surface." 
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                </mat-form-field>
                                <!-- Water Surface Elevation Validator -->
                                <div *ngIf="form.controls.instrument_status.controls[i].controls.ws_elevation.invalid && (form.controls.instrument_status.controls[i].controls.ws_elevation.dirty || form.controls.instrument_status.controls[i].controls.ws_elevation.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.instrument_status.controls[i].controls.ws_elevation.errors?.['incorrectValue']">
                                        Water Surface Elevation must be a numeric value.
                                    </div>
                                </div>
                                <mat-form-field appearance="fill">
                                    <mat-label>Ground Elevation</mat-label>
                                    <input aria-label="Ground Elevation" matInput type="number" formControlName="gs_elevation" [value]="instrument.gs_elevation">
                                    <mat-icon matSuffix class="info-icon" matTooltip="Using the ground surface tape down, elevation of the ground surface." 
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                </mat-form-field>
                                <!-- Ground Surface Elevation Validator -->
                                <div *ngIf="form.controls.instrument_status.controls[i].controls.gs_elevation.invalid && (form.controls.instrument_status.controls[i].controls.gs_elevation.dirty || form.controls.instrument_status.controls[i].controls.gs_elevation.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.instrument_status.controls[i].controls.gs_elevation.errors?.['incorrectValue']">
                                        Ground Surface Elevation must be a numeric value.
                                    </div>
                                </div>
                                <mat-form-field appearance="fill">
                                    <mat-label>In Feet Above</mat-label>
                                    <mat-select aria-label="In Feet Above" formControlName="vdatum_id">
                                        <mat-option *ngFor="let datum of vDatumList" [value]="datum.datum_id">
                                        {{datum.datum_name}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                                <div class="note">
                                    <label>Note: these elevations are used in the sensor processing and the final products.</label>
                                </div>
                                <mat-divider></mat-divider>
                                <div>
                                    <label class="form-header">Member: </label><p class="required">*</p>{{instrument.member_name}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ref-button-group">
                    <button class="primary" mat-button cdkFocusInitial aria-label="Save" id="2" type="submit">Save</button>
                    <button class="secondary cancel-btn" type="button" mat-stroked-button cdkFocusInitial aria-label="Cancel Edits" (click)="cancelForm('Retrieved')">Cancel Edits</button>
                </div>
            </mat-expansion-panel>
            <mat-expansion-panel hideToggle [expanded]="lostExpanded" (opened)="lostExpanded = true" (closed)="lostExpanded = false" *ngIf="sensor.statusType === 'Lost'">
                <mat-expansion-panel-header>
                    <mat-panel-title *ngIf="!lostExpanded" style="color: grey; font-weight: 500">
                    Lost Sensor Information
                    </mat-panel-title>
                    <mat-panel-title *ngIf="lostExpanded" style="color: #FFF; font-weight: 550">
                        Lost Sensor Information
                        </mat-panel-title>
                </mat-expansion-panel-header>
                <div *ngIf="sensor.instrument_status.length > 0">
                    <div *ngFor="let instrument of sensor.instrument_status; let i = index" formArrayName="instrument_status">
                        <div *ngIf="instrument.status === 'Lost'">
                            <div [formGroupName]="i">
                                <mat-form-field appearance="fill">
                                    <mat-label>Status</mat-label>
                                    <mat-select required aria-label="Status" formControlName="status_type_id" (selectionChange)="statusChanged($event.value)">
                                        <mat-option *ngFor="let type of statusTypes" [value]="type.status_type_id">
                                        {{type.status}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                            </div>
                        </div>
                    </div>
                    <mat-form-field appearance="fill">
                        <mat-label>Collection Conditions</mat-label>
                        <mat-select required aria-label="Collection Conditions" formControlName="inst_collection_id">
                            <mat-option *ngFor="let condition of collectConds" [value]="condition.id">
                            {{condition.condition}}
                            </mat-option>
                        </mat-select>
                    </mat-form-field>
                    <div *ngFor="let instrument of sensor.instrument_status; let i = index" formArrayName="instrument_status">
                        <div *ngIf="instrument.status === 'Lost'">
                            <div [formGroupName]="i" (change)="previewUTC(instrument)">
                                <mat-form-field appearance="fill">
                                    <mat-label for="description">Note</mat-label>
                                    <textarea aria-label="Note" matInput formControlName="notes" [value]="instrument.notes"></textarea>
                                </mat-form-field>
                                <div class="dateFields">
                                    <mat-form-field appearance="fill">
                                        <mat-label>Retrieve Date</mat-label>
                                        <input aria-label="Retrieve Date" matInput formControlName="time_stamp" [value]="instrument.time_stamp" (dateChange)="previewUTC(instrument)" [matDatepicker]="deployDatePicker" required placeholder="Choose a date">
                                        <mat-datepicker-toggle matSuffix [for]="deployDatePicker"></mat-datepicker-toggle>
                                        <mat-datepicker [value]="instrument.time_stamp" #deployDatePicker></mat-datepicker>
                                    </mat-form-field>
                                    <input class="date-input" formControlName="hour" aria-label="Deploy Hour" type="number" [value]="instrument.hour" required placeholder="00"> : 
                                    <input class="date-input" formControlName="minute" aria-label="Deploy Minute" type="number" [value]="instrument.minute" required placeholder="00">
                                    <button mat-stroked-button class="date-input date-button" type="button" (click)="changeTime(instrument)" [value]="instrument.ampm">{{instrument.ampm}}</button>
                                </div>
                                <mat-form-field appearance="fill">
                                    <mat-label>Time Zone</mat-label>
                                    <mat-select aria-label="Time Zone" required formControlName="time_zone" (selectionChange)="setTimeZone(instrument)">
                                        <mat-option *ngFor="let zone of timeZones" [value]="zone">
                                        {{zone}}
                                        </mat-option>
                                    </mat-select>
                                    <mat-icon matSuffix class="info-icon" matTooltip="Date/Time will be stored in UTC."
                                    aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                </mat-form-field>
                                <div>
                                    <label class="form-header">Preview time in UTC: </label> {{instrument.utc_preview}} GMT
                                </div>
                            </div>
                        </div>
                    </div>
                    <mat-divider></mat-divider>
                    <div class="tapedown-header">
                        <label class="form-header">Tapedowns: </label>
                    </div>
                    <div class="tapedowns" [hidden]="!opsPresent">
                        <mat-form-field appearance="fill">
                            <mat-label>Reference Datums</mat-label>
                                <mat-select aria-label="Reference Datums" formControlName="lostRefMarks" (selectionChange)="changeTableValue($event.value, 'Lost')" multiple>
                                    <mat-option *ngFor="let refmark of data.siteRefMarks" [value]="refmark.vdatum_id">
                                    {{refmark.name}}
                                    </mat-option>
                                </mat-select>
                                <mat-icon matSuffix class="info-icon" matTooltip="These elevations and tapedown data are used for both field activities and final products. Please pay attention to how your data is entered."
                                aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                        </mat-form-field>
                    </div>
                    <div class="tapedowns" [hidden]="opsPresent">
                        <label>
                            No Datum Locations have been added to this site yet to use for a tape down
                        </label>
                    </div>
                    <div class="tableContainer">
                        <table [hidden]="!form.controls.lostTapedowns.length > 0"
                            #lostTable
                            mat-table
                            id="tapedownsTable"
                            [dataSource]="lostTapedowns"
                            formArrayName="lostTapedowns"
                            class="mat-elevation-z5"
                            matSort
                        >
    
                            <!-- Reference Datum name column -->
                            <ng-container matColumnDef="ReferenceDatum">
                                <th mat-header-cell *matHeaderCellDef>Reference Datum</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field>
                                        <input matInput formControlName="op_name" [value]="tapedown.op_name" class="disabled"/>
                                    </mat-form-field>
                                </td>
                            </ng-container>
        
                            <!-- Elevation column -->
                            <ng-container matColumnDef="Elevation">
                                <th mat-header-cell *matHeaderCellDef>Elevation</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field>
                                        <div class="inline-fields">
                                            <div *ngIf="tapedown.elevation !== undefined">
                                                <input matInput formControlName="elevation" [value]="tapedown.elevation" class="disabled"/>
                                            </div>
                                            <input matInput formControlName="vdatum" [value]="tapedown.vdatum" class="disabled"/>
                                        </div>
                                    </mat-form-field>
                                    <!-- Elevation Validator -->
                                    <div *ngIf="form.controls.lostTapedowns.controls[i].controls.elevation.invalid && (form.controls.lostTapedowns.controls[i].controls.elevation.dirty || form.controls.lostTapedowns.controls[i].controls.elevation.touched)"
                                        class="alert alert-danger">
                                        <div *ngIf="form.controls.lostTapedowns.controls[i].controls.elevation.errors?.['incorrectValue']">
                                            Elevation must be a numeric value.
                                        </div>
                                    </div>
                                </td>
                            </ng-container>
    
                            <!-- Offset correction column -->
                            <ng-container matColumnDef="OffsetCorrection">
                                <th mat-header-cell *matHeaderCellDef>Offset Correction</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field appearance="fill">
                                        <input matInput type="number" formControlName="offset_correction" [value]="tapedown.offset_correction"/>
                                        <mat-icon matSuffix class="info-icon" matTooltip="From the datum location to the sensor orifice."
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                    </mat-form-field>
                                    <!-- Offset Correction Validator -->
                                    <div *ngIf="form.controls.lostTapedowns.controls[i].controls.offset_correction.invalid && (form.controls.lostTapedowns.controls[i].controls.offset_correction.dirty || form.controls.lostTapedowns.controls[i].controls.offset_correction.touched)"
                                        class="alert alert-danger">
                                        <div *ngIf="form.controls.lostTapedowns.controls[i].controls.offset_correction.errors?.['incorrectValue']">
                                            Offset Correction must be a numeric value.
                                        </div>
                                    </div>
                                </td>
                            </ng-container>
    
                            <!-- WS column -->
                            <ng-container matColumnDef="WaterSurface">
                                <th mat-header-cell *matHeaderCellDef>Water Surface</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field appearance="fill">
                                        <input matInput type="number" formControlName="water_surface" [value]="tapedown.water_surface"/>
                                        <mat-icon matSuffix class="info-icon" matTooltip="From the datum location to the water surface."
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                    </mat-form-field>
                                    <!-- Water Surface Validator -->
                                    <div *ngIf="form.controls.lostTapedowns.controls[i].controls.water_surface.invalid && (form.controls.lostTapedowns.controls[i].controls.water_surface.dirty || form.controls.lostTapedowns.controls[i].controls.water_surface.touched)"
                                        class="alert alert-danger">
                                        <div *ngIf="form.controls.lostTapedowns.controls[i].controls.water_surface.errors?.['incorrectValue']">
                                            Water Surface must be a numeric value.
                                        </div>
                                    </div>
                                </td>
                            </ng-container>
    
                            <!-- GS column -->
                            <ng-container matColumnDef="GroundSurface">
                                <th mat-header-cell *matHeaderCellDef>Ground Surface</th>
                                <td mat-cell *matCellDef="let tapedown; let i = index" [formGroupName]="i">
                                    <mat-form-field appearance="fill">
                                        <input matInput type="number" formControlName="ground_surface" [value]="tapedown.ground_surface"/>
                                        <mat-icon matSuffix class="info-icon" matTooltip="From the datum location to the ground surface."
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                    </mat-form-field>
                                    <!-- Ground Surface Validator -->
                                    <div *ngIf="form.controls.lostTapedowns.controls[i].controls.ground_surface.invalid && (form.controls.lostTapedowns.controls[i].controls.ground_surface.dirty || form.controls.lostTapedowns.controls[i].controls.ground_surface.touched)"
                                        class="alert alert-danger">
                                        <div *ngIf="form.controls.lostTapedowns.controls[i].controls.ground_surface.errors?.['incorrectValue']">
                                            Ground Surface must be a numeric value.
                                        </div>
                                    </div>
                                </td>
                            </ng-container>
        
                            <tr mat-header-row *matHeaderRowDef="displayedTapedownColumns"></tr>
                            <tr
                                mat-row
                                *matRowDef="let row; columns: displayedTapedownColumns"
                                class="results-row"
                            ></tr>
                        </table>
                    </div>
                    <div class="note">
                        <label>Note: these are not used for any calculations but are to facilitate field activities.</label>
                    </div>
                    <mat-divider></mat-divider>
                    <div *ngFor="let instrument of sensor.instrument_status; let i = index" formArrayName="instrument_status">
                        <div *ngIf="instrument.status === 'Lost'">
                            <div [formGroupName]="i">
                                <mat-form-field appearance="fill">
                                    <mat-label>Sensor Elevation</mat-label>
                                    <input aria-label="Sensor Elevation" matInput type="number" formControlName="sensor_elevation" [value]="instrument.sensor_elevation">
                                    <mat-icon matSuffix class="info-icon" matTooltip="Using the offset correction, elevation of the sensor orifice." 
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                </mat-form-field>
                                <!-- Sensor Elevation Validator -->
                                <div *ngIf="form.controls.instrument_status.controls[i].controls.sensor_elevation.invalid && (form.controls.instrument_status.controls[i].controls.sensor_elevation.dirty || form.controls.instrument_status.controls[i].controls.sensor_elevation.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.instrument_status.controls[i].controls.sensor_elevation.errors?.['incorrectValue']">
                                        Sensor Elevation must be a numeric value.
                                    </div>
                                </div>
                                <mat-form-field appearance="fill">
                                    <mat-label>Water Surface Elevation</mat-label>
                                    <input aria-label="Water Surface Elevation" matInput type="number" formControlName="ws_elevation" [value]="instrument.ws_elevation">
                                    <mat-icon matSuffix class="info-icon" matTooltip="Using the water surface tape down, elevation of the water surface." 
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                </mat-form-field>
                                <!-- Water Surface Elevation Validator -->
                                <div *ngIf="form.controls.instrument_status.controls[i].controls.ws_elevation.invalid && (form.controls.instrument_status.controls[i].controls.ws_elevation.dirty || form.controls.instrument_status.controls[i].controls.ws_elevation.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.instrument_status.controls[i].controls.ws_elevation.errors?.['incorrectValue']">
                                        Water Surface Elevation must be a numeric value.
                                    </div>
                                </div>
                                <mat-form-field appearance="fill">
                                    <mat-label>Ground Elevation</mat-label>
                                    <input aria-label="Ground Elevation" matInput type="number" formControlName="gs_elevation" [value]="instrument.gs_elevation">
                                    <mat-icon matSuffix class="info-icon" matTooltip="Using the ground surface tape down, elevation of the ground surface." 
                                        aria-label="Displays a tooltip when focused or hovered over">info</mat-icon>
                                </mat-form-field>
                                <!-- Ground Surface Elevation Validator -->
                                <div *ngIf="form.controls.instrument_status.controls[i].controls.gs_elevation.invalid && (form.controls.instrument_status.controls[i].controls.gs_elevation.dirty || form.controls.instrument_status.controls[i].controls.gs_elevation.touched)"
                                    class="alert alert-danger">
                                    <div *ngIf="form.controls.instrument_status.controls[i].controls.gs_elevation.errors?.['incorrectValue']">
                                        Ground Surface Elevation must be a numeric value.
                                    </div>
                                </div>
                                <mat-form-field appearance="fill">
                                    <mat-label>In Feet Above</mat-label>
                                    <mat-select aria-label="In Feet Above" formControlName="vdatum_id">
                                        <mat-option *ngFor="let datum of vDatumList" [value]="datum.datum_id">
                                        {{datum.datum_name}}
                                        </mat-option>
                                    </mat-select>
                                </mat-form-field>
                                <div class="note">
                                    <label>Note: these elevations are used in the sensor processing and the final products.</label>
                                </div>
                                <mat-divider></mat-divider>
                                <div>
                                    <label class="form-header">Member: </label> <p class="required">*</p>{{instrument.member_name}}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="ref-button-group">
                    <button class="primary" mat-button cdkFocusInitial aria-label="Save" id="3" type="submit">Save</button>
                    <button class="secondary cancel-btn" type="button" mat-stroked-button cdkFocusInitial aria-label="Cancel Edits" (click)="cancelForm('Lost')">Cancel Edits</button>
                </div>
            </mat-expansion-panel>
            <mat-expansion-panel hideToggle [expanded]="filesExpanded" (opened)="filesExpanded = true" (closed)="filesExpanded = false">
                <mat-expansion-panel-header>
                    <mat-panel-title *ngIf="!filesExpanded" style="color: grey; font-weight: 500">
                        Sensor File Information
                    </mat-panel-title>
                    <mat-panel-title *ngIf="filesExpanded" style="color: #FFF; font-weight: 550">
                        Sensor File Information
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <button mat-stroked-button class="add" type="button"><mat-icon>add</mat-icon> Add File</button>
                <div class="tableContainer" [hidden]="initSensorFiles?.length === 0">
                    <table
                        mat-table
                        id="sensorFileTable"
                        [dataSource]="initSensorFiles"
                        class="mat-elevation-z5"
                        matSort
                    >

                        <!-- file name column -->
                        <ng-container matColumnDef="FileName">
                            <th mat-header-cell *matHeaderCellDef>File Name</th>
                            <td mat-cell *matCellDef="let file">
                                <div>
                                    {{file.name}}
                                </div>
                            </td>
                        </ng-container>

                        <!-- file date column -->
                        <ng-container matColumnDef="FileDate">
                            <th mat-header-cell *matHeaderCellDef>File Date</th>
                            <td mat-cell *matCellDef="let file">
                                <div>
                                    {{file.format_file_date}}
                                </div>
                            </td>
                        </ng-container>

                        <tr mat-header-row *matHeaderRowDef="displayedFileColumns"></tr>
                        <tr
                            mat-row
                            *matRowDef="let row; columns: displayedFileColumns"
                            class="file-table"
                        ></tr>
                    </table>
                </div>
            </mat-expansion-panel>
            <mat-expansion-panel hideToggle [expanded]="nwisExpanded"  (opened)="nwisExpanded = true" (closed)="nwisExpanded = false" *ngIf="sensor.statusType === 'Deployed'">
                <mat-expansion-panel-header>
                    <mat-panel-title *ngIf="!nwisExpanded" style="color: grey; font-weight: 500">
                        NWIS Connection
                    </mat-panel-title>
                    <mat-panel-title *ngIf="nwisExpanded" style="color: #FFF; font-weight: 550">
                        NWIS Connection
                    </mat-panel-title>
                </mat-expansion-panel-header>
                <button mat-stroked-button class="add-button add" type="button"><mat-icon>add</mat-icon> Add File</button>
                <div class="tableContainer">
                    <table *ngIf="initNWISFiles.length > 0"
                        mat-table
                        id="initNWISFilesTable"
                        [dataSource]="initNWISFiles"
                        class="mat-elevation-z5"
                    >
        
                        <!-- NWIS file name column -->
                        <ng-container matColumnDef="FileName">
                            <th mat-header-cell *matHeaderCellDef>File Name</th>
                            <td mat-cell *matCellDef="let file">
                                <div *ngIf="file.name === '' || file.name === undefined; else displayNWISFileName">
                                    ---
                                </div>
                                <ng-template #displayNWISFileName>
                                    {{ file.name }}
                                </ng-template>
                            </td>
                        </ng-container>

                        <!-- NWIS file date column -->
                        <ng-container matColumnDef="FileDate">
                            <th mat-header-cell *matHeaderCellDef>File Date</th>
                            <td mat-cell *matCellDef="let file">
                                <div *ngIf="file.file_date === '' || file.file_date === undefined; else displayNWISFileDate">
                                    ---
                                </div>
                                <ng-template #displayNWISFileDate>
                                    {{ file.format_file_date }}
                                </ng-template>
                            </td>
                        </ng-container>
        
                        <tr mat-header-row *matHeaderRowDef="displayedNWISFileColumns"></tr>
                        <tr
                            mat-row
                            *matRowDef="let row; columns: displayedNWISFileColumns"
                            class="file-table"
                        ></tr>
                    </table>
                </div>
            </mat-expansion-panel>
        </mat-accordion>
    </mat-dialog-content>
    <mat-dialog-actions align="end">
        <div class="detail-section-buttons centered">
            <button mat-stroked-button class="secondary" [mat-dialog-close]="returnData" cdkFocusInitial aria-label="Cancel">Cancel</button>
            <!-- The mat-dialog-close directive optionally accepts a value as a result for the dialog. -->
        </div>
    </mat-dialog-actions>
</form>



